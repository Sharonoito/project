Ibles.package("Ibles.mixins"),Ibles.mixins.SelectOneCollection={getSelected:function(){return this.findWhere({selected:!0})},select:function(e){this.forEach(function(e){e.set({selected:!1},{silent:!0})}),e.set({selected:!0})},deselect:function(e){e.set({selected:!1})}},Ibles.mixins.SelectManyCollection={getSelected:function(){return this.where({selected:!0})},select:function(e){e.set({selected:!0})},deselect:function(e){e.set({selected:!1})},deselectAll:function(){this.invoke("set",{selected:!1})},selectOnly:function(t,n){this.deselectAll(),this.forEach(function(e){_.contains(n,e.get(t))&&e.set({selected:!0})})}},Ibles.mixins.SelectableModel={mergedAttributes:{selected:!1},select:function(e){return this.collection.select(this,e),this},deselect:function(e){return this.collection.deselect(this,e),this},toggleSelected:function(e){return this.get("selected")?this.deselect(e):this.select(e),this}},Ibles.package("Ibles.models"),Ibles.models.ChannelModel=Backbone.Model.extend({idAttribute:"name",defaults:{name:null,title:null,type:null,category:null,following:!1},toggleFollowing:function(){var t=this,e=_.extend(this.getFollowedParams(),{following:!this.get("following")});return Ibles.API.post({url:Ibles.apiUrl("setFollowing"),data:$.param(e,!0),processData:!1,success:function(e){t.set({following:e.following})}})},getFollowedParams:function(){var e={};return Ibles.setFollowChannelParams(e,this.get("category"),this.get("name")),e},isFollowing:function(){var t=this,e=this.getFollowedParams();return Ibles.API.getRequest("isFollowing",e,{success:function(e){t.set({following:e.isFollowing})}})}}),Ibles.package("Ibles.collections"),Ibles.collections.ChannelCollection=Backbone.Collection.extend({initialize:function(){this.makeMultiSelectable()},makeMultiSelectable:function(){Ibles.applyMixin(this,Ibles.mixins.SelectManyCollection)},model:function(e,t){return Ibles.makeModelSelectable(new Ibles.models.ChannelModel(e,t))},modelId:function(e){return e.name},getChannel:function(e){return this.get(e)}}),Ibles.package("Ibles.models"),Ibles.models.CategoryModel=Backbone.Model.extend({idAttribute:"name",defaults:function(){return{name:null,title:null,type:null,channels:[]}},initialize:function(e){var t=e||{};this.channelsCollection=new Ibles.collections.ChannelCollection(t.channels||[],{parse:!0})},getDisplayTitle:function(){return this.get("title")}}),Ibles.package("Ibles.models"),Ibles.models.TeacherCategoryModel=Ibles.models.CategoryModel.fullExtend({defaults:function(){return{name:null,title:null,type:null,channels:[],grades:[],gradeGroups:[],subjects:[]}},initialize:function(e,t){var n=e||{},i=n.grades||[],s=n.gradeGroups||[],r=n.subjects||[],o=i.concat(r);this._super(_.extend(n,{channels:o}),t),this.gradesCollection=new Ibles.collections.GradeCollection(i,{parse:!0}),this.gradeGroupsCollection=new Ibles.collections.GradeGroupCollection(s,{parse:!0}),this.subjectsCollection=new Ibles.collections.SubjectCollection(r,{parse:!0})},reset:function(e){var t=e||{};this.gradesCollection.reset(t.grades||[]),this.gradeGroupsCollection.reset(t.gradeGroups||[]),this.subjectsCollection.reset(t.subjects||[]),this.channelsCollection.reset((t.grades||[]).concat(t.subjects||[])),this.set({name:t.name,title:t.title,type:t.type})}}),Ibles.package("Ibles.collections"),Ibles.collections.CategoryCollection=Backbone.Collection.extend({initialize:function(){Ibles.applyMixin(this,Ibles.mixins.SelectOneCollection)},model:function(e,t){var n="teachers"===e.name?new Ibles.models.TeacherCategoryModel(e,t):new Ibles.models.CategoryModel(e,t);return Ibles.applyMixin(n,Ibles.mixins.SelectableModel),n},modelId:function(e){return e.name},getCategoryModel:function(e){return this.get(e)},getChannelsInCategory:function(e){var t=this.getCategoryModel(e);return t&&t.channelsCollection}}),Ibles.package("Ibles.models"),Ibles.models.SubjectModel=Ibles.models.ChannelModel.fullExtend({defaults:function(){return{type:"subject",category:"teachers"}}}),Ibles.package("Ibles.collections"),Ibles.collections.SubjectCollection=Ibles.collections.ChannelCollection.extend({model:function(e,t){return Ibles.makeModelSelectable(new Ibles.models.SubjectModel(e,t))},getSelectedSubjectNames:function(){var e=this.getSelected();return _.map(e,function(e){return e.get("name")})},getSelectedSubjectTitles:function(){var e=this.getSelected();return _.map(e,function(e){return e.get("title")})}}),Ibles.package("Ibles.models"),Ibles.models.GradeModel=Ibles.models.ChannelModel.fullExtend({defaults:function(){return{type:"grade",category:"teachers",gradeGroup:null}}}),Ibles.package("Ibles.collections"),Ibles.collections.GradeCollection=Ibles.collections.ChannelCollection.extend({model:function(e,t){return Ibles.makeModelSelectable(new Ibles.models.GradeModel(e,t))},getSelectedGradeGroupNames:function(){var e=this.getSelected(),t=_.map(e,function(e){return e.get("gradeGroup")});return _.uniq(t)}}),Ibles.package("Ibles.models"),Ibles.models.GradeGroupModel=Ibles.models.ChannelModel.fullExtend({defaults:function(){return{name:"",title:"",type:"gradeGroup",category:"teachers",grades:[]}},getFollowedParams:function(){return{grade:this.get("grades")}}}),Ibles.package("Ibles.collections"),Ibles.collections.GradeGroupCollection=Ibles.collections.ChannelCollection.extend({model:function(e,t){return Ibles.makeModelSelectable(new Ibles.models.GradeGroupModel(e,t))},initialize:function(e){var t,n,i;this._super(e),e||(t=Ibles.pageContext.gradeGroups,_.isEmpty(t)||this.reset(Ibles.pageContext.gradeGroups),i=(n=Ibles.pageContext.taxonomy)&&_.findWhere(n,{name:"teachers"}),_.isEmpty(i)||_.isEmpty(i.gradeGroups)||this.reset(i.gradeGroups))},getGradeGroupContainingGrade:function(t){return this.find(function(e){return _.contains(e.get("grades"),t)})},getSelectedNames:function(){return _.map(this.getSelected(),function(e){return e.get("title")})},getSelectedGrades:function(){var t=[];return _.each(this.getSelected(),function(e){t=t.concat(e.get("grades"))}),t}}),Ibles.package("Ibles.models"),Ibles.models.Taxonomy=Backbone.Model.fullExtend({initialize:function(){this.categoryCollection=new Ibles.collections.CategoryCollection(Ibles.pageContext.taxonomy||[]),this.originalData=[]},clone:function(){var e=new Ibles.models.Taxonomy;return e.categoryCollection.reset(this.originalData,{parse:!0}),e},fetch:function(){var t=this;return this.fetchPromise().done(function(e){t.originalData=e,t.categoryCollection.reset(e,{parse:!0}),t.trigger("taxonomyLoaded")})},fetchPromise:function(){return Ibles.taxonomyPromise||(Ibles.taxonomyPromise=Ibles.API.get({url:Ibles.reverseUrls.getTaxonomyUrl()})),Ibles.taxonomyPromise},getChannelsInCategory:function(e){return this.categoryCollection.getChannelsInCategory(e)},getChannelInCategory:function(e,t){var n=this.getChannelsInCategory(e);return n&&n.getChannel(t)},hasChannelInCategory:function(e,t){return!!this.getChannelInCategory(e,t)},getCategory:function(e){return this.categoryCollection.get(e)},getTeachersCategory:function(){return this.categoryCollection.get("teachers")},getSubjectsCollection:function(){return this.getTeachersCategory().subjectsCollection},getSubject:function(e){return this.getSubjectsCollection().get(e)},getGradesCollection:function(){return this.getTeachersCategory().gradesCollection},getGrade:function(e){return this.getGradesCollection().get(e)},getGradeGroupForGrade:function(t){return this.getTeachersCategory().gradeGroupsCollection.find(function(e){return _.contains(e.get("grades"),t)})},toFlatBrowsableChannelsList:function(){var t=[];return this.categoryCollection.each(function(e){"teachers"===e.get("name")?(t.push.apply(t,e.get("gradeGroups")),t.push.apply(t,_.filter(e.get("channels"),function(e){return"subject"===e.type}))):t.push.apply(t,e.get("channels"))}),t}}),Ibles.package("Ibles.models"),Ibles.models.Classifier=Backbone.Model.extend({defaults:{classifiable:null,updatePrimary:!0},save:function(){var e=this,t=this.getParams(e.get("classifiable"));return this.trigger("status",{name:"loading"}),Ibles.API.jsonPostRequest("setClassifications",t).done(function(){e.trigger("status",{name:"success"})}).fail(function(){e.trigger("status",{name:"error"})})},getParams:function(e){var t=this.get("updatePrimary"),n={id:e.get("id"),type:this.getTypeParam(e)};return Ibles.setClassificationsPostParam(e,n,t),n},getTypeParam:function(e){var t=e.get("type");return"Guide"==t?"collection":"Step by Step"==t?"project":"topic"}}),Ibles.package("Ibles.models","Ibles.collections"),Ibles.models.MemberModel=Backbone.Model.extend({defaults:function(){return{id:null,screenName:null,downloadUrl:null,following:!1,views:0,commentCount:0,discussionCount:0,featuredCount:0,favoritesCount:0,instructablesCount:0,draftsCount:0,publishedCollectionsCount:0,draftCollectionsCount:0,collaborationsCount:0,followersCount:0,subscriptionsCount:0,draftCourses:[],occupations:[],images:[]}},initialize:function(e,t){t=t||{},this.userDataFetched=!1,this.profileImageCollection=new Ibles.collections.FileCollection(this.get("images")),t.fetchAuthorStats&&this.fetchAuthorStats(),t.fetchUserData&&this.fetchUserData()},getUrl:function(){return Ibles.reverseUrls.memberUrl(this.get("screenName"))},getAvatarFile:function(){return Ibles.fileFromDict(this.attributes)},getProfileImageUrls:function(){return this.profileImageCollection.map(function(e){return e.getMediumUrl()})},fetch:function(){var t=this;return Ibles.API.getRequest("showAuthorModel",{screenName:this.get("screenName")}).done(function(e){t.set(e)})},fetchAuthorStats:function(){var t=this;Ibles.API.getRequest("showAuthorStats",{screenName:this.get("screenName")}).done(function(e){t.set(e)}).always(function(){t.trigger("authorStatsSynced")})},fetchUserData:function(){var t=this;Ibles.session.authenticated()&&(Ibles.session.isAdmin()||Ibles.session.get("screenName")===this.get("screenName"))&&Ibles.API.getRequest("showAuthorUserData",{screenName:this.get("screenName"),cb:Date.now()}).done(function(e){t.set(e),t.profileImageCollection.reset(e.images||[])}).always(function(){t.trigger("userDataSynced"),t.userDataFetched=!0})},toggleFollowing:function(){var t=this;return Ibles.API.postRequest("setFollowing",{memberId:this.get("id"),following:!this.get("following")},{success:function(e){t.set({following:e.following})}})},isFollowing:function(){var t=this;return Ibles.API.getRequest("isFollowing",{screenName:this.get("screenName"),cb:Date.now()},{success:function(e){t.set({following:e.isFollowing||!1})}})},purgeFromCache:function(){return Ibles.API.jsonPostRequest("purgeCaches",{ids:[this.get("id")]})},sendPrivateMessage:function(e,t,n){var i={posted:(new Date).getTime(),body:Ibles.paragraphize(t.replace(/<\/?[^>]+(>|$)/g,"")),subject:e.replace(/<\/?[^>]+(>|$)/g,""),recipientId:this.get("id")},s=this;return _.isEmpty(n)||(i.inReplyToId=n),Ibles.API.baseAjaxPostRequest("/edit/compose/","",i,{success:function(){s.trigger("privateMessageSent")},error:function(){s.trigger("privateMessageError")}})},updateProfile:function(e){var t=this;return Ibles.API.jsonPost(Ibles.URLS.updateProfileUrl(),e).done(function(){Ibles.session.resetForCurrentUser(function(){t.trigger("updateProfileSuccess")})}).fail(function(){t.trigger("updateProfileError")})},updateSettings:function(e){var t=e||{};return Ibles.API.post({url:Ibles.URLS.updateSettingsUrl(),data:t})}}),Ibles.collections.MemberCollection=Backbone.Collection.extend({model:Ibles.models.MemberModel}),Ibles.package("Ibles.models"),Ibles.models.BaseInstructableModel=Backbone.Model.extend({defaults:function(){return{id:null,title:null,urlString:null,fullUrl:null,author:null,type:null,status:null,classifications:[],category:null,channel:null,publishDate:null,favorite:!1,flagged:!1,fetchUserData:!1,fetchStats:!1,resourceType:null,collaborators:[],indexTags:[],submissions:[],coverImage:null}},initialize:function(e){this.author=new Ibles.models.MemberModel(this.get("author")),this.set({favorite:e&&e.favorite}),this.get("fetchUserData")&&this.fetchUserData(),this.get("fetchStats")&&this.fetchStats()},fetch:function(){var t=this;return Ibles.API.getRequest("showInstructableModel",{id:this.get("id")}).done(function(e){t.set(t.parse(e)),e.author&&t.author.set(e.author)})},parse:function(e){return Ibles.setPrimaryClassificationDetails(e),Ibles.deepExtend(Ibles.pageContext.ibleData,e),e},fetchUserData:function(){var t;Ibles.session.authenticated()&&(t=this,Ibles.API.getRequest("showInstructableUserData",{id:this.get("id"),rand:Math.round((new Date).getTime()/1e3)}).done(function(e){"LIMBO"!==e.status||_.isUndefined(e.limboDate)||(e.status="SPAM"),t.set(t.parse(e)),t.author.set({following:e.following})}).always(function(){t.trigger("userDataSynced")}))},fetchStats:function(){var t=this;return Ibles.API.getRequest("getIbleStats",{id:this.get("id")},{success:function(e){t.set(e)}},["views","favorites","comments"])},flagAction:function(){var e=this;return Ibles.API.ajaxRequest("flag/",{entryID:this.get("id"),action:"SET",flag:this.get("flaggedAs")},{success:function(){e.set({flagged:!0})}})},favoriteAction:function(){var e=this;return Ibles.API.ajaxRequest("favorite/",{entryId:this.get("id")},{success:function(){e.set({favorite:!e.get("favorite")})}})},isFavorite:function(){var t=this;return Ibles.API.getRequest("isFavorite",{id:this.get("id")},{success:function(e){t.set({favorite:e.isFavorite})}})},isOwner:function(e){return this.author.get("id")===e},currentUserIsOwner:function(){var e=Ibles.session;return e.authenticated()&&this.isOwner(e.get("id"))},isCollaborator:function(){var e=this.get("collaborators");return!_.isEmpty(e)&&!_.isEmpty(_.findWhere(e,{id:Ibles.session.get("id")}))},isEditableByCurrentUser:function(){var e=Ibles.session,t=e.get("id");return e.isAdmin()||this.isOwner(t)||this.isCollaborator(t)||e.canEditMakeyMakeyResource()||e.canSetIndexTags()||e.canEditKeywords()||e.canEditClassifications()},getNonInternalIndexTags:function(){return _.without(this.get("indexTags")||[],"internal")},toJSON:function(){var e=Backbone.Model.prototype.toJSON.apply(this,arguments);return e.url=Ibles.reverseUrls.ibleUrl(e.id),e},getPdfUrl:function(){return"/json-api/viewPdf?id={0}".format(this.get("id"))},getEditUrl:function(){return"Guide"===this.get("type")?Ibles.reverseUrls.collectionEditUrl(this.get("id")):Ibles.reverseUrls.ibleEditUrl(this.get("id"))},getFiles:function(){var n=$.Deferred();return this.getFilesPromise||("Step by Step"!==this.get("type")?n.resolve([]):Ibles.API.getRequest("getFiles",{instructableId:this.get("id")},{success:function(e){var t=e.files.map(function(e){return new Ibles.collections.FileCollection(e||[])});n.resolve(t)}}),this.getFilesPromise=n.promise()),this.getFilesPromise},getPhotosetFiles:function(){var t=$.Deferred();return this.getFiles().done(function(e){var n=[];_.each(e,function(e){var t;!e.length||(t=e.filter(function(e){return e.get("image")})).length&&n.push(new Ibles.collections.FileCollection(t))}),t.resolve(n)}),t.promise()},getNonImageFileCollection:function(){var n=$.Deferred();return this.getFiles().done(function(e){var t=new Ibles.collections.FileCollection([]);_.each(e,function(e){e.length&&t.add(e.filter(function(e){return!e.get("image")}))}),n.resolve(t)}),n.promise()},fetchPdfAsBinary:function(){var n=this.get("urlString")+".pdf",i=$.Deferred();return window.JSZipUtils.getBinaryContent(this.getPdfUrl(),function(e,t){i.resolve({fileName:n,error:e,data:t})}),i.promise()},fetchAttachmentsAsBinary:function(){var n=$.Deferred();return this.getNonImageFileCollection().done(function(e){var s=[];e.each(function(e){var n=$.Deferred(),t=e.getDownloadUrl(),i=e.get("name");s.push(n),window.JSZipUtils.getBinaryContent(t,function(e,t){n.resolve({fileName:i,error:e,data:t})})}),$.when.apply($,s).always(function(){for(var e=[],t=0;t<arguments.length;t++)e.push(arguments[t]);n.resolve(e)})}),n.promise()},downloadZipBundle:function(){var s=this,r=$.Deferred();return s.fetchPdfAsBinary().done(function(i){i.error?r.reject(i.error):s.fetchAttachmentsAsBinary().done(function(e){var t=new window.JSZip,n=t.folder(s.get("urlString"));n.file(i.fileName,i.data,{binary:!0}),_.each(e,function(e){e.error||n.file(e.fileName,e.data,{binary:!0})}),t.generateAsync({type:"blob"}).then(function(e){saveAs(e,s.get("urlString")+".zip"),r.resolve()})})}),r.promise()}}),Ibles.package("Ibles.models"),Ibles.models.InstructableModel=Ibles.models.BaseInstructableModel.fullExtend({defaults:function(){return{disableComments:!1,allSteps:!1,currentStepIndex:0}},initialize:function(e,t){this._super(e,t),this.set({fullUrl:Ibles.pageContext.remoteHost+this.getUrl()})},getUrl:function(){var e=Ibles.reverseUrls;return"UNPUBLISHED"===this.get("status")?e.previewUrl(this.get("id")):e.ibleUrl(this.get("urlString")||this.get("id"))}}),Ibles.package("Ibles.collections"),Ibles.collections.InstructableCollection=Backbone.Collection.extend({model:Ibles.models.InstructableModel}),Ibles.package("Ibles.services"),Ibles.services.ImageRotationService=Backbone.Model.extend({rotateFileId:function(e,t){return Ibles.API.put({url:Ibles.apiUrl("file"),data:JSON.stringify({id:e,customRotation:t}),contentType:"application/json"})},rotateFileUrl:function(e,t){var n=e.split("/").pop().replace(/\..*/,"");return this.rotateFileId(n,t)}}),$.browser={version:8,msie:0<window.navigator.userAgent.indexOf("MSIE ")},function(e,t,m){var i=m(e),s=m(t),p=m.fancybox=function(){p.open.apply(this,arguments)},n=!1,r=void 0!==t.createTouch;m.extend(p,{version:"2.0.5",defaults:{padding:15,margin:20,width:800,height:600,minWidth:100,minHeight:100,maxWidth:9999,maxHeight:9999,autoSize:!0,autoResize:!r,autoCenter:!r,fitToView:!0,aspectRatio:!1,topRatio:.5,fixed:!(m.browser.msie&&m.browser.version<=6||r),scrolling:"auto",wrapCSS:"fancybox-default",arrows:!0,closeBtn:!0,closeClick:!1,nextClick:!1,mouseWheel:!0,autoPlay:!1,playSpeed:3e3,preload:3,modal:!1,loop:!0,ajax:{dataType:"html",headers:{"X-fancyBox":!0}},keys:{next:[13,32,34,39,40],prev:[8,33,37,38],close:[27]},tpl:{wrap:'<div class="fancybox-wrap"><div class="fancybox-outer"><div class="fancybox-inner"></div></div></div>',image:'<img class="fancybox-image" src="{href}" alt="" />',iframe:'<iframe class="fancybox-iframe" name="fancybox-frame{rnd}" frameborder="0" hspace="0"'+(m.browser.msie?' allowtransparency="true"':"")+"></iframe>",swf:'<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" width="100%" height="100%"><param name="wmode" value="transparent" /><param name="allowfullscreen" value="true" /><param name="allowscriptaccess" value="always" /><param name="movie" value="{href}" /><embed src="{href}" type="application/x-shockwave-flash" allowfullscreen="true" allowscriptaccess="always" width="100%" height="100%" wmode="transparent"></embed></object>',error:'<p class="fancybox-error">The requested content cannot be loaded.<br/>Please try again later.</p>',closeBtn:'<div title="Close" class="fancybox-item fancybox-close"></div>',next:'<a title="Next" class="fancybox-nav fancybox-next"><span></span></a>',prev:'<a title="Previous" class="fancybox-nav fancybox-prev"><span></span></a>'},openEffect:"fade",openSpeed:250,openEasing:"swing",openOpacity:!0,openMethod:"zoomIn",closeEffect:"fade",closeSpeed:250,closeEasing:"swing",closeOpacity:!0,closeMethod:"zoomOut",nextEffect:"elastic",nextSpeed:300,nextEasing:"swing",nextMethod:"changeIn",prevEffect:"elastic",prevSpeed:300,prevEasing:"swing",prevMethod:"changeOut",helpers:{overlay:{speedIn:0,speedOut:300,opacity:.8,css:{cursor:"pointer"},closeClick:!0},title:{type:"float"}}},group:{},opts:{},coming:null,current:null,isOpen:!1,isOpened:!1,wrap:null,outer:null,inner:null,player:{timer:null,isActive:!1},ajaxLoad:null,imgPreload:null,transitions:{},helpers:{},open:function(e,t){p.close(!0),e&&!m.isArray(e)&&(e=e instanceof m?m(e).get():[e]),p.isActive=!0,p.opts=m.extend(!0,{},p.defaults,t),m.isPlainObject(t)&&void 0!==t.keys&&(p.opts.keys=!!t.keys&&m.extend({},p.defaults.keys,t.keys)),p.group=e,p._start(p.opts.index||0)},cancel:function(){p.coming&&!1===p.trigger("onCancel")||(p.coming=null,p.hideLoading(),p.ajaxLoad&&p.ajaxLoad.abort(),p.ajaxLoad=null,p.imgPreload&&(p.imgPreload.onload=p.imgPreload.onabort=p.imgPreload.onerror=null))},close:function(e){p.cancel(),p.current&&!1!==p.trigger("beforeClose")&&(p.unbindEvents(),!p.isOpen||e&&!0===e[0]?(m(".fancybox-wrap").stop().trigger("onReset").remove(),p._afterZoomOut()):(p.isOpen=p.isOpened=!1,m(".fancybox-item, .fancybox-nav").remove(),p.wrap.stop(!0).removeClass("fancybox-opened"),p.inner.css("overflow","hidden"),p.transitions[p.current.closeMethod]()))},play:function(e){function t(){clearTimeout(p.player.timer)}function n(){t(),p.current&&p.player.isActive&&(p.player.timer=setTimeout(p.next,p.current.playSpeed))}function i(){t(),m("body").unbind(".player"),p.player.isActive=!1,p.trigger("onPlayEnd")}p.player.isActive||e&&!1===e[0]?i():p.current&&(p.current.loop||p.current.index<p.group.length-1)&&(p.player.isActive=!0,m("body").bind({"afterShow.player onUpdate.player":n,"onCancel.player beforeClose.player":i,"beforeLoad.player":t}),n(),p.trigger("onPlayStart"))},next:function(){p.current&&p.jumpto(p.current.index+1)},prev:function(){p.current&&p.jumpto(p.current.index-1)},jumpto:function(e){p.current&&(e=parseInt(e,10),1<p.group.length&&p.current.loop&&(e>=p.group.length?e=0:e<0&&(e=p.group.length-1)),void 0!==p.group[e]&&(p.cancel(),p._start(e)))},reposition:function(e){p.isOpen&&p.wrap.css(p._getPosition(e))},update:function(t){p.isOpen&&(n||setTimeout(function(){var e=p.current;n&&(n=!1,e)&&((e.autoResize||t&&"orientationchange"===t.type)&&(e.autoSize&&(p.inner.height("auto"),e.height=p.inner.height()),p._setDimension(),e.canGrow&&p.inner.height("auto")),e.autoCenter&&p.reposition(),p.trigger("onUpdate"))},100),n=!0)},toggle:function(){p.isOpen&&(p.current.fitToView=!p.current.fitToView,p.update())},hideLoading:function(){m("#fancybox-loading").remove()},showLoading:function(){p.hideLoading(),m('<div id="fancybox-loading"><div></div></div>').click(p.cancel).appendTo("body")},getViewport:function(){return{x:i.scrollLeft(),y:i.scrollTop(),w:i.width(),h:i.height()}},unbindEvents:function(){p.wrap&&p.wrap.unbind(".fb"),s.unbind(".fb"),i.unbind(".fb")},bindEvents:function(){var e=p.current,n=e.keys;e&&(i.bind("resize.fb, orientationchange.fb",p.update),n&&s.bind("keydown.fb",function(e){var t;e.ctrlKey||e.altKey||e.shiftKey||e.metaKey||!(m.inArray(e.target.tagName.toLowerCase(),["input","textarea","select","button"])<0)||(t=e.keyCode,-1<m.inArray(t,n.close)?(p.close(),e.preventDefault()):-1<m.inArray(t,n.next)?(p.next(),e.preventDefault()):-1<m.inArray(t,n.prev)&&(p.prev(),e.preventDefault()))}),m.fn.mousewheel&&e.mouseWheel&&1<p.group.length&&p.wrap.bind("mousewheel.fb",function(e,t){var n=m(e.target).get(0);(0===n.clientHeight||n.scrollHeight===n.clientHeight&&n.scrollWidth===n.clientWidth)&&(e.preventDefault(),p[0<t?"prev":"next"]())}))},trigger:function(n){var e,i=p[-1<m.inArray(n,["onCancel","beforeLoad","afterLoad"])?"coming":"current"];if(i){if(m.isFunction(i[n])&&(e=i[n].apply(i,Array.prototype.slice.call(arguments,1))),!1===e)return!1;i.helpers&&m.each(i.helpers,function(e,t){t&&void 0!==p.helpers[e]&&m.isFunction(p.helpers[e][n])&&p.helpers[e][n](t,i)}),m.event.trigger(n+".fb")}},isImage:function(e){return e&&e.match(/\.(jpg|gif|png|bmp|jpeg)(.*)?$/i)},isSWF:function(e){return e&&e.match(/\.(swf)(.*)?$/i)},_start:function(e){var n,t,i,s={},r=p.group[e]||null;r&&(r.nodeType||r instanceof m)&&(n=!0,m.metadata&&(s=m(r).metadata())),s=m.extend(!0,{},p.opts,{index:e,element:r},m.isPlainObject(r)?r:s),m.each(["href","title","content","type"],function(e,t){s[t]=p.opts[t]||n&&m(r).attr(t)||s[t]||null}),"number"==typeof s.margin&&(s.margin=[s.margin,s.margin,s.margin,s.margin]),s.modal&&m.extend(!0,s,{closeBtn:!1,closeClick:!1,nextClick:!1,arrows:!1,mouseWheel:!1,keys:null,helpers:{overlay:{css:{cursor:"auto"},closeClick:!1}}}),p.coming=s,!1===p.trigger("beforeLoad")?p.coming=null:(t=s.type,e=s.href||r,t||(!n||!m(r).data("fancybox-type")&&r.className&&(t=(i=r.className.match(/fancybox\.(\w+)/))?i[1]:null),t||"string"!==m.type(e)||(p.isImage(e)?t="image":p.isSWF(e)?t="swf":e.match(/^#/)&&(t="inline")),t=t||(n?"inline":"html"),s.type=t),"inline"===t||"html"===t?(s.content||(s.content="inline"===t?m("string"===m.type(e)?e.replace(/.*(?=#[^\s]+$)/,""):e):r),s.content&&s.content.length||(t=null)):e||(t=null),s.group=p.group,s.isDom=n,s.href=e,"image"===t?p._loadImage():"ajax"===t?p._loadAjax():t?p._afterLoad():p._error("type"))},_error:function(e){p.hideLoading(),m.extend(p.coming,{type:"html",autoSize:!0,minHeight:0,hasError:e,content:p.coming.tpl.error}),p._afterLoad()},_loadImage:function(){p.imgPreload=new Image,p.imgPreload.onload=function(){this.onload=this.onerror=null,p.coming.width=this.width,p.coming.height=this.height,p._afterLoad()},p.imgPreload.onerror=function(){this.onload=this.onerror=null,p._error("image")},p.imgPreload.src=p.coming.href,p.imgPreload.width||p.showLoading()},_loadAjax:function(){p.showLoading(),p.ajaxLoad=m.ajax(m.extend({},p.coming.ajax,{url:p.coming.href,error:function(e,t){"abort"!==t?p._error("ajax",e):p.hideLoading()},success:function(e,t){"success"===t&&(p.coming.content=e,p._afterLoad())}}))},_preloadImages:function(){var e,t=p.group,n=p.current,i=t.length;if(n.preload&&!(t.length<2))for(var s=1;s<=Math.min(n.preload,i-1);s++)e=t[(n.index+s)%i],(e=m(e).attr("href")||e)&&((new Image).src=e)},_afterLoad:function(){p.hideLoading(),p.coming&&!1!==p.trigger("afterLoad",p.current)?(p.isOpened?(m(".fancybox-item").remove(),p.wrap.stop(!0).removeClass("fancybox-opened"),p.inner.css("overflow","hidden"),p.transitions[p.current.prevMethod]()):(m(".fancybox-wrap").stop().trigger("onReset").remove(),p.trigger("afterClose")),p.unbindEvents(),p.isOpen=!1,p.current=p.coming,p.wrap=m(p.current.tpl.wrap).addClass("fancybox-"+(r?"mobile":"desktop")+" fancybox-tmp "+p.current.wrapCSS).appendTo("body"),p.outer=m(".fancybox-outer",p.wrap).css("padding",p.current.padding+"px"),p.inner=m(".fancybox-inner",p.wrap),p._setContent()):p.coming=!1},_setContent:function(){var e,t,n=p.current,i=n.type;switch(i){case"inline":case"ajax":case"html":(e=n.content)instanceof m&&((e=e.show().detach()).parent().hasClass("fancybox-inner")&&e.parents(".fancybox-wrap").trigger("onReset").remove(),m(p.wrap).bind("onReset",function(){e.appendTo("body").hide()})),n.autoSize&&(t=m('<div class="fancybox-tmp '+p.current.wrapCSS+'"></div>').appendTo("body").append(e),n.width=t.width(),n.height=t.height(),t.width(p.current.width),t.height()>n.height&&(t.width(n.width+1),n.width=t.width(),n.height=t.height()),e=t.contents().detach(),t.remove());break;case"image":e=n.tpl.image.replace("{href}",n.href),n.aspectRatio=!0;break;case"swf":e=n.tpl.swf.replace(/\{width\}/g,n.width).replace(/\{height\}/g,n.height).replace(/\{href\}/g,n.href)}if("iframe"===i){if(e=m(n.tpl.iframe.replace("{rnd}",(new Date).getTime())).attr("scrolling",n.scrolling),n.scrolling="auto",n.autoSize)return e.width(n.width),p.showLoading(),void e.data("ready",!1).appendTo(p.inner).bind({onCancel:function(){m(this).unbind(),p._afterZoomOut()},load:function(){var e,t=m(this);try{this.contentWindow.document.location&&(e=t.contents().find("body").height()+12,t.height(e))}catch(e){n.autoSize=!1}!1===t.data("ready")?(p.hideLoading(),e&&(p.current.height=e),p._beforeShow(),t.data("ready",!0)):e&&p.update()}}).attr("src",n.href);e.attr("src",n.href)}else"image"!==i&&"swf"!==i||(n.autoSize=!1,n.scrolling="visible");p.inner.append(e),p._beforeShow()},_beforeShow:function(){p.coming=null,p.trigger("beforeShow"),p._setDimension(),p.wrap.hide().removeClass("fancybox-tmp"),p.bindEvents(),p._preloadImages(),p.transitions[p.isOpened?p.current.nextMethod:p.current.openMethod]()},_setDimension:function(){var e,t=p.wrap,n=p.outer,i=p.inner,s=p.current,r=p.getViewport(),o=s.margin,a=2*s.padding,l=s.width,c=s.height,d=s.maxWidth,u=s.maxHeight,h=s.minWidth,f=s.minHeight;if(r.w-=o[1]+o[3],r.h-=o[0]+o[2],-1<l.toString().indexOf("%")&&(l=(r.w-a)*parseFloat(l)/100),-1<c.toString().indexOf("%")&&(c=(r.h-a)*parseFloat(c)/100),o=l/c,l+=a,c+=a,s.fitToView&&(d=Math.min(r.w,d),u=Math.min(r.h,u)),s.aspectRatio?(d<l&&(c=((l=d)-a)/o+a),u<c&&(l=((c=u)-a)*o+a),l<h&&(c=((l=h)-a)/o+a),c<f&&(l=((c=f)-a)*o+a)):(l=Math.max(h,Math.min(l,d)),c=Math.max(f,Math.min(c,u))),l=Math.round(l),c=Math.round(c),m(t.add(n).add(i)).width("auto").height("auto"),i.width(l-a).height(c-a),t.width(l),e=t.height(),d<l||u<e)for(;(d<l||u<e)&&h<l&&f<e;)c-=10,s.aspectRatio?(l=Math.round((c-a)*o+a))<h&&(c=((l=h)-a)/o+a):l-=10,i.width(l-a).height(c-a),t.width(l),e=t.height();s.dim={width:l,height:e},s.canGrow=s.autoSize&&f<c&&c<u,s.canShrink=!1,s.canExpand=!1,l-a<s.width||c-a<s.height?s.canExpand=!0:(l>r.w||e>r.h)&&h<l&&f<c&&(s.canShrink=!0),t=e-a,p.innerSpace=t-i.height(),p.outerSpace=t-n.height()},_getPosition:function(e){var t=p.current,n=p.getViewport(),i=t.margin,s=p.wrap.width()+i[1]+i[3],r=p.wrap.height()+i[0]+i[2],o={position:"absolute",top:i[0]+n.y,left:i[3]+n.x};return t.fixed&&(!e||!1===e[0])&&r<=n.h&&s<=n.w&&(o={position:"fixed",top:i[0],left:i[3]}),o.top=Math.ceil(Math.max(o.top,o.top+(n.h-r)*t.topRatio))+"px",o.left=Math.ceil(Math.max(o.left,o.left+.5*(n.w-s)))+"px",o},_afterZoomIn:function(){var e=p.current,t=e.scrolling;p.isOpen=p.isOpened=!0,p.wrap.addClass("fancybox-opened").css("overflow","visible"),p.update(),p.inner.css("overflow","yes"===t?"scroll":"no"===t?"hidden":t),(e.closeClick||e.nextClick)&&p.inner.css("cursor","pointer").bind("click.fb",e.nextClick?p.next:p.close),e.closeBtn&&m(e.tpl.closeBtn).appendTo(p.outer).bind("click.fb",p.close),e.arrows&&1<p.group.length&&((e.loop||0<e.index)&&m(e.tpl.prev).appendTo(p.inner).bind("click.fb",p.prev),(e.loop||e.index<p.group.length-1)&&m(e.tpl.next).appendTo(p.inner).bind("click.fb",p.next)),p.trigger("afterShow"),p.opts.autoPlay&&!p.player.isActive&&(p.opts.autoPlay=!1,p.play())},_afterZoomOut:function(){p.trigger("afterClose"),p.wrap.trigger("onReset").remove(),m.extend(p,{group:{},opts:{},current:null,isActive:!1,isOpened:!1,isOpen:!1,wrap:null,outer:null,inner:null})}}),p.transitions={getOrigPosition:function(){var e=p.current,t=e.element,n=e.padding,i=m(e.orig),s={},r=50,o=50;return!i.length&&e.isDom&&m(t).is(":visible")&&((i=m(t).find("img:first")).length||(i=m(t))),i.length?(s=i.offset(),i.is("img")&&(r=i.outerWidth(),o=i.outerHeight())):(e=p.getViewport(),s.top=e.y+.5*(e.h-o),s.left=e.x+.5*(e.w-r)),{top:Math.ceil(s.top-n)+"px",left:Math.ceil(s.left-n)+"px",width:Math.ceil(r+2*n)+"px",height:Math.ceil(o+2*n)+"px"}},step:function(e,t){var n,i,s;"width"!==t.prop&&"height"!==t.prop||(i=s=Math.ceil(e-2*p.current.padding),"height"===t.prop&&(n=(e-t.start)/(t.end-t.start),t.start>t.end&&(n=1-n),i-=p.innerSpace*n,s-=p.outerSpace*n),p.inner[t.prop](i),p.outer[t.prop](s))},zoomIn:function(){var e,t=p.wrap,n=p.current,i=n.dim;"elastic"===n.openEffect?(delete(e=m.extend({},i,p._getPosition(!0))).position,i=this.getOrigPosition(),n.openOpacity&&(i.opacity=0,e.opacity=1),p.outer.add(p.inner).width("auto").height("auto"),t.css(i).show(),t.animate(e,{duration:n.openSpeed,easing:n.openEasing,step:this.step,complete:p._afterZoomIn})):(t.css(m.extend({},i,p._getPosition())),"fade"===n.openEffect?t.fadeIn(n.openSpeed,p._afterZoomIn):(t.show(),p._afterZoomIn()))},zoomOut:function(){var e,t=p.wrap,n=p.current;"elastic"===n.closeEffect?("fixed"===t.css("position")&&t.css(p._getPosition(!0)),e=this.getOrigPosition(),n.closeOpacity&&(e.opacity=0),t.animate(e,{duration:n.closeSpeed,easing:n.closeEasing,step:this.step,complete:p._afterZoomOut})):t.fadeOut("fade"===n.closeEffect?n.closeSpeed:0,p._afterZoomOut)},changeIn:function(){var e,t=p.wrap,n=p.current;"elastic"===n.nextEffect?((e=p._getPosition(!0)).opacity=0,e.top=parseInt(e.top,10)-200+"px",t.css(e).show().animate({opacity:1,top:"+=200px"},{duration:n.nextSpeed,easing:n.nextEasing,complete:p._afterZoomIn})):(t.css(p._getPosition()),"fade"===n.nextEffect?t.hide().fadeIn(n.nextSpeed,p._afterZoomIn):(t.show(),p._afterZoomIn()))},changeOut:function(){function e(){m(this).trigger("onReset").remove()}var t=p.wrap,n=p.current;t.removeClass("fancybox-opened"),"elastic"===n.prevEffect?t.animate({opacity:0,top:"+=200px"},{duration:n.prevSpeed,easing:n.prevEasing,complete:e}):t.fadeOut("fade"===n.prevEffect?n.prevSpeed:0,e)}},p.helpers.overlay={overlay:null,update:function(){var e;this.overlay.width(0).height(0),e=m.browser.msie?(e=Math.max(t.documentElement.scrollWidth,t.body.scrollWidth))<Math.max(t.documentElement.offsetWidth,t.body.offsetWidth)?i.width():e:s.width(),this.overlay.width(e).height(s.height())},beforeShow:function(e){this.overlay||(e=m.extend(!0,{speedIn:"fast",closeClick:!0,opacity:1,css:{background:"black"}},e),this.overlay=m('<div id="fancybox-overlay"></div>').css(e.css).appendTo("body"),this.update(),e.closeClick&&this.overlay.bind("click.fb",p.close),i.bind("resize.fb",m.proxy(this.update,this)),this.overlay.fadeTo(e.speedIn,e.opacity))},onUpdate:function(){this.update()},afterClose:function(e){this.overlay&&this.overlay.fadeOut(e.speedOut||0,function(){m(this).remove()}),this.overlay=null}},p.helpers.title={beforeShow:function(e){var t;(t=p.current.title)&&(t=m('<div class="fancybox-title fancybox-title-'+e.type+'-wrap">'+t+"</div>").appendTo("body"),"float"===e.type&&(t.width(t.width()),t.wrapInner('<span class="child"></span>'),p.current.margin[2]+=Math.abs(parseInt(t.css("margin-bottom"),10))),t.appendTo("over"===e.type?p.inner:"outside"===e.type?p.wrap:p.outer))}},m.fn.fancybox=function(r){function e(e){var t=this,n="rel",i=t[n],s=l;e.ctrlKey||e.altKey||e.shiftKey||e.metaKey||(e.preventDefault(),i||(n="data-fancybox-group",i=m(t).attr("data-fancybox-group")),i&&""!==i&&"nofollow"!==i&&(s=(t=(t=a.length?m(a):o).filter("["+n+'="'+i+'"]')).index(this)),r.index=s,p.open(t,r))}var o=m(this),a=this.selector||"",l=(r=r||{}).index||0;return a?s.undelegate(a,"click.fb-start").delegate(a,"click.fb-start",e):o.unbind("click.fb-start").bind("click.fb-start",e),this}}(window,document,jQuery),function(i,s){var e=i(window);i.extend(s.defaults,{wrapCSS:"ible-fancybox",scrolling:"visible",aspectRatio:!0,loop:!1,prevSpeed:600,nextSpeed:600,keys:{next:[13,32,39],prev:[37],close:[27]},helpers:{overlay:null,PhotosetOverlay:{}}}),s.transitions.changeIn=function(){var e=s.wrap,t=s.current,n=s._getPosition(!0);s.isForward?(n.left=parseInt(n.left,10)+1500+"px",e.css(n).show().animate({left:"-=1500px"},{duration:t.nextSpeed,complete:s._afterZoomIn})):(n.left=parseInt(n.left,10)-1500+"px",e.css(n).show().animate({left:"+=1500px"},{duration:t.nextSpeed,complete:s._afterZoomIn}))},s.transitions.changeOut=function(){var e,t=s.wrap,n=s.current;t.removeClass("fancybox-opened"),e=s.isForward?"-=1500px":"+=1500px","elastic"===n.prevEffect&&t.animate({opacity:.4,left:e},{duration:n.prevSpeed,complete:function(){i(this).trigger("onReset").remove()}})},s.next=function(){s.current&&(s.isForward=!0,s.jumpto(s.current.index+1))},s.prev=function(){s.current&&(s.isForward=!1,s.jumpto(s.current.index-1))},s.closeOrig=s.close,s.close=function(e){var t;("object"!=typeof e||!e.target||(t=i(e.target)).attr("id")===s.overlayId||t.hasClass("fancybox-close")&&i(this).attr("id")!==s.overlayId||t.hasClass("transparency"))&&s.closeOrig(e)},s._afterZoomOut=function(){s.trigger("afterClose")},s.getViewport=function(){return{x:e.scrollLeft(),y:0,w:e.width(),h:e.height()}},s.originalUrl=window.location.href,s.overlayId="ible-fancybox-overlay",s.overlayWrap='<div id="'+s.overlayId+'"><div class="transparency"></div></div>',s.helpers.PhotosetOverlay={overlay:null,beforeLoad:function(e){this.overlay||(e=i.extend(!0,{speedIn:"fast",closeClick:!0},e),this.overlay=i(s.overlayWrap).appendTo("body"),e.closeClick&&this.overlay.bind("click.fb",s.close),this.overlay.fadeTo(e.speedIn,e.opacity))},beforeShow:function(e){s.wrap.detach().appendTo("div#"+s.overlayId)},afterClose:function(e){s.wrap.trigger("onReset").remove(),this.overlay&&(this.overlay.remove(),this.overlay=null),i.extend(s,{group:{},opts:{},current:null,isActive:!1,isOpened:!1,isOpen:!1,wrap:null,outer:null,inner:null})}}}(jQuery,jQuery.fancybox),Ibles.views.FancyboxView=Backbone.View.extend({initialize:function(e){_.bindAll(this,"beforeShow","afterShow","afterClose"),this.menuBarView=null,this.opts=e,this.opts.targets.fancybox({beforeShow:this.beforeShow,afterShow:this.afterShow,afterClose:this.afterClose})},beforeShow:function(){this.cleanupMenuBar()},afterShow:function(){this.opts.afterShow&&this.opts.afterShow();var e=this.getCurrentImageUrl();Ibles.isGif(e)?this.swapGifWithVideo():Ibles.isCdnUrl(e)&&this.setupMenuBar()},afterClose:function(){this.cleanupMenuBar()},setupMenuBar:function(){var e=this.opts.canRotate;this.menuBarView=new Ibles.views.FancyboxMenuBar({el:$("#ible-fancybox-overlay"),showRotateOption:e&&e()})},cleanupMenuBar:function(){this.menuBarView&&(this.menuBarView.destroy(),this.menuBarView=null)},getCurrentImageUrl:function(){return $.fancybox.current.href},swapGifWithVideo:function(){var e=this.getCurrentImageUrl();Ibles.isGif(e)&&$("#ible-fancybox-overlay").find(".fancybox-image").replaceWith($("<video>",{class:"gif-video",autoplay:!0,muted:!0,playsinline:!0,controls:!0,src:Ibles.updateQueryParameter(e,"format","mp4")}).show())}}),Ibles.views.FancyboxMenuBar=Backbone.View.extend({events:{"click .image-rotate-angle":"rotate","click .image-rotate-save":"saveRotation"},initialize:function(e){this.angle=0,this.rotationCountSinceLastSave=0,this.$img=this.$(".fancybox-image"),this.$menuBar=null,this.showRotateOption=e.showRotateOption,this.originalHeight=this.$img.height(),this.originalWidth=this.$img.width(),this.appendMenuBar()},destroy:function(){this.$img=null,this.$menuBar=null,this.stopListening(),this.undelegateEvents()},appendMenuBar:function(){this.$menuBar=$('<div class="fancybox-menu-bar">'),$.fancybox.inner.append(this.$menuBar),this.appendDownloadLink(),this.showRotateOption&&(this.appendRotateAction(),this.appendSaveBtn())},appendDownloadLink:function(){this.$menuBar.append($("<a>",{class:"ible-download-link",title:"Download Original",target:"_blank",href:$($.fancybox.current.element).data("download").split("?")[0]}).append($("<img>",{src:Ibles.staticUrl("img/icon-download.png")}))).click(function(){Ibles.gaUserEvent("overlayImageDownload",{eventLabel:"photoset",eventValue:!0})})},appendRotateAction:function(){this.$menuBar.append($("<a>",{class:"image-rotate-angle",title:"Rotate Image"}).append($("<img>",{src:Ibles.staticUrl("svg/rotate.svg")})))},appendSaveBtn:function(){this.$menuBar.append($("<a>",{class:"image-rotate-save btn btn-orange",title:"Save Image"}).data({"loading-text":"Loading...","failed-text":"Failed","complete-text":"Success!"}).text("Save"))},rotate:function(){var e=this.originalHeight,t=this.originalWidth,n=0,i=1;switch(this.angle){case 0:n=90,i=e<=t?e/t:t/e;break;case 90:n=180,i=1;break;case 180:n=270,i=e<=t?e/t:t/e;break;case 270:n=0,i=1}this.angle=n,this.rotationCountSinceLastSave++,this.transform(this.$img,i,n),this.$(".image-rotate-save").show()},transform:function(e,t,n){var i="scale({0}) rotate({1}deg)".format(t,n),s=e.get(0);s.style.WebkitTransform=i,s.style.msTransform=i,s.style.transform=i},saveRotation:function(e){var s=this,t=$.fancybox.current,r=t.href,o=$(t.element),n=o.data("fileid"),i=this.rotationCountSinceLastSave%4*90,a=(new Ibles.services.ImageRotationService).rotateFileId(n,i).done(function(e){var t=e.file,n=window.md5(t.modifiedDate),i=r.split("?")[0]+"?md={0}".format(n);o.attr("href",i),o.find("img").attr("src",i),s.rotationCountSinceLastSave=0});Ibles.syncButtonStatesToRequest($(e.currentTarget),a)}}),Ibles.JST.photoset='<[ if (numVideos) {]>\n<div class="videoset-wrapper">   \n    <div class="videoset"></div>\n</div>\n<[}]>\n<[ if (numImages) {]>\n<div class="photoset-wrapper">\n    <div class="photoset"></div>\n</div>\n<[}]> \n',Ibles.JST["videoset-cell"]='<div class="videoset-cell">\n    <div class="videoset-item">\n        << embedHtmlCode >>\n    </div>\n</div>\n',Ibles.JST["photoset-cell"]='<div class="photoset-item photoset-cell" style="-webkit-flex: << aspectRatio >>; flex: << aspectRatio >>;">\n    <div class="photoset-image">\n        <[ if (isGif) {]>\n            <video class="gif-video" controls autoplay muted loop playsinline>\n                <source src="<< mp4Url >>" type="video/mp4">\n            </video>\n        <[ } else { ]>\n            <a class="gallery-link" rel="<< galleryId >>" href="<< overlayImageUrl >>" data-download="<< imageOriginalUrl >>" data-fileid="<< fileId >>">\n                <img class="lazyload" alt="<< title >>" src="<< Ibles.staticUrl(\'img/pixel.png\') >>" data-src="<< resizedImageUrl >>" <[ if (isGif) {]>data-gif-url="<< gifUrl >>"<[}]>>\n                <[ if (!_.isEmpty(imageNotes)) { ]>\n                    <i class="notes-icon"></i>\n                <[ } ]>\n            </a>\n        <[ } ]>\n    </div>\n</div>\n',function(u){u.fn.notes=function(e){var d={init:function(l,e,c){return d.setEditable(e),this.each(function(){var o=u(this),a=u('<div class="note-holder"></div>');return setTimeout(function(){var e,t,n,i,s,r=d.extractInfo(o,c);if(a.addClass(r.imgId),a.attr("id","holder_"+r.imgId),d.placeNoteHolder(a,r),null!=c?c.append(a):u("body").append(a),d.editable&&(a.css({"z-index":200}),d.bindNoteHolder(a)),e=function(e){var t;return e.parentWidth=r.width,e.parentHeight=r.height,e.noteHolder=a,t=[e],d.display.apply(o,t)},l){for(s=[],n=0,i=l.length;n<i;n++)t=l[n],s.push(e(t));return s}},10)})},extractInfo:function(e,t){var n,i=e.width(),s=e.height(),r=e.attr("class"),o=t?e.offsetParent().position():e.offset();return null!=r&&(n=r.indexOf(" ")),{width:i,height:s,offset:o,imgId:null!=n&&-1!==n?r.split(" ")[1]:r}},placeNoteHolder:function(e,t){if(null!=t&&null!=t.offset)return e.css({left:t.offset.left+"px",top:t.offset.top+"px"})},buildNoteInfo:function(e,t){var n,i,s,r,o,a=e.position(),l=e.parent(),c=l.width(),d=l.height(),u=l.attr("class").split(" ")[1].substring(3),h={};return h.action=t,h.imageID=u,r=a.top/d,i=a.left/c,o=e.width()/c,n=e.height()/d,(s=(s=e.find("textarea").val())||e.find(".note-text-value").html())&&(h.text=s.replace(/\n/g,"<br/>").replace(/"/g,'\\"')),h.json='{"top":'+r+',"left":'+i+',"width":'+o+',"height":'+n+',"text":"'+h.text+'"}',h},add:function(t){var n=d.buildNoteInfo(t,"ADD");return u.post("/ajax/imageNote",n,function(e){return t.attr("id",e),t.find(".note-text").html(d.buildTextNode(n.text.replace(/\\"/g,'"'))),d.bind(t)},"text")},buildTextNode:function(e){return u('<div class="note-text-value">'+e+'</div><a class="edit-note" href="#">edit</a>')},buildEditNode:function(e,t){return e=e.replace(/<br>/g,"\n"),u(t?"<textarea>"+e+'</textarea><br/><a class="delete little-button" href="#">delete</a><a class="'+t+' little-button" href="#">save</a>':"<textarea>"+e+'</textarea><br/><a class="delete little-button" href="#">delete</a><a class="save little-button" href="#">save</a>')},save:function(t){var e=d.buildNoteInfo(t,"MODIFY");if(e.noteID=t.attr("id"),e.noteID)return u.post("/ajax/imageNote",e,function(e){return d.bind(t)})},update:function(n){var i=n.find(".note-text"),e=i.find(".note-text-value").html();return i.html(d.buildEditNode(e,"edit")),d.bind(n),i.find("a.edit").click(function(e){var t;return e.preventDefault(),null!=(t=d.buildNoteInfo(n,"MODIFY")).text?(t.noteID=n.attr("id"),u.post("/ajax/imageNote",t,function(e){return i.html(d.buildTextNode(i.find("textarea").val())),d.bind(n)})):feedBack.add("Please enter text in order to save.")})},remove:function(e){var t=d.buildNoteInfo(e,"DELETE");return t.noteID=e.attr("id"),t.noteID&&u.post("/ajax/imageNote",t),e.fadeOut(function(){return e.remove()})},bindNoteHolder:function(t){var n=null;return u("div.note-holder").mousedown(function(e){return e.preventDefault(),n=d.userCreateBox(e,t),d.bind(n,n.height())}),this},display:function(e){var t=Math.round(e.parentWidth*e.left),n=Math.round(e.parentHeight*e.top),i=Math.round(e.parentWidth*e.width),s=Math.round(e.parentHeight*e.height);return d.drawBox({left:t,top:n,width:i,height:s,note:e}),this},drawBox:function(e){var t=e.note.id?e.note.id:e.note.noteID,n=u('<div id="'+t+'" class="note-border"><div class="note-text"><div class="note-text-value">'+e.note.text+"</div></div></div>");return e.note.noteHolder.append(n),d.editable&&n.find(".note-text").append('<a href="#" class="edit-note">edit</a>'),n.css({width:e.width+"px",left:e.left+"px",height:e.height+"px",top:e.top+"px"}),d.bind(n,e.height),this},userCreateBox:function(e,t){var n=u('<div class="note-border"><div class="note-text"></div></div>');return n.find(".note-text").append(d.buildEditNode("")),t.append(n),n.mousedown(function(e){return e.stopPropagation()}),/MSIE (\d+\.\d+);/.test(navigator.userAgent)?n.css({top:e.offsetY+"px",left:e.offsetX+"px",width:"50px",height:"50px"}):n.css({top:e.layerY+"px",left:e.layerX+"px",width:"50px",height:"50px"}),n},updateBoxSize:function(e,t){var n=t.position();return t.css({width:Math.abs(n.left+e.layerX)+"px",height:Math.abs(n.top+e.layerY)+"px"})},setNoteTextTop:function(e,t){return e.css({top:t+"px"})},noteHover:function(e,t,n){var i=this;return e.hover(function(){return clearTimeout(i.timer),d.setNoteTextTop(n,t),u("div.note-text").hide(),n.show()},function(){return clearTimeout(i.timer),i.timer=setTimeout(function(){return n.fadeOut()},1500)})},setEditable:function(e){return this.editable=e,this},bind:function(n,i){var s=n.find("div.note-text"),r=d.noteHover(n,i,s);if(d.editable)return null!=n.resizable&&n.resizable({containment:"parent",start:function(e,t){return s.hide(),n.unbind("hover",r)},resize:function(e,t){return s.hide(),n.unbind("hover",r)},stop:function(e,t){return i=n.height(),r=d.noteHover(n,i,s),d.setNoteTextTop(s,i),d.save(n),s.show()}}),null!=n.draggable&&n.draggable({containment:"parent",stop:function(e,t){return d.save(n)}}),n.mousedown(function(e){return e.stopPropagation()}),s.find("a.save").click(function(e){return e.preventDefault(),d.add(n)}),s.find("a.delete").click(function(e){return e.preventDefault(),d.remove(n)}),s.find("a.edit-note").click(function(e){return e.preventDefault(),d.update(n)})}};return d[e]?d[e].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof e&&e?u.error("Method "+e+" does not exist on jQuery.notes"):d.init.apply(this,arguments)}}(window.jQuery),function(w,l){w.package("Ibles.views");var n={enableCropping:!0,maxRowHeight:700,maxWidth:1200,singleRowAspectRatioMax:.75,minCellAspect:{ratio:2/3,ratioRnded:.7,cropParam:"2:3"},maxCellAspect:{ratio:1.5,ratioRnded:1.5,cropParam:"3:2"},maxImageWidthsByType:{small:320,medium:620,large:1024}};w.views.PhotosetView=Backbone.View.extend({template:_.template(w.JST.photoset),model:null,events:{"click .gallery-link":"renderGalleryOverlay","click .photoset-showmore":"showHiddenRows"},initialize:function(e){var t=_.clone(n);this.title=e.title,this.galleryId=_.uniqueId("photoset"),this.rows=[],this.rowAspectRatios={},this.settings=_.extend(t,_.pick(e,_.keys(t))),this.render(e.fileCollection)},placeImageCellsInRows:function(e){var t=this.setRowAndColIndexForCells,n=e.length,i=[],s=(n-1)%3==0?4:3,r=e.slice(0,s);if(t(r,0),i.push(r),5<=n)for(var o,a=e.slice(s),l=a.length,c=0,d=1;c<l;c+=3,d++)(o=a.slice(c,c+3)).length&&(t(o,d),i.push(o));return this.rows=i},setRowAndColIndexForCells:function(e,n){e.forEach(function(e,t){0==n?(e.setRowIndex(0),e.setColIndex(0==t?0:1)):(e.setRowIndex(n),e.setColIndex(t))})},getRowAspectRatios:function(e){var t,n,i=this.rowAspectRatios[e];return i||(t=this.rows[e],n=0==e&&this.firstRowRequiresMultiDimensionalLayout()?[t[0].aspectRatio,1/_.reduce(t.slice(1),function(e,t){return e+1/t.aspectRatio},0)]:_.map(t,function(e){return e.aspectRatio}),this.rowAspectRatios[e]=n)},firstRowRequiresMultiDimensionalLayout:function(){var e=this.rows[0],t=this.settings.singleRowAspectRatioMax;return 2<e.length&&_.some(_.map(e,function(e){return e.aspectRatio}),function(e){return t<e})},getEffectiveMaxWidth:function(){var e,t,n,i,s,r=this.effectiveMaxWidth;return r||(t=(e=this.settings).maxWidth,n=e.maxRowHeight,i=this.getRowAspectRatios(0),s=_.reduce(i,function(e,t){return e+t},0),this.effectiveMaxWidth=Math.min(n*s,t))},renderGalleryOverlay:function(e){var t=this;e.preventDefault(),new w.views.FancyboxView({targets:this.$(".gallery-link"),afterShow:t.renderImageNotes,canRotate:function(){return t.model.isEditableByCurrentUser()||w.session.isAdmin()}})},renderImageNotes:function(){var e,t,n=$.fancybox.inner,i=$($.fancybox.current.element);n.length&&(e=i.closest(".photoset-cell").data("imagenotes"),t=n.find("img:first"),e&&t.notes(e,!1,n))},showHiddenRows:function(e){e.preventDefault();var n=this.$(".photoset-showmore"),i=this.$(".hidden-row"),t=i.find("img"),s=t.length;this.$(".loading").show(),t.each(function(e,t){t.src=t.getAttribute("data-src"),t.onload=function(){--s||(i.removeClass("hidden-row"),n.remove())}})},render:function(e){var t=e.groupBy(function(e){return"VIDEO"==e.getEmbedType()?"videoFiles":"imageFiles"}),n=t.imageFiles||[],i=t.videoFiles||[],s=n.length,r=i.length,o=$(this.template({numImages:s,numVideos:r}));r&&this.renderVideoFiles(i,o),s&&this.renderImageFiles(n,o),this.$el.append(o)},renderVideoFiles:function(e,t){var n=t.find(".videoset");e.forEach(function(e){var t=new w.views.VideosetCell({file:e});n.append(t.load())})},renderImageFiles:function(m,e){function p(e){var t=l.createElement("div");return t.innerHTML=e,t.firstChild}var g=this,b=e.find(".photoset"),t=m.map(function(e){return new w.views.PhotosetCell({file:e},g)}),n=g.placeImageCellsInRows(t),v=n.length,i=g.settings.maxWidth,s=g.getEffectiveMaxWidth();n.forEach(function(e,t){var n,i,s,r,o,a,l,c=0<t,d=0,u=e.length,h=p('<div class="photoset-row items-{0} {1}"></div>'.format(u,0<t?" hidden-row":"")),f=h;0==t&&g.firstRowRequiresMultiDimensionalLayout()&&(s=g.getRowAspectRatios(0),r=s[1],n=p('<div class="photoset-col" style="-webkit-flex:{0};flex:{1};"></div>'.format(r,r)),h.appendChild(e[0].load(c)),h.appendChild(n),f=n,d=1),e.slice(d).forEach(function(e){i=e.load(c),f.appendChild(i)}),0==t&&1<v&&(o=i,a=m.length-u,l=p('<div class="photoset-showmore"><img class="loading" src="{0}">{1} More Images</div>'.format(w.staticUrl("img/ajax_loader_48px.gif"),a)),o.querySelector(".photoset-image").appendChild(l)),b.append(h)}),s<i&&(b.get(0).style.maxWidth=s+"px")}}),w.views.VideosetCell=Backbone.View.extend({template:_.template(w.JST["videoset-cell"]),initialize:function(e){this.file=e.file},load:function(){var e=this.file,t=l.createElement("div");return t.innerHTML=this.template({embedHtmlCode:w.makeSafeForSSL(e.getEmbedHtmlCode())}),t.firstChild}}),w.views.PhotosetCell=Backbone.View.extend({template:_.template(w.JST["photoset-cell"]),initialize:function(e,t){var n=this;n.file=e.file,n.photoset=t,n.rowIndex=0,n.colIndex=0,n.setAspectRatio()},setRowIndex:function(e){this.rowIndex=e},setColIndex:function(e){this.colIndex=e},setAspectRatio:function(){var e,t=this.file,n=t.getWidth()/t.getHeight(),i=Math.round(10*n)/10,s=this.photoset.settings,r=s.minCellAspect,o=s.maxCellAspect,a=r.ratio,l=r.ratioRnded,c=o.ratio,d=o.ratioRnded;i<l?(n=a,e=r.cropParam):d<i&&(n=c,e=o.cropParam),this.aspectRatio=n,this.cropParam=e},load:function(e){var t,n,i=this,s=i.file,r=i.photoset,o=i.template({fileId:s.get("id"),title:r.title,galleryId:r.galleryId,resizedImageUrl:i.getCellImageUrl(),isGif:s.isGif(),gifUrl:s.getLargeAnimationUrl(),mp4Url:s.getMp4Url(),overlayImageUrl:s.getLargeUrl(),imageOriginalUrl:s.getOriginalUrl(),imageNotes:s.getImageNotes(),aspectRatio:i.aspectRatio,lazy:e}),a=l.createElement("div");return a.innerHTML=o,(n=(t=a.firstChild).dataset)&&(n.imagenotes=JSON.stringify(i.file.getImageNotes()||[])),t},getCellImageUrl:function(){var e=this,t=e.file,n=e.photoset,i=e.rowIndex,s=e.colIndex,r=n.settings,o=1<n.rows[i].length,a=r.enableCropping&&(o||!o&&e.aspectRatio<e.maxCropAspectRatio),l=n.getEffectiveMaxWidth(),c=r.maxImageWidthsByType,d=n.getRowAspectRatios(i),u=_.reduce(d,function(e,t){return e+t},0),h=Math.round(d[s]/u*l),f=e.cropParam,m={frame:!0,width:1024,height:1024,fit:"bounds"};return h<t.getWidth()&&h<c.large&&(m.width=h),a&&f&&(m.crop=f),t.getOptimizedImageUrl(m)}})}(Ibles,(window,document)),Ibles.JST["comment-item"]='<article class="post js-comment <[ if (isReply) {]>reply<[}]> <[ if (!visible) {]>hide<[}]>" data-id="<< id >>" data-stepid="<< stepId >>" <[ if (isReply) {]>data-inreplyto="<< replyAuthor >>"<[}]>>\n    <div class="post-header">\n        <div class="meta">\n            <[ if (Ibles.isDesktop()) {]>\n                <div class="votes js-vote-count <[ if (!upvotingEnabled || !rating) {]>hide<[}]>"><< rating >></div>\n            <[}]>\n\n            <div class="avatar">\n                <a href="<< authorUrl >>">\n                    <img <[ if (lazyImage) {]>class="lazyload" src="<< Ibles.staticUrl(\'img/pixel.png\') >>" data-<[}]>src="<< avatar >>">\n                </a>\n            </div>\n            <div class="posted-by">\n                <a class="author" href="<< authorUrl >>"><< author >></a>\n                <[ if (isReply) {]>\n                    <i class="icon-arrow-right"></i>\n                    <button class="replied-to js-reply-parent" href="<< Ibles.reverseUrls.memberUrl(replyAuthor) >>"><< replyAuthor >></button>\n                <[}]>\n                <p class="posted-date">\n                    <[ if (isQuestion) {]>\n                    <span class="label question-label">Question</span>\n                    <[} else if (isTip) {]>\n                    <span class="label tip-label">Tip</span>\n                    <[} else if (isBestAnswer) {]>\n                    <span class="label best-answer-label">Best Answer</span>\n                    <[} else if (!isReply) {]>\n\n                    <[} else {]>\n                         <[ if (isAnswer) {]>Answer<[} else {]>Reply<[}]>\n                    <[}]>\n                    << commentTime >>\n                    <[ if (stepId){ ]>on <a class="step-link" href="#<< stepAnchorId >>"><< stepIndexLabel >></a><[}]>\n                </p>\n            </div>\n        </div>\n        <[ if (Ibles.isDesktop()) {]>\n            <div class="toolbar js-toolbar">\n                <[ if (replyEnabled) {]>\n                    <button class="btn reply-btn js-reply"><[ if (isQuestion) {]>Answer<[}else{]>Reply<[}]></button>\n                <[ } ]>\n                <[ if (upvotingEnabled) {]>\n                    <button class="btn vote-btn js-vote-btn">Upvote</button>\n                <[ } ]>\n                <[ if (isAnswer) {]>\n                    <p class="best-answer-actions">\n                        <button class="btn btn-default js-toggle-best-answer hide"><[ if (isAnswer){]>Select as Best Answer<[}else{]>Undo Best Answer<[}]></button>\n                    </p>\n                <[}]>\n            </div>\n        <[}]>\n    </div>\n\n    <div class="text js-text">\n        <p class="quarantine-message js-quarantine-message"></p>\n        << body >>\n    </div>\n\n    <div class="js-edit-container"></div>\n\n    <div class="photos js-photos"></div>\n    <div class="attachments js-attachments"></div>\n\n    <[ if (lastVisibleInThread) {]>\n        <button class="hidden-replies-link js-show-replies">\n            << numRepliesFromMe >>\n            <[ if (isQuestion || isAnswer) {]>\n                << Ibles.pluralize(numRepliesFromMe, "answer", "answers") >>\n            <[} else {]>\n                << Ibles.pluralize(numRepliesFromMe, "reply", "replies") >>\n            <[}]>\n            <i class="icon-arrow-down"></i>\n        </button>\n    <[}]>\n\n    <[ if (Ibles.isMobile()) {]>\n        <div class="toolbar js-toolbar">\n            <div class="votes js-vote-count <[ if (!upvotingEnabled || !rating) {]>hide<[}]>"><< rating >></div>\n            <button class="btn reply-btn js-reply"><[ if (isQuestion) {]>Answer<[}else{]>Reply<[}]></button>\n            <[ if (upvotingEnabled) {]>\n                <button class="btn vote-btn js-vote-btn">Upvote</button>\n            <[ } ]>\n        </div>\n        <[ if (isAnswer) {]>\n            <p class="best-answer-actions">\n                <button class="btn btn-default js-toggle-best-answer hide"><[ if (isAnswer){]>Select as Best Answer<[}else{]>Undo Best Answer<[}]></button>\n            </p>\n        <[}]>\n    <[}]>\n</article>\n',Ibles.JST["comment-toolbar"]='<div class="toolbar js-toolbar">\n    <[ if (Ibles.isMobile()) {]>\n        <div class="votes js-vote-count <[ if (!rating) {]>hide<[}]>"><< rating >></div>\n    <[}]>\n    <button class="btn reply-btn js-reply">\n        <[ if (isQuestion) {]>Answer<[}else{]>Reply<[}]>\n    </button>\n    <[ if (upvotingEnabled) {]>\n    <button class="btn vote-btn js-vote-btn">Upvote</button>\n    <[ } ]>\n<[ if (Ibles.isMobile()) {]>\n</div>\n<[ } ]>\n<[ if (isAnswer) {]>\n    <p class="best-answer-actions">\n        <a class="btn btn-default js-toggle-best-answer hide"><[ if (isAnswer){]>Select as Best Answer<[}else{]>Undo Best Answer<[}]></a>\n    </p>\n<[}]>\n<[ if (Ibles.isDesktop()) {]>\n</div>\n<[ } ]>\n',Ibles.JST["comment-posting-view"]='<div class="discuss <[ if (!typeSelected) {]>discuss-all<[}]>">\n    <[ if (isMobile) {]>\n    <div class="postbox">\n        <img class="poster" src="<< avatar >>">\n        <p class="policy">We have a <b>be nice</b> policy.<br> Be positive and constructive.</p>\n    </div>\n    <[ } ]>\n    <div class="postbox">\n        <[ if (!isMobile) {]>\n        <img class="poster" src="<< avatar >>">\n        <[ } ]>\n        <div class="field js-redactor-container">\n            <[ if (!typeSelected) {]>\n                <button class="type-btn tip-type js-type-tip"><[ if (isMobile){]>Tip<[}else{]>Add Tip<[}]></button>\n                <button class="type-btn question-type js-type-question"><[ if (isMobile){]>Question<[}else{]>Ask Question<[}]></button>\n                <button class="type-btn comment-type js-type-comment"><[ if (isMobile){]>Comment<[}else{]>Post Comment<[}]></button>\n            <[ } else { ]>\n                <div class="comment-tip redactor-tooltip" data-toggle="tooltip" data-placement="top" title="Highlight text to apply styling"></div>\n                <textarea class="body-input js-body-input redactor-textarea"><[ if (commentBody){ ]><< commentBody >><[}]></textarea>\n            <[ } ]>\n        </div>\n    </div>\n    <div class="image-bucket js-image-bucket clearfix"></div>\n    <div class="alert alert-danger alert-error"></div>\n    <[ if (isIMadeIt) { ]>\n    <div class="alert alert-info imadeit-alert">\n        Please include at least one image of what you made. Add images below.\n    </div>\n    <[ } ]>\n    <div class="actions">\n        <[ if (!isMobile) {]>\n            <p class="policy">We have a <b>be nice</b> policy.<br> Please be positive and constructive.</p>\n        <[}]>\n        <[ if (isEdit) {]>\n            <button class="btn cancel-btn">Cancel</button>\n        <[ } ]>\n        <button class="btn add-image-btn" <[ if (!typeSelected) {]> disabled<[}]>>\n            <img class="uploading-indicator" src="<< Ibles.staticUrl(\'img/ajax_loader_48px.gif\') >>"> Add Images\n        </button>\n        <button class="btn btn-yellow post-btn" <[ if (!typeSelected) {]> disabled<[}]>>\n            <img class="posting-indicator" src="<< Ibles.staticUrl(\'img/ajax_loader_48px.gif\') >>"> <[ if (!submitLabel) {]>Post<[ } else { ]><< submitLabel >><[ } ]>\n        </button>\n    </div>\n</div>\n',Ibles.JST["comment-hidden-replies-toggler"]='<a class="hidden-replies-link js-show-replies" role="button">\n    << replyCountlabel >><i class="icon-arrow-down"></i>\n</a>',Ibles.JST["comment-author-opts"]='<button class="pull-left edit-comment js-edit hide-mobile">Edit</button>\n<[ if (hasChildren){]>\n    <button class="pull-left delete-comment js-del-thread">Delete Thread</button>\n<[ } else { ]>\n    <button class="pull-left delete-comment js-del-comment">Delete</button>\n<[ } ]>\n',Ibles.JST["comment-modal"]='<div class="modal fade comment-modal << modalClass >>">\n    <div class="modal-dialog modal-sm">\n        <div class="modal-content">\n            <div class="modal-body">\n                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>\n                <div class="js-gallery"></div>\n                <div class="primary-comment">\n                    <div class="js-primary-comment">\n                        <div class="loader">\n                            <img class="comment-modal-loader" src="<< Ibles.staticUrl(\'img/ajax_loader_48px.gif\') >>">\n                        </div>\n                    </div>\n                </div>\n                <div class="discussions js-replies">\n                    <div class="replies js-comments"></div>\n                </div>\n            </div>\n            <[ if (!hideNavigation) { ]>\n                <a href="javascript:void(0);" title="Next" class="js-next fancybox-nav fancybox-next"><span></span></a>\n                <a href="javascript:void(0);" title="Previous" class="js-prev fancybox-nav fancybox-prev"><span></span></a>\n            <[ } ]>\n        </div>\n    </div>\n</div>\n',Ibles.JST["comment-modal-gallery"]='<div class="scrollable-cards comment-modal-gallery <[ if (willScroll){]>will-scroll<[}]>">\n    <div class="scrollable-cards-inner" <[ if (willScroll) {]>style="height:<< galleryHeight >>px"<[}]>>\n        <[ _.each(imageFiles, function(file) { ]>\n            <div class="scrollable-card ">\n                <a href="<< file.getLargeAnimationUrl() >>" target="_blank"><img src="<< file.getOptimizedImageUrl({height: galleryHeight, frame: false}) >>"></a>\n            </div>\n        <[ }); ]>\n    </div>\n    <button class="control left-control hide-mobile" title="Previous"><i class="icon icon-arrow-left"></i></button>\n    <button class="control right-control hide-mobile <[ if (willScroll){]>active<[}]>" title="Next"><i class="icon icon-arrow-right"></i></button>\n</div>\n',Ibles.JST["comment-attached-file"]='<div class="file-info">\n    <a class="thumb-wrapper" href="<< attachmentUrl >>" download="<< name >>">\n        <span class="file-thumb"><img class="tiny-img" src="<< typeThumbnail >>" alt="<< name >>"></span>\n        <span class="title"><< name >></span>\n    </a>\n    <div class="file-actions">\n        <a href="<< attachmentUrl >>" download="<< name >>" class="btn pull-right">Download</a>\n    </div>\n</div>\n',Ibles.JST["comment-delete-prompt"]='<div class="modal-header">\n    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">x</button>\n    <h3 class="center"><< title >></h3>\n</div>\n<div class="modal-body clearfix">\n    <p class="center">Are you sure you want to delete it?</p>\n    <button class="btn btn-yellow btn-lg delete-btn pull-right"> Delete </button>\n    <button data-dismiss="modal" class="btn btn-lg pull-right cancel-btn"> Cancel </button>\n    <p class="center alert-error hide">Oops! There was a problem deleting.</p>\n</div>\n',function(){"use strict";var ut="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(e){function t(e,t){var n,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},s=Object.create(e.prototype);for(n in i)s[n]=i[n];return(s.constructor=t).prototype=s,t}function n(e){e=e||{},this.defaultProtocol=e.defaultProtocol||l.defaultProtocol,this.events=e.events||l.events,this.format=e.format||l.format,this.formatHref=e.formatHref||l.formatHref,this.nl2br=e.nl2br||l.nl2br,this.tagName=e.tagName||l.tagName,this.target=e.target||l.target,this.validate=e.validate||l.validate,this.ignoreTags=[],this.attributes=e.attributes||e.linkAttributes||l.attributes,this.className=e.className||e.linkClass||l.className;for(var t=e.ignoreTags||l.ignoreTags,n=0;n<t.length;n++)this.ignoreTags.push(t[n].toUpperCase())}function i(e){return e}function s(){return function(e){this.j=[],this.T=e||null}}function r(e,t,n,i){for(var s=0,r=e.length,o=t,a=[],l=void 0;s<r&&(l=o.next(e[s]));)o=l,s++;if(r<=s)return[];for(;s<r-1;)l=new u(i),a.push(l),o.on(e[s],l),o=l,s++;return l=new u(n),a.push(l),o.on(e[r-1],l),a}function o(){return function(e){e&&(this.v=e)}}function a(e){return t(f,o(),e?{v:e}:{})}var l={defaultProtocol:"http",events:null,format:i,formatHref:i,nl2br:!1,tagName:"a",target:function(e,t){return"url"===t?"_blank":null},validate:!0,ignoreTags:[],attributes:null,className:"linkified"};n.prototype={resolve:function(e){var t=e.toHref(this.defaultProtocol);return{formatted:this.get("format",e.toString(),e),formattedHref:this.get("formatHref",t,e),tagName:this.get("tagName",t,e),className:this.get("className",t,e),target:this.get("target",t,e),events:this.getObject("events",t,e),attributes:this.getObject("attributes",t,e)}},check:function(e){return this.get("validate",e.toString(),e)},get:function(e,t,n){var i=this[e];if(!i)return i;switch(void 0===i?"undefined":ut(i)){case"function":return i(t,n.type);case"object":var s=i[n.type]||l[e];return"function"==typeof s?s(t,n.type):s}return i},getObject:function(e,t,n){var i=this[e];return"function"==typeof i?i(t,n.type):i}};var c=Object.freeze({defaults:l,Options:n,contains:function(e,t){for(var n=0;n<e.length;n++)if(e[n]===t)return!0;return!1}}),d=s();d.prototype={defaultTransition:!1,on:function(e,t){if(e instanceof Array){for(var n=0;n<e.length;n++)this.j.push([e[n],t]);return this}return this.j.push([e,t]),this},next:function(e){for(var t=0;t<this.j.length;t++){var n=this.j[t],i=n[0],s=n[1];if(this.test(e,i))return s}return this.defaultTransition},accepts:function(){return!!this.T},test:function(e,t){return e===t},emit:function(){return this.T}};var u=t(d,s(),{test:function(e,t){return e===t||t instanceof RegExp&&t.test(e)}}),h=t(d,s(),{jump:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,n=this.next(new e(""));return n===this.defaultTransition?(n=new this.constructor(t),this.on(e,n)):t&&(n.T=t),n},test:function(e,t){return e instanceof t}}),f=o();f.prototype={toString:function(){return this.v+""}};function m(e){return new u(e)}var p=a(),g=a("@"),b=a(":"),v=a("."),w=a(),y=a(),_=a("\n"),I=a(),k=a("+"),C=a("#"),x=a(),S=a("mailto:"),A=a("?"),T=a("/"),E=a("_"),R=a(),M=a(),O=a(),P=a("{"),z=a("["),j=a("<"),U=a("("),B=a("}"),D=a("]"),F=a(">"),N=a(")"),$=a("&"),L=Object.freeze({Base:f,DOMAIN:p,AT:g,COLON:b,DOT:v,PUNCTUATION:w,LOCALHOST:y,NL:_,NUM:I,PLUS:k,POUND:C,QUERY:A,PROTOCOL:x,MAILTO:S,SLASH:T,UNDERSCORE:E,SYM:R,TLD:M,WS:O,OPENBRACE:P,OPENBRACKET:z,OPENANGLEBRACKET:j,OPENPAREN:U,CLOSEBRACE:B,CLOSEBRACKET:D,CLOSEANGLEBRACKET:F,CLOSEPAREN:N,AMPERSAND:$}),V="aaa|aarp|abb|abbott|abogado|ac|academy|accenture|accountant|accountants|aco|active|actor|ad|adac|ads|adult|ae|aeg|aero|af|afl|ag|agency|ai|aig|airforce|airtel|al|alibaba|alipay|allfinanz|alsace|am|amica|amsterdam|an|analytics|android|ao|apartments|app|apple|aq|aquarelle|ar|aramco|archi|army|arpa|arte|as|asia|associates|at|attorney|au|auction|audi|audio|author|auto|autos|avianca|aw|ax|axa|az|azure|ba|baidu|band|bank|bar|barcelona|barclaycard|barclays|bargains|bauhaus|bayern|bb|bbc|bbva|bcg|bcn|bd|be|beats|beer|bentley|berlin|best|bet|bf|bg|bh|bharti|bi|bible|bid|bike|bing|bingo|bio|biz|bj|black|blackfriday|bloomberg|blue|bm|bms|bmw|bn|bnl|bnpparibas|bo|boats|boehringer|bom|bond|boo|book|boots|bosch|bostik|bot|boutique|br|bradesco|bridgestone|broadway|broker|brother|brussels|bs|bt|budapest|bugatti|build|builders|business|buy|buzz|bv|bw|by|bz|bzh|ca|cab|cafe|cal|call|camera|camp|cancerresearch|canon|capetown|capital|car|caravan|cards|care|career|careers|cars|cartier|casa|cash|casino|cat|catering|cba|cbn|cc|cd|ceb|center|ceo|cern|cf|cfa|cfd|cg|ch|chanel|channel|chase|chat|cheap|chloe|christmas|chrome|church|ci|cipriani|circle|cisco|citic|city|cityeats|ck|cl|claims|cleaning|click|clinic|clinique|clothing|cloud|club|clubmed|cm|cn|co|coach|codes|coffee|college|cologne|com|commbank|community|company|compare|computer|comsec|condos|construction|consulting|contact|contractors|cooking|cool|coop|corsica|country|coupon|coupons|courses|cr|credit|creditcard|creditunion|cricket|crown|crs|cruises|csc|cu|cuisinella|cv|cw|cx|cy|cymru|cyou|cz|dabur|dad|dance|date|dating|datsun|day|dclk|de|dealer|deals|degree|delivery|dell|deloitte|delta|democrat|dental|dentist|desi|design|dev|diamonds|diet|digital|direct|directory|discount|dj|dk|dm|dnp|do|docs|dog|doha|domains|download|drive|dubai|durban|dvag|dz|earth|eat|ec|edeka|edu|education|ee|eg|email|emerck|energy|engineer|engineering|enterprises|epson|equipment|er|erni|es|esq|estate|et|eu|eurovision|eus|events|everbank|exchange|expert|exposed|express|fage|fail|fairwinds|faith|family|fan|fans|farm|fashion|fast|feedback|ferrero|fi|film|final|finance|financial|firestone|firmdale|fish|fishing|fit|fitness|fj|fk|flickr|flights|florist|flowers|flsmidth|fly|fm|fo|foo|football|ford|forex|forsale|forum|foundation|fox|fr|fresenius|frl|frogans|frontier|fund|furniture|futbol|fyi|ga|gal|gallery|gallup|game|garden|gb|gbiz|gd|gdn|ge|gea|gent|genting|gf|gg|ggee|gh|gi|gift|gifts|gives|giving|gl|glass|gle|global|globo|gm|gmail|gmbh|gmo|gmx|gn|gold|goldpoint|golf|goo|goog|google|gop|got|gov|gp|gq|gr|grainger|graphics|gratis|green|gripe|group|gs|gt|gu|gucci|guge|guide|guitars|guru|gw|gy|hamburg|hangout|haus|hdfcbank|health|healthcare|help|helsinki|here|hermes|hiphop|hitachi|hiv|hk|hm|hn|hockey|holdings|holiday|homedepot|homes|honda|horse|host|hosting|hoteles|hotmail|house|how|hr|hsbc|ht|hu|hyundai|ibm|icbc|ice|icu|id|ie|ifm|iinet|il|im|immo|immobilien|in|industries|infiniti|info|ing|ink|institute|insurance|insure|int|international|investments|io|ipiranga|iq|ir|irish|is|iselect|ist|istanbul|it|itau|iwc|jaguar|java|jcb|je|jetzt|jewelry|jlc|jll|jm|jmp|jo|jobs|joburg|jot|joy|jp|jpmorgan|jprs|juegos|kaufen|kddi|ke|kerryhotels|kerrylogistics|kerryproperties|kfh|kg|kh|ki|kia|kim|kinder|kitchen|kiwi|km|kn|koeln|komatsu|kp|kpn|kr|krd|kred|kuokgroup|kw|ky|kyoto|kz|la|lacaixa|lamborghini|lamer|lancaster|land|landrover|lanxess|lasalle|lat|latrobe|law|lawyer|lb|lc|lds|lease|leclerc|legal|lexus|lgbt|li|liaison|lidl|life|lifeinsurance|lifestyle|lighting|like|limited|limo|lincoln|linde|link|live|living|lixil|lk|loan|loans|local|locus|lol|london|lotte|lotto|love|lr|ls|lt|ltd|ltda|lu|lupin|luxe|luxury|lv|ly|ma|madrid|maif|maison|makeup|man|management|mango|market|marketing|markets|marriott|mba|mc|md|me|med|media|meet|melbourne|meme|memorial|men|menu|meo|mg|mh|miami|microsoft|mil|mini|mk|ml|mm|mma|mn|mo|mobi|mobily|moda|moe|moi|mom|monash|money|montblanc|mormon|mortgage|moscow|motorcycles|mov|movie|movistar|mp|mq|mr|ms|mt|mtn|mtpc|mtr|mu|museum|mutuelle|mv|mw|mx|my|mz|na|nadex|nagoya|name|natura|navy|nc|ne|nec|net|netbank|network|neustar|new|news|nexus|nf|ng|ngo|nhk|ni|nico|nikon|ninja|nissan|nl|no|nokia|norton|nowruz|np|nr|nra|nrw|ntt|nu|nyc|nz|obi|office|okinawa|om|omega|one|ong|onl|online|ooo|oracle|orange|org|organic|origins|osaka|otsuka|ovh|pa|page|pamperedchef|panerai|paris|pars|partners|parts|party|passagens|pe|pet|pf|pg|ph|pharmacy|philips|photo|photography|photos|physio|piaget|pics|pictet|pictures|pid|pin|ping|pink|pizza|pk|pl|place|play|playstation|plumbing|plus|pm|pn|pohl|poker|porn|post|pr|praxi|press|pro|prod|productions|prof|promo|properties|property|protection|ps|pt|pub|pw|pwc|py|qa|qpon|quebec|quest|racing|re|read|realtor|realty|recipes|red|redstone|redumbrella|rehab|reise|reisen|reit|ren|rent|rentals|repair|report|republican|rest|restaurant|review|reviews|rexroth|rich|ricoh|rio|rip|ro|rocher|rocks|rodeo|room|rs|rsvp|ru|ruhr|run|rw|rwe|ryukyu|sa|saarland|safe|safety|sakura|sale|salon|samsung|sandvik|sandvikcoromant|sanofi|sap|sapo|sarl|sas|saxo|sb|sbs|sc|sca|scb|schaeffler|schmidt|scholarships|school|schule|schwarz|science|scor|scot|sd|se|seat|security|seek|select|sener|services|seven|sew|sex|sexy|sfr|sg|sh|sharp|shell|shia|shiksha|shoes|show|shriram|si|singles|site|sj|sk|ski|skin|sky|skype|sl|sm|smile|sn|sncf|so|soccer|social|softbank|software|sohu|solar|solutions|song|sony|soy|space|spiegel|spot|spreadbetting|sr|srl|st|stada|star|starhub|statefarm|statoil|stc|stcgroup|stockholm|storage|store|studio|study|style|su|sucks|supplies|supply|support|surf|surgery|suzuki|sv|swatch|swiss|sx|sy|sydney|symantec|systems|sz|tab|taipei|taobao|tatamotors|tatar|tattoo|tax|taxi|tc|tci|td|team|tech|technology|tel|telecity|telefonica|temasek|tennis|tf|tg|th|thd|theater|theatre|tickets|tienda|tiffany|tips|tires|tirol|tj|tk|tl|tm|tmall|tn|to|today|tokyo|tools|top|toray|toshiba|total|tours|town|toyota|toys|tp|tr|trade|trading|training|travel|travelers|travelersinsurance|trust|trv|tt|tube|tui|tunes|tushu|tv|tvs|tw|tz|ua|ubs|ug|uk|unicom|university|uno|uol|us|uy|uz|va|vacations|vana|vc|ve|vegas|ventures|verisign|versicherung|vet|vg|vi|viajes|video|viking|villas|vin|vip|virgin|vision|vista|vistaprint|viva|vlaanderen|vn|vodka|volkswagen|vote|voting|voto|voyage|vu|vuelos|wales|walter|wang|wanggou|watch|watches|weather|weatherchannel|webcam|weber|website|wed|wedding|weir|wf|whoswho|wien|wiki|williamhill|win|windows|wine|wme|wolterskluwer|work|works|world|ws|wtc|wtf|xbox|xerox|xin|xperia|xxx|xyz|yachts|yahoo|yamaxun|yandex|ye|yodobashi|yoga|yokohama|youtube|yt|za|zara|zero|zip|zm|zone|zuerich|zw".split("|"),q="0123456789".split(""),H="0123456789abcdefghijklmnopqrstuvwxyz".split(""),W=[" ","\f","\r","\t","\v"," "," ","᠎"],Z=[],G=m(),J=m(I),K=m(p),Q=m(),Y=m(O);G.on("@",m(g)).on(".",m(v)).on("+",m(k)).on("#",m(C)).on("?",m(A)).on("/",m(T)).on("_",m(E)).on(":",m(b)).on("{",m(P)).on("[",m(z)).on("<",m(j)).on("(",m(U)).on("}",m(B)).on("]",m(D)).on(">",m(F)).on(")",m(N)).on("&",m($)).on([",",";","!",'"',"'"],m(w)),G.on("\n",m(_)).on(W,Y),Y.on(W,Y);for(var X=0;X<V.length;X++){var ee=r(V[X],G,M,p);Z.push.apply(Z,ee)}var te=r("file",G,p,p),ne=r("ftp",G,p,p),ie=r("http",G,p,p),se=r("mailto",G,p,p);Z.push.apply(Z,te),Z.push.apply(Z,ne),Z.push.apply(Z,ie);var re=te.pop(),oe=ne.pop(),ae=ie.pop(),le=se.pop(),ce=m(p),de=m(x),ue=m(S);oe.on("s",ce).on(":",de),ae.on("s",ce).on(":",de),Z.push(ce),re.on(":",de),ce.on(":",de),le.on(":",ue);var he=r("localhost",G,y,p);Z.push.apply(Z,he),G.on(q,J),J.on("-",Q).on(q,J).on(H,K),K.on("-",Q).on(H,K);for(var fe=0;fe<Z.length;fe++)Z[fe].on("-",Q).on(H,K);Q.on("-",Q).on(q,K).on(H,K),G.defaultTransition=m(R);function me(e){for(var t=e.replace(/[A-Z]/g,function(e){return e.toLowerCase()}),n=e.length,i=[],s=0;s<n;){for(var r,o=G,a=null,l=0,c=null,d=-1;s<n&&(a=o.next(t[s]));)(o=a).accepts()?(d=0,c=o):0<=d&&d++,l++,s++;d<0||(s-=d,l-=d,r=c.emit(),i.push(new r(e.substr(s-l,l))))}return i}var pe=Object.freeze({State:u,TOKENS:L,run:me,start:G}),ge=o();ge.prototype={type:"token",isLink:!1,toString:function(){for(var e=[],t=0;t<this.v.length;t++)e.push(this.v[t].toString());return e.join("")},toHref:function(){return this.toString()},toObject:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"http";return{type:this.type,value:this.toString(),href:this.toHref(e)}}};function be(e){return new h(e)}var ve=t(ge,o(),{type:"email",isLink:!0}),we=t(ge,o(),{type:"email",isLink:!0,toHref:function(){return this.v,"mailto:"+this.toString()}}),ye=t(ge,o(),{type:"text"}),_e=t(ge,o(),{type:"nl"}),Ie=t(ge,o(),{type:"url",isLink:!0,toHref:function(){for(var e,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"http",n=!1,i=!1,s=this.v,r=[],o=0;s[o]instanceof x;)n=!0,r.push(s[o].toString().toLowerCase()),o++;for(;s[o]instanceof T;)i=!0,r.push(s[o].toString()),o++;for(;(e=s[o])instanceof p||e instanceof M;)r.push(s[o].toString().toLowerCase()),o++;for(;o<s.length;o++)r.push(s[o].toString());return r=r.join(""),n||i||(r=t+"://"+r),r},hasProtocol:function(){return this.v[0]instanceof x}}),ke=Object.freeze({Base:ge,MAILTOEMAIL:ve,EMAIL:we,NL:_e,TEXT:ye,URL:Ie}),Ce=be(),xe=be(),Se=be(),Ae=be(),Te=be(),Ee=be(),Re=be(),Me=be(Ie),Oe=be(),Pe=be(Ie),ze=be(Ie),je=be(),Ue=be(),Be=be(),De=be(),Fe=be(),Ne=be(Ie),$e=be(Ie),Le=be(Ie),Ve=be(Ie),qe=be(),He=be(),We=be(),Ze=be(),Ge=be(),Je=be(),Ke=be(we),Qe=be(),Ye=be(we),Xe=be(ve),et=be(),tt=be(),nt=be(),it=be(),st=be(_e);Ce.on(_,st).on(x,xe).on(S,Se).on(T,Ae),xe.on(T,Ae),Ae.on(T,Te),Ce.on(M,Ee).on(p,Ee).on(y,Me).on(I,Ee),Te.on(M,ze).on(p,ze).on(I,ze).on(y,ze),Ee.on(v,Re),Ge.on(v,Je),Re.on(M,Me).on(p,Ee).on(I,Ee).on(y,Ee),Je.on(M,Ke).on(p,Ge).on(I,Ge).on(y,Ge),Me.on(v,Re),Ke.on(v,Je),Me.on(b,Oe).on(T,ze),Oe.on(I,Pe),Pe.on(T,ze),Ke.on(b,Qe),Qe.on(I,Ye);var rt=[p,g,y,I,k,C,x,T,M,E,R,$],ot=[b,v,A,w,B,D,F,N,P,z,j,U];ze.on(P,Ue).on(z,Be).on(j,De).on(U,Fe),je.on(P,Ue).on(z,Be).on(j,De).on(U,Fe),Ue.on(B,ze),Be.on(D,ze),De.on(F,ze),Fe.on(N,ze),Ne.on(B,ze),$e.on(D,ze),Le.on(F,ze),Ve.on(N,ze),qe.on(B,ze),He.on(D,ze),We.on(F,ze),Ze.on(N,ze),Ue.on(rt,Ne),Be.on(rt,$e),De.on(rt,Le),Fe.on(rt,Ve),Ue.on(ot,qe),Be.on(ot,He),De.on(ot,We),Fe.on(ot,Ze),Ne.on(rt,Ne),$e.on(rt,$e),Le.on(rt,Le),Ve.on(rt,Ve),Ne.on(ot,Ne),$e.on(ot,$e),Le.on(ot,Le),Ve.on(ot,Ve),qe.on(rt,Ne),He.on(rt,$e),We.on(rt,Le),Ze.on(rt,Ve),qe.on(ot,qe),He.on(ot,He),We.on(ot,We),Ze.on(ot,Ze),ze.on(rt,ze),je.on(rt,ze),ze.on(ot,je),je.on(ot,je),Se.on(M,Xe).on(p,Xe).on(I,Xe).on(y,Xe),Xe.on(rt,Xe).on(ot,et),et.on(rt,Xe).on(ot,et);var at=[p,I,k,C,A,E,R,$,M];Ee.on(at,tt).on(g,nt),Me.on(at,tt).on(g,nt),Re.on(at,tt),tt.on(at,tt).on(g,nt).on(v,it),it.on(at,tt),nt.on(M,Ge).on(p,Ge).on(y,Ke);function lt(e){for(var t=e.length,n=0,i=[],s=[];n<t;){for(var r=Ce,o=null,a=null,l=0,c=null,d=-1;n<t&&!(o=r.next(e[n]));)s.push(e[n++]);for(;n<t&&(a=o||r.next(e[n]));)o=null,(r=a).accepts()?(d=0,c=r):0<=d&&d++,n++,l++;if(d<0)for(var u=n-l;u<n;u++)s.push(e[u]);else{0<s.length&&(i.push(new ye(s)),s=[]),n-=d,l-=d;var h=c.emit();i.push(new h(e.slice(n-l,n)))}}return 0<s.length&&i.push(new ye(s)),i}var ct=Object.freeze({State:h,TOKENS:ke,run:lt,start:Ce});Array.isArray||(Array.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)});function dt(e){return lt(me(e))}e.find=function(e){for(var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,n=dt(e),i=[],s=0;s<n.length;s++){var r=n[s];!r.isLink||t&&r.type!==t||i.push(r.toObject())}return i},e.inherits=t,e.options=c,e.parser=ct,e.scanner=pe,e.test=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,n=dt(e);return 1===n.length&&n[0].isLink&&(!t||n[0].type===t)},e.tokenize=dt}(self.linkify=self.linkify||{})}(),function(e){var t=function(p){function n(e){this.a=e}function t(e){return d.test(e)}function i(e){return u.test(e)}function s(e,t){this.b=e,this.c=t,this.d=null,this.input=null,this.e=-1,this.f=-1,this.g=-1,this.h=-1,this.i=-1,this.j()}function r(e,t){this.k=null,this.startLine=1,this.startColumn=0,this.options=t||{},this.tokenizer=new s(this,e)}var o={m:" "},a=/^#[xX]([A-Fa-f0-9]+)$/,l=/^#([0-9]+)$/,c=/^([A-Za-z0-9]+)$/;n.prototype.parse=function(e){if(e){var t=e.match(a);return t?"&#x"+t[1]+";":(t=e.match(l))?"&#"+t[1]+";":(t=e.match(c))?this.a[t[1]]||"&"+t[1]+";":void 0}};var d=/[\t\n\f ]/,u=/[A-Za-z]/,h=/\r\n?/g;s.prototype={j:function(){this.d="beforeData",this.input="",this.e=0,this.f=1,this.g=0,this.h=-1,this.i=-1,this.b.j()},tokenize:function(e){this.j(),this.tokenizePart(e),this.tokenizeEOF()},tokenizePart:function(e){for(this.input+=e.replace(h,"\n");this.e<this.input.length;)this.n[this.d].call(this)},tokenizeEOF:function(){this.o()},o:function(){"data"===this.d&&(this.b.p(),this.d="beforeData")},q:function(){return this.input.charAt(this.e)},r:function(){var e=this.q();return this.e++,"\n"===e?(this.f++,this.g=0):this.g++,e},s:function(){var e=this.input.indexOf(";",this.e);if(-1!==e){var t=this.input.slice(this.e,e),n=this.c.parse(t);if(n){for(var i=t.length;i;)this.r(),i--;return this.r(),n}}},t:function(){this.h=this.f,this.i=this.g,this.b.tagOpen&&this.b.tagOpen()},n:{beforeData:function(){"<"===this.q()?(this.d="tagOpen",this.t(),this.r()):(this.d="data",this.b.u())},data:function(){var e=this.q();"<"===e?(this.b.p(),this.d="tagOpen",this.t(),this.r()):"&"===e?(this.r(),this.b.v(this.s()||"&")):(this.r(),this.b.v(e))},tagOpen:function(){var e=this.r();"!"===e?this.d="markupDeclaration":"/"===e?this.d="endTagOpen":i(e)&&(this.d="tagName",this.b.w(),this.b.x(e.toLowerCase()))},markupDeclaration:function(){"-"===this.r()&&"-"===this.input.charAt(this.e)&&(this.r(),this.d="commentStart",this.b.y())},commentStart:function(){var e=this.r();"-"===e?this.d="commentStartDash":">"===e?(this.b.z(),this.d="beforeData"):(this.b.A(e),this.d="comment")},commentStartDash:function(){var e=this.r();"-"===e?this.d="commentEnd":">"===e?(this.b.z(),this.d="beforeData"):(this.b.A("-"),this.d="comment")},comment:function(){var e=this.r();"-"===e?this.d="commentEndDash":this.b.A(e)},commentEndDash:function(){var e=this.r();"-"===e?this.d="commentEnd":(this.b.A("-"+e),this.d="comment")},commentEnd:function(){var e=this.r();">"===e?(this.b.z(),this.d="beforeData"):(this.b.A("--"+e),this.d="comment")},tagName:function(){var e=this.r();t(e)?this.d="beforeAttributeName":"/"===e?this.d="selfClosingStartTag":">"===e?(this.b.B(),this.d="beforeData"):this.b.x(e)},beforeAttributeName:function(){var e=this.q();return t(e)?void this.r():void("/"===e?(this.d="selfClosingStartTag",this.r()):">"===e?(this.r(),this.b.B(),this.d="beforeData"):(this.d="attributeName",this.b.C(),this.r(),this.b.D(e)))},attributeName:function(){var e=this.q();t(e)?(this.d="afterAttributeName",this.r()):"/"===e?(this.b.F(!1),this.b.G(),this.r(),this.d="selfClosingStartTag"):"="===e?(this.d="beforeAttributeValue",this.r()):">"===e?(this.b.F(!1),this.b.G(),this.r(),this.b.B(),this.d="beforeData"):(this.r(),this.b.D(e))},afterAttributeName:function(){var e=this.q();return t(e)?void this.r():void("/"===e?(this.b.F(!1),this.b.G(),this.r(),this.d="selfClosingStartTag"):"="===e?(this.r(),this.d="beforeAttributeValue"):">"===e?(this.b.F(!1),this.b.G(),this.r(),this.b.B(),this.d="beforeData"):(this.b.F(!1),this.b.G(),this.r(),this.d="attributeName",this.b.C(),this.b.D(e)))},beforeAttributeValue:function(){var e=this.q();t(e)?this.r():'"'===e?(this.d="attributeValueDoubleQuoted",this.b.F(!0),this.r()):"'"===e?(this.d="attributeValueSingleQuoted",this.b.F(!0),this.r()):">"===e?(this.b.F(!1),this.b.G(),this.r(),this.b.B(),this.d="beforeData"):(this.d="attributeValueUnquoted",this.b.F(!1),this.r(),this.b.H(e))},attributeValueDoubleQuoted:function(){var e=this.r();'"'===e?(this.b.G(),this.d="afterAttributeValueQuoted"):"&"===e?this.b.H(this.s('"')||"&"):this.b.H(e)},attributeValueSingleQuoted:function(){var e=this.r();"'"===e?(this.b.G(),this.d="afterAttributeValueQuoted"):"&"===e?this.b.H(this.s("'")||"&"):this.b.H(e)},attributeValueUnquoted:function(){var e=this.q();t(e)?(this.b.G(),this.r(),this.d="beforeAttributeName"):"&"===e?(this.r(),this.b.H(this.s(">")||"&")):">"===e?(this.b.G(),this.r(),this.b.B(),this.d="beforeData"):(this.r(),this.b.H(e))},afterAttributeValueQuoted:function(){var e=this.q();t(e)?(this.r(),this.d="beforeAttributeName"):"/"===e?(this.r(),this.d="selfClosingStartTag"):">"===e?(this.r(),this.b.B(),this.d="beforeData"):this.d="beforeAttributeName"},selfClosingStartTag:function(){">"===this.q()?(this.r(),this.b.I(),this.b.B(),this.d="beforeData"):this.d="beforeAttributeName"},endTagOpen:function(){var e=this.r();i(e)&&(this.d="tagName",this.b.J(),this.b.x(e.toLowerCase()))}}},r.prototype={tokenize:function(e){return this.K=[],this.tokenizer.tokenize(e),this.K},tokenizePart:function(e){return this.K=[],this.tokenizer.tokenizePart(e),this.K},tokenizeEOF:function(){return this.K=[],this.tokenizer.tokenizeEOF(),this.K[0]},j:function(){this.k=null,this.startLine=1,this.startColumn=0},L:function(){this.options.M&&(this.k.M={start:{f:this.startLine,g:this.startColumn},N:{f:this.tokenizer.f,g:this.tokenizer.g}}),this.startLine=this.tokenizer.f,this.startColumn=this.tokenizer.g},u:function(){this.k={type:"Chars",chars:""},this.K.push(this.k)},v:function(e){this.k.chars+=e},p:function(){this.L()},y:function(){this.k={type:"Comment",chars:""},this.K.push(this.k)},A:function(e){this.k.chars+=e},z:function(){this.L()},w:function(){this.k={type:"StartTag",tagName:"",attributes:[],l:!1},this.K.push(this.k)},J:function(){this.k={type:"EndTag",tagName:""},this.K.push(this.k)},B:function(){this.L()},I:function(){this.k.l=!0},x:function(e){this.k.tagName+=e},C:function(){this._currentAttribute=["","",null],this.k.attributes.push(this._currentAttribute)},D:function(e){this._currentAttribute[0]+=e},F:function(e){this._currentAttribute[2]=e},H:function(e){this._currentAttribute[1]=this._currentAttribute[1]||"",this._currentAttribute[1]+=e},G:function(){}};var f={HTML5NamedCharRefs:o,EntityParser:n,EventedTokenizer:s,Tokenizer:r,tokenize:function(e,t){return new r(new n(o),t).tokenize(e)}},m=p.options,g=m.Options,b="StartTag",v="EndTag",w="Chars";return function(e){for(var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},n=f.tokenize(e),i=[],s=[],t=new g(t),r=0;r<n.length;r++){var o,a=n[r];if(a.type!==b){a.type===w?(o=function(e,t){for(var n=p.tokenize(e),i=[],s=0;s<n.length;s++){var r=n[s];if("nl"===r.type&&t.nl2br)i.push({type:b,tagName:"br",attributes:[],l:!0});else if(r.isLink&&t.check(r)){var o,a=t.resolve(r),l=(a.href,a.formatted),c=a.formattedHref,d=a.tagName,u=a.className,h=a.target,f=a.attributes,m=[["href",c]];for(o in u&&m.push(["class",u]),h&&m.push(["target",h]),f)m.push([o,f[o]]);i.push({type:b,tagName:d,attributes:m,l:!1}),i.push({type:w,chars:l}),i.push({type:v,tagName:d})}else i.push({type:w,chars:r.toString()})}return i}(a.chars,t),i.push.apply(i,o)):i.push(a)}else{i.push(a);var l=a.tagName.toUpperCase();if(!("A"===l||m.contains(t.ignoreTags,l)))continue;var c=i.length;(function(e,t,n,i){for(var s=1;n<t.length&&0<s;){var r=t[n];r.type===b&&r.tagName.toUpperCase()===e?s++:r.type===v&&r.tagName.toUpperCase()===e&&s--,i.push(r),n++}})(l,n,++r,i),r+=i.length-c-1}}for(r=0;r<i.length;r++){var d=i[r];switch(d.type){case b:var u="<"+d.tagName;0<d.attributes.length&&(u+=" "+function(e){for(var t=[],n=0;n<e.length;n++){var i=e[n],s=i[0],r=i[1];t.push(s+'="'+r.replace(/"/g,"&quot;")+'"')}return t}(d.attributes).join(" ")),u+=">",s.push(u);break;case v:s.push("</"+d.tagName+">");break;case w:s.push(d.chars);break;case"Comment":s.push("\x3c!--"+d.chars+"--\x3e")}}return s.join("")}}(linkify);e.linkifyHtml=t}(window),Ibles.package("Ibles.views"),Ibles.views.RedactorTextAreaView=Backbone.View.extend({initialize:function(e){_.bindAll(this,"redactorLoaded","sync"),e=e||{},this.enableHtml=e.enableHtml||!1,this.textArea=e.textArea||this.$(".redactor-textarea"),this.toolTip=e.tooltip||this.$(".redactor-tooltip"),this.redactorOptions=e.redactorOptions||{},this.addAirOptions(),this.enableHtml&&this.addHtmlOptions(),this.redactorLoadedCallback=e.redactorLoadedCallback,this.addRedactorAirMode()},addAirOptions:function(){this.redactorOptions=_.extend(this.redactorOptions,{air:!0,plugins:["instructables","instructablesAir"],airButtons:["bold","italic","heading","link_ibles","quote"],convertVideoLinks:!0,convertLinks:!0,buttonsCustom:{link_ibles:{title:"Link",callback:function(e){this.ibles_makeLink(e)}},heading:{title:"Heading",callback:function(e){this.ibles_makeheader(e)}},quote:{title:"Blockquote",func:"formatQuote"}}})},addHtmlOptions:function(){this.redactorOptions=_.extend(this.redactorOptions,{airButtons:["bold","italic","heading","link_ibles","quote","html"],convertDivs:!1,deniedTags:[],syncBeforeCallback:function(e){return!0===this.editedCode?this.get():e},textareaKeydownCallback:function(){this.editedCode=!0},keydownCallback:function(){this.editedCode=!1}})},addRedactorAirMode:function(){var e=this,t=Ibles.pageContext.commitInfo&&Ibles.pageContext.commitInfo.git_hash||"",n=_.map(["editor/desktop/dependencies/redactor916/redactor/redactor.css","editor/desktop/dependencies/redactorInstructables/airmode.css","editor/desktop/dependencies/redactor916/redactor/redactor.min.js","js/RedactorAirPlugin.js"],function(e){return"{0}{1}{2}".format(Ibles.pageContext.staticRoot,e,"?cb={0}".format(t))});head.load(n,function(){e.textArea.redactor(e.redactorOptions||{}),e.redactorLoaded()})},redactorLoaded:function(){this.trigger("redactorLoaded"),"function"==typeof this.redactorLoadedCallback&&this.redactorLoadedCallback()},sync:function(){return this.textArea.redactor("sync"),this.textArea.redactor("get")},hideToolTip:function(){this.toolTip.tooltip("hide"),this.$(".redactor_redactor-textarea").off("click")},reset:function(){this.$(".redactor_editor").empty(),this.textArea.val("")}}),Ibles.package("Ibles.views"),Ibles.views.ScrollableCardsView=Backbone.View.fullExtend({events:{"click .left-control":"scrollBack","click .right-control":"scrollForward"},initialize:function(){_.bindAll(this,"scroll"),this.$scrollable=this.$(".scrollable-cards-inner"),this.$scrollable.scroll(_.debounce(this.scroll,250))},scrollBack:function(e){var t;e.preventDefault(),$(e.currentTarget).hasClass("active")&&(t=this.$(".carousel-items").scrollLeft(),this.$scrollable.animate({scrollLeft:t-this.$scrollable.width()},800))},scrollForward:function(e){var t;e.preventDefault(),$(e.currentTarget).hasClass("active")&&(t=this.$scrollable.scrollLeft(),this.$scrollable.animate({scrollLeft:t+this.$scrollable.width()},800))},scroll:function(){var e=this.$scrollable,t=this.$(".right-control"),n=this.$(".left-control"),i=e.children(".scrollable-card").last(),s=e.width();0<e.scrollLeft()?n.addClass("active"):n.removeClass("active"),i.position().left+i.width()<=s?t.removeClass("active"):t.addClass("active")}}),Ibles.package("Ibles.models"),Ibles.models.CommentModel=Backbone.Model.extend({defaults:function(){return{id:null,instructableId:null,topicId:null,author:Ibles.session.get("screenName"),authorId:Ibles.session.get("id"),authorUrl:null,avatar:Ibles.session.getAvatarUrl(),avatarDownload:null,files:[],fileSet:new Ibles.collections.FileCollection,IMadeIt:!1,inReplyTo:null,replyAuthor:null,quarantine:!1,limbo:!1,status:null,commentable:null,commentableId:null,body:"",stepId:null,stepAnchorId:null,stepIndexLabel:null,designations:[],voted:!1,rating:0,sticky:!1,visible:!0,lastVisibleInThread:!1,indexInReplyThread:null,numRepliesFromMe:null}},designations:["tip","topic","review","answer","bestAnswer","comment","question"],initialize:function(){_.bindAll(this,"onSaveError","onSaveSuccess","onEditSuccess","onDeleteSuccess"),_.isUndefined(this.get("publishDate"))||this.set({commentTime:moment(Ibles.addServerTimeZone(this.get("publishDate"))).fromNow()}),_.isEmpty(this.get("authorUrl"))&&this.set({authorUrl:Ibles.reverseUrls.memberUrl(this.get("author"))}),_.isEmpty(this.get("files"))||this.get("fileSet").add(this.get("files")),"DELETED"===this.get("status")&&this.setDeletedBody(),window.linkify&&(window.linkify.options.defaults.className=null),this.listenTo(this,"change:body",function(){this.set({body:linkifyHtml(this.get("body"))},{silent:!0})}),this.listenTo(this,"change:designations",function(){this.updateDesignatedProps()}),this.updateDesignatedProps()},updateDesignatedProps:function(){this.set({designatedQuestion:this.isQuestion(),designatedTip:this.isTip(),designatedAnswer:this.isAnswer(),designatedBestAnswer:this.isBestAnswer(),designatedComment:this.isDesignatedComment()})},isReply:function(){return!!this.get("inReplyTo")},isVisible:function(){return this.get("visible")},hasDesignation:function(){return!_.isEmpty(this.get("designations"))},hasChildren:function(){var e=this.collection,t=e&&e.at(e.indexOf(this)+1);return t&&t.get("inReplyTo")==this.get("id")},isDesignated:function(e){return _.contains(this.get("designations"),e)},isQuestion:function(){return this.isDesignated("question")},isAnswer:function(){return this.isDesignated("answer")},isBestAnswer:function(){return this.isDesignated("bestAnswer")},isTip:function(){return this.isDesignated("tip")},isDesignatedComment:function(){return this.isDesignated("comment")},isIMadeIt:function(){return this.get("IMadeIt")},voted:function(){return!!this.get("voted")},votes:function(){return this.get("rating")},votableByCurrentUser:function(){var e=Ibles.session,t=e.get("screenName"),n=this.get("author");return e.authenticated()&&t!=n},currentUserIsOwner:function(){return this.currentUserIsAuthor()},currentUserIsAuthor:function(){var e=Ibles.session,t=e.get("screenName"),n=this.get("author");return e.authenticated()&&t==n},authorIsProjectOwner:function(e){var t=e.get("author");return _.isObject(t)&&(t=t.screenName),this.get("author")===t},getAuthorAvatarUrl:function(){var e=this.get("avatarDownload");return e?Ibles.fileFromOriginalUrl(e,{isUserFile:!0}).getTinyUrl():Ibles.session.getAvatarUrl()},setDesignations:function(e,t){var n={commentId:this.get("id"),designations:e},i=this;return t&&(n.threadDesignations=t),Ibles.API.jsonPostRequest("setDesignations",n).done(function(){i.set({designations:e})})},setDeletedBody:function(){this.set({body:Ibles.T("(removed by author or community request)")})},setReplyAuthor:function(){var e,t=this,n=t.collection;n&&!_.isUndefined(t.get("inReplyTo"))&&_.isNull(t.get("replyAuthor"))&&(e=n.get(t.get("inReplyTo")),_.isEmpty(e)||t.set({replyAuthor:e.get("author")}))},getImagesParam:function(){var e=this.get("fileSet"),t=[];return e.isEmpty()||(t=_.isFunction(e.idArray)?e.idArray():e.map(function(e){return{id:e.get("id")}})),t},editRequest:function(){var e=this,t={id:e.get("id"),body:e.get("body"),images:e.getImagesParam()};return Ibles.API.jsonPostRequest("editComment",t,{success:e.onEditSuccess,error:e.onSaveError})},onEditSuccess:function(){this.trigger("change"),this.trigger("comment.postSuccess",this)},save:function(){var e=_.omit(_.pick(this.toJSON(),"instructableId","topicId","author","IMadeIt","body","inReplyTo","stepId","designations"),_.isNull);return e.images=this.getImagesParam(),Ibles.API.jsonPostRequest("addComment",e,{success:this.onSaveSuccess,error:this.onSaveError},"id")},onSaveSuccess:function(e){var t,n=this,i=n.collection;n.set({id:e.id,commentTime:"a few seconds ago",publishDate:moment().fromNow()}),n.trigger("comment.postSuccess",n),_.isUndefined(n.get("inReplyTo"))?i.add(n,{at:0}):(t=i.indexOf(i.findWhere({id:n.get("inReplyTo")})),i.add(n,{at:t+1}),i.dirtyTree=!0)},onSaveError:function(e){var t,n;e&&e.responseJSON&&(e=e.responseJSON),n=e&&e.validationErrors?1<(t=Object.keys(e.validationErrors)).length?Ibles.text.errors.incompleteFormError:e.validationErrors[t[0]]:Ibles.extractErrorMessage(e,Ibles.text.errors.somethingWentWrong),this.trigger("comment.postError",n)},toggleVote:function(){var t=this,e={commentId:t.get("id")},n=t.get("voted");return e.value=n?0:1,Ibles.API.jsonPostRequest("addRating",e,{success:function(){var e=t.get("rating");n=!n,t.set({voted:n,rating:n?++e:--e})}})},toggleBestAnswer:function(){var e=this,t=e.isBestAnswer()?["answer"]:["answer","bestAnswer"];return Ibles.API.jsonPostRequest("setDesignations",{commentId:e.get("id"),designations:t}).done(function(){e.set({designations:t})})},deleteComment:function(){return Ibles.API.postRequest("deleteComment",{id:this.get("id")},{success:this.onDeleteSuccess})},onDeleteSuccess:function(){var e=this;0<e.collection.getChildrenArray(e).length?e.setDeletedBody():e.collection.remove(e)},deleteThread:function(){var e=this;return Ibles.API.postRequest("deleteThread",{id:this.get("id")},{success:function(){e.collection.deleteThread(e)}})},setIMadeIt:function(e){var t={id:this.get("id"),value:e};return $.ajax({url:"/json-api/setIMadeIt",dataType:"json",type:"POST",data:t})},flagComment:function(e){var t={id:this.get("id"),flag:e};return Ibles.API.postRequest("setFlag",t)},limbo:function(){var e=this;return Ibles.API.jsonPostRequest("adminComment",{id:this.get("id"),status:"LIMBO"}).done(function(){e.set({limbo:!0,quarantined:!1,status:"LIMBO"})})},quarantine:function(){var e=this;return Ibles.API.jsonPostRequest("adminComment",{id:this.get("id"),status:"QUARANTINED"}).done(function(){e.set({quarantine:!0,limbo:!1,status:"QUARANTINED"})})},publish:function(){var e=this;return Ibles.API.jsonPostRequest("adminComment",{id:this.get("id"),status:"PUBLISHED"}).done(function(){e.set({limbo:!1,quarantine:!1,status:"PUBLISHED"})})},toggleStickyComment:function(e){var t=this;return Ibles.API.jsonPostRequest("adminComment",{id:this.get("id"),sticky:e}).done(function(){t.set({sticky:e})})},toggleApproval:function(e){var t=this;return Ibles.API.jsonPostRequest("adminComment",{id:this.get("id"),approved:e}).done(function(){t.set({approved:e})})},cloneWithoutUserSuppliedData:function(){var e=this.clone();return e.set({id:null,fileSet:new Ibles.collections.FileCollection,IMadeIt:!1,body:""}),e},toJSON:function(){var e=this;return _.extend(_.clone(e.attributes),{isTip:e.isTip(),isQuestion:e.isQuestion(),isAnswer:e.isAnswer(),isBestAnswer:e.isBestAnswer(),isReply:e.isReply(),avatar:e.getAuthorAvatarUrl()})}}),function(a){a.package("Ibles.collections"),a.collections.CommentCollection=Backbone.Collection.extend({model:a.models.CommentModel,dirtyTree:!1,apiEndPoint:"getComments",defaultFetchParams:{offset:0,limit:50,sort:"RECENT"},fetchOptions:["limit","offset","sort","instructableId","topicId","commentId","designation","IMadeIt"],additionOptions:["modelOptions","ratingOptions","numVisibleReplies","fetchRatings"],initialize:function(e,t){var n=t||{},i=this.fetchOptions;this.options=_.pick(n,i.concat(this.additionOptions)),this.fetchParams=_.extend(_.clone(this.defaultFetchParams),_.omit(_.pick(n,i,_.isUndefined))),this.modelProps=_.pick(n,n.modelOptions),n.fetchRatings&&a.session.isEmailVerified()&&(this.userRatingsPromise=this.fetchUserRatings())},deleteThread:function(e){var t=this.getChildrenArray(e),n=this.getParents(e);this.remove(t),this.remove(e),this.remove(n)},getLastThreadInfo:function(){var e=this,t=e.length,n=e.reloadingTree||!t,i=n?-1:_.findLastIndex(e.models,function(e){return!e.get("inReplyTo")}),s=-1!==(s=n?-1:_.findLastIndex(e.models.slice(i),function(e){return e.get("lastVisibleInThread")}))?s+i:-1;return{lastComment:n?null:e.models[t-1],lastVisibleInThread:0<=s?e.at(s):null,repliesCount:n||-1===i?0:t-i-1}},parseComments:function(e){var n=this,i=n.options.numVisibleReplies,s=_.isNumber(i),t=s?n.getLastThreadInfo():{},r=t.lastVisibleInThread,o=t.lastComment,a=t.repliesCount,l=e.comments,c=n.userRatingsPromise;return l.forEach(function(t){_.extend(t,this.modelProps),_.isUndefined(t.author)&&(t.author=null,t.authorUrl="/"),c&&c.done(function(e){t.voted=!!e[t.id]}),s&&(_.extend(t,{visible:!0,lastVisibleInThread:!1}),t.inReplyTo?i<(a+=1)&&(t.visible=!1,o&&n.isVisible(o)&&(n.setLastVisibleInThread(o,a),r=o)):(r&&(n.setNumberOfRepliesFromComment(r,a),r=null),a=0)),o=t},this),s&&r&&n.setNumberOfRepliesFromComment(r,a),l},isVisible:function(e){return e.visible||e.cid&&e.get("visible")},setLastVisibleInThread:function(e,t){var n=t-1;e.cid?e.set({lastVisibleInThread:!0,indexInReplyThread:n},{silent:!0}):(e.lastVisibleInThread=!0,e.indexInReplyThread=n)},setNumberOfRepliesFromComment:function(e,t){var n;e.cid?(n=e.get("inReplyTo")?t-1-e.get("indexInReplyThread"):t,e.set({numRepliesFromMe:n})):(n=e.inReplyTo?t-1-e.indexInReplyThread:t,e.numRepliesFromMe=n)},fetch:function(e){var t=this;return this.dirtyTree?this.reloadCommentTree():this.fetchRequest(_.extend({offset:this.fetchParams.offset+this.length},e),function(e){t.add(e),e.length<t.fetchParams.limit&&t.trigger("noMoreComments")})},fetchRequest:function(e,t){function n(){return a.API.getRequest(o,_.extend({},s,e),{success:function(e){t(i.parseComments(e))}})}var i=this,s=i.fetchParams,r=i.userRatingsPromise,o=i.apiEndPoint;return r?r.then(n):n()},reloadCommentTree:function(){var t=this,n=this.length+this.fetchParams.limit;return this.reloadingTree=!0,this.dirtyTree=!1,this.fetchRequest({offset:0,limit:n},function(e){t.reset(e),e.length<n&&t.trigger("noMoreComments"),t.reloadingTree=!1})},getParents:function(e){var n=this,i=[],s=function(e){var t=e.get("inReplyTo");if(_.isUndefined(t))return i;i.push(t),_.isUndefined(n.get(t))||s(n.get(t))};return s(e)},getChildrenArray:function(e){var n=this,i=[],s=function(e){var t=n.where({inReplyTo:e.get("id")});0<t.length&&(i=i.concat(_.pluck(t,"id")),_.each(t,s))};return s(e),i},getRatingsParams:function(){var e=this.options;return _.extend({screenName:a.session.get("screenName")},_.pick(e,e.ratingOptions))},fetchUserRatings:function(){var n,e,t,i=a.commentRatingsPromises,s=this.getRatingsParams();return _.isUndefined(i)&&(a.commentRatingsPromises=i={}),t=i[e=_.flatten(_.pairs(s)).join("-")],_.isEmpty(t)?(n=$.Deferred(),a.API.getRequest("getRatings",s).then(function(e){var t={};_.each(e.ratings,function(e){t[e.id]=!0}),n.resolve(t)}),i[e]=n.promise()):t}})}(Ibles),function(o){o.package("Ibles.views"),o.views.BaseCommentView=Backbone.View.extend({photosSelector:".js-photos",attachmentsSelector:".js-attachments",bodySelector:".js-body",htmlPreRendered:!1,showPhotos:!0,showAttachments:!0,upvotingEnabled:!0,replyEnabled:!0,lazyImage:!0,manager:null,imageTemplate:null,fileTemplate:_.template(o.JST["comment-attached-file"]),template:_.template(o.JST["comment-item"]),showRepliesTemplate:_.template(o.JST["comment-hidden-replies-toggler"]),authorOptsTemplate:_.template(o.JST["comment-author-opts"]),events:{"click .js-reply":"onClickReply","click .js-reply-parent":"scrollToParent","click .js-vote-btn, .js-vote-count":"toggleVote","click .js-show-replies":"showRemainingRepliesInThread","click .js-toggle-best-answer":"toggleBestAnswer","click .js-del-comment":"deleteComment","click .js-del-thread":"deleteThread"},initialize:function(e){var t=this;_.extend(t,_.pick(e,["manager","htmlPreRendered","showPhotos","showAttachments","upvotingEnabled","replyEnabled","lazyImage"])),!t.model&&t.htmlPreRendered&&(t.model=t.makeCommentModelFromEl(),t.collection.add(t.model)),t.listenTo(t.model,"change:numRepliesFromMe",t.updateNumRepliesFromMe),t.listenTo(t.model,"change:visible",t.toggleVisibility),t.listenTo(t.model,"remove",t.remove)},makeCommentModelFromEl:function(){var e=this.$el,t=this.manager,n=e.data(),i=e.find(".js-show-replies"),s=!!i.length,r=s?i.data("num-hidden"):null;return new o.models.CommentModel({id:n.id,stepId:n.stepid,inReplyTo:n.inreplyto,body:e.find(".text").text(),author:e.find(".user").text(),authorId:n.authorid,approved:!!n.approved,visible:!e.hasClass("hide"),lastVisibleInThread:s,numRepliesFromMe:r,instructableId:t.model.get("id")},{collection:this.collection})},getTemplateContext:function(){var e=this,t=e.model,n=e.manager.additionalCommentContext;return _.extend(e.model.toJSON(),{upvotingEnabled:e.upvotingEnabled,replyEnabled:e.replyEnabled,lazyImage:e.lazyImage,hasChildren:t.hasChildren()},n?n(t):{})},afterFilesRendered:function(){},scrollToParent:function(e){e.preventDefault(),this.manager.scrollToComment(this.model.get("inReplyTo"))},toggleVisibility:function(){this.$el[this.model.get("visible")?"removeClass":"addClass"]("hide")},showRemainingRepliesInThread:function(){var e=this.model;this.$(".js-show-replies").hide(),this.manager.showRepliesStartingFromModel(this.model),e.set({lastVisibleInThread:!1},{silent:!0})},updateNumRepliesFromMe:function(){var e,t,n=this,i=n.showRepliesTemplate,s=n.model.get("numRepliesFromMe"),r=n.$(".js-show-replies"),o=i({replyCountlabel:n.getReplyCountLabel(s)});r.length?r.replaceWith(o):(e=[n.attachmentsSelector,n.photosSelector,n.bodySelector],_.find(e,function(e){return!!(t=n.$(e)).length}),t.after(o))},getReplyCountLabel:function(e){var t=this.model.isQuestion()?"{0} answer{0}".format(e,1<e?"s":""):"{0} {1}".format(e,1<e?"replies":"reply");return t},render:function(){var e,t=this,n=t.$el;return t.model.setReplyAuthor(),t.htmlPreRendered||(e=t.getTemplateContext(),t.setElement(t.template(e)),n[0].parentNode&&n.replaceWith(t.$el)),t.renderAuthorIndicator(),t.showVoting(),t.showBestAnswerToggle(),t.renderFiles(),this},renderFiles:function(){this.renderPhotos(),this.renderAttachments(),this.afterFilesRendered()},renderPhotos:function(){var t,n,i,e,s=this;s.showPhotos&&(t=s.model,n=s.imageTemplate,i=s.$(s.photosSelector),e=t.get("fileSet").getImages(),_.each(e,function(e){i.append(n(_.extend(e.toJSON(),{commentId:t.get("id"),imageLink:e.getLargeAnimationUrl(),imageSrc:o.isMobile()?e.getSquareAnimationUrl():e.getSquare3AnimationUrl(),lazyImage:s.lazyImage})))}))},renderAttachments:function(){var t,n,i,e,s=this;s.showAttachments&&(t=s.model,n=s.fileTemplate,i=s.$(s.attachmentsSelector),e=t.get("fileSet").getAttachments(),_.each(e,function(e){i.append(n(_.extend(e.toJSON(),{commentId:t.get("id"),typeThumbnail:e.getTypeThumbnailUrl(),attachmentUrl:e.getDownloadUrl()})))}))},renderAuthorIndicator:function(){var e,t=this.model,n=this.manager,i=this.$(".author");i.hasClass("owner")||(e=n.model.get("author"),_.isObject(e)&&(e=e.screenName),t.get("author")===e&&i.addClass("owner"))},onClickReply:function(e){e.preventDefault();var t=this;o.requireLogin(function(){t.renderReplyView($(e.target),t.createReplyPostingView(t.model))},{sourcea:"comments:reply"})},createReplyPostingView:function(e){return this.manager.makeReplyPostingView(e)},renderReplyView:function(e,t,n){var i,s,r;e.hide(),t.render(),this.$el.append(t.$el),n&&(i=o.isMobile()?$(".modal.in"):$(".modal-container"),r=i.length?(s=i,t.$el.offset().top-s.offset().top+s.scrollTop()):(s=$("html, body"),t.$el.offset().top),_.delay(function(){s.animate({scrollTop:r},1e3)},250)),this.listenToOnce(t,"posted destroyed",function(){e.show()})},showVoting:function(){var e=this.model;e.currentUserIsAuthor()?this.$(".js-vote").addClass("hide"):e.votableByCurrentUser()&&e.voted()&&this.$(".js-vote-btn").text("Upvoted").addClass("voted")},toggleVote:function(){var e=this,t=e.model;o.requireEmailVerification(function(){t.votableByCurrentUser()&&t.toggleVote().done(function(){e.$(".js-vote-count").text(t.votes()).removeClass("hide"),e.$(".js-vote-btn").text(t.voted()?"Upvoted":"Upvote").toggleClass("voted")})},{sourcea:"upvote"})},showBestAnswerToggle:function(){(this.manager.model.currentUserIsOwner()||o.session.isAdmin())&&this.$(".js-toggle-best-answer").removeClass("hide")},toggleBestAnswer:function(){var e=this,t=e.model;t.toggleBestAnswer().done(function(){e.$(".js-toggle-best-answer").html(t.isBestAnswer()?"Undo Best Answer":"Select as Best Answer")})},deleteComment:function(){new o.views.CommentDeletePrompt({model:this.model,title:"Delete Comment",deleteThread:!1}).render()},deleteThread:function(){new o.views.CommentDeletePrompt({model:this.model,title:"Delete Comment Thread",deleteThread:!0}).render()},destroy:function(){this.stopListening(),this.undelegateEvents(),this.$el.removeData().unbind(),this.manager=null,this.model=null,this.collection=null}})}((window,document,Ibles)),function(e,o){o.package("Ibles.views"),o.views.CommentTypeSelector=Backbone.View.extend({template:_.template(o.JST["comment-posting-view"]),events:{"click .js-type-tip":"renderTipPoster","click .js-type-question":"renderQuestionPoster","click .js-type-comment":"renderCommentPoster"},initialize:function(e){_.extend(this,_.pick(e,["manager"]))},scrollToMe:function(){e.location="#discuss"},renderPoster:function(n){var i=this,s=i.manager,r=n.modelProps;o.requireLogin(function(){var e=new o.views.CommentPostingView({model:s.makeCommentModel(r||{})}),t=n.callback;i.$el.html(e.render().$el),i.listenToOnce(e,"posted destroyed",function(){i.render()}),t&&t()},{sourcea:"comments:selecttype"})},renderPosterForType:function(e){this.renderPoster({modelProps:{designations:[e]}})},renderTipPoster:function(){this.renderPosterForType("tip")},renderQuestionPoster:function(){this.renderPosterForType("question")},renderCommentPoster:function(){this.renderPosterForType("comment")},render:function(){return this.$el.html(this.template({commentBody:"",submitLabel:"Post",isEdit:!1,isIMadeIt:!1,typeSelected:!1,isMobile:o.isMobile(),avatar:o.session.getAvatarUrl()})),this}})}(window,Ibles),function(e,s){s.package("Ibles.views"),s.views.CommentPostingView=Backbone.View.extend({template:_.template(s.JST["comment-posting-view"]),skipUploaderModal:!1,hideOnBlur:!0,recreateOnPost:!1,submitLabel:"",events:{"click .post-btn":"submitPost","click .add-image-btn":"addImages","click .cancel-btn":"onCancel"},initialize:function(e){var t=this;e=e||{},_.bindAll(t,"onSend"),_.extend(t,_.pick(e,["recreateOnPost","hideOnBlur","skipUploaderModal","isEdit"])),t.listenTo(t.model,"comment.postError",t.renderError),t.manager=e.manager,t.hideOnBlur&&setTimeout(function(){t.setupHideOnBlur()},0)},setupHideOnBlur:function(){var t="click.{0}".format(_.uniqueId("outside")),n=$(e),i=this;n.on(t,function(e){i.$(".js-body-input").val().length||0!=$(e.target).closest([".js-comment-poster",".discuss",".modal",".modal-backdrop",".dropdown-backdrop"].join(",")).length||(n.off(t),i.destroyAndRemove(),i.trigger("canceled"))})},getTemplateContext:function(){var e=this.model,t=e.hasDesignation(),n=e.isIMadeIt();return _.extend(e.toJSON(),{commentBody:e.get("body"),submitLabel:this.submitLabel,isMobile:s.isMobile(),isIMadeIt:n,isEdit:!!this.isEdit,typeSelected:t||n})},render:function(){var e=this,t=e.getTemplateContext(),n=s.session.authenticated(),i=s.isMobile();return e.$el.html(e.template(t)),n&&e.createImageBucket(),!i&&n&&e.enableRedactorToolbar(),i&&e.$(".js-body-input").on("change keyup keydown paste cut",function(){$(this).height(0).height(this.scrollHeight)}),e},renderError:function(e){this.$(".alert-error").text(e).show()},createImageBucket:function(){var e=this,t=e.model.get("fileSet"),n=e.$(".uploading-indicator");e.imageBucket=new s.views.ImageBucketView({el:e.$(".image-bucket"),collection:t,skipUploaderModal:e.skipUploaderModal,multiple:!0}),e.listenTo(e.imageBucket,"imagebucket:uploading imagebucket:uploadcomplete",function(){n.toggle()})},enableRedactorToolbar:function(){this.redactorView=new s.views.RedactorTextAreaView({el:this.$(".js-redactor-container"),redactorOptions:{focus:!0,plugins:["instructablesAir"],linebreaks:!0}})},validate:function(){var e=this,t=!0;return e.$(".js-body-input").val()&&!e.$(".redactor_placeholder").length||(e.renderError("Please type your comment before posting."),t=!1),e.model.get("IMadeIt")&&!e.imageBucket.collection.models.length&&(e.renderError("Please attach images to show what you made!"),t=!1),t},submitPost:function(){var t=this,n=t.model;s.requireLogin(function(){var e;t.$(".alert-error").hide(),t.validate()&&((e=t.$(".post-btn")).prop("disabled",!0),n.set({body:t.$(".js-body-input").val().replace(/\n/g,"<br/>")}),n.set({fileSet:new s.collections.FileCollection(t.imageBucket.collection.models)}),t.sendRequest().done(t.onSend).always(function(){e.prop("disabled",!1)}))},{sourcea:"comments:post"})},sendRequest:function(){return this.model.save()},addImages:function(){var e=this;s.requireLogin(function(){e.imageBucket.addImages()},{sourcea:"comments:addImages"})},onSend:function(){var e,t,n=this;$(".redactor_air").hide(),n.recreateOnPost?((t=(e=n.model).cloneWithoutUserSuppliedData()).collection=e.collection,n.destroy(),new n.constructor({el:n.$el,recreateOnPost:!0,model:t}).render()):n.destroyAndRemove(),n.trigger("posted")},onCancel:function(){$(".redactor_air").hide(),this.destroyAndRemove(),this.trigger("canceled")},destroy:function(){var e=this;e.$(".js-body-input").off().val(""),e.stopListening(),e.undelegateEvents(),e.$el.removeData().unbind(),e.model=null,e.imageBucket&&(e.imageBucket.destroy(),e.imageBucket=null),e.redactorView&&e.redactorView.reset(),e.manager=null,e.trigger("destroyed")},destroyAndRemove:function(){this.destroy(),this.$el.remove()}})}((window,document),Ibles),function(e){e.package("Ibles.views"),e.views.CommentReplyPostingView=e.views.CommentPostingView.fullExtend({hideOnBlur:!1,submitLabel:"Reply"})}(Ibles),function(e){e.package("Ibles.views"),e.views.CommentEditView=e.views.CommentPostingView.fullExtend({submitLabel:"Save",sendRequest:function(){return this.model.editRequest()},getTemplateContext:function(){return _.extend(this._super(),{isEdit:!0,typeSelected:!0})}})}(Ibles),function(n,s,r){r.package("Ibles.views"),r.views.CommentsManager=Backbone.View.extend({listSelector:".js-comments",itemSelector:".js-comment",moreSelector:".js-more-comments",model:null,numCommentsToLoad:50,numVisibleReplies:0,fetchIMadeItsOnly:!1,saveIMadeItsOnly:!1,skipUploaderModal:!1,fetchRatings:!1,events:{"click .js-more-comments":"addComments","click .js-show-poster":"renderPoster"},initialize:function(e){var t=this,n=r.session.authenticated();_.bindAll(t,"renderComment","renderAllComments","onCommentAdded","showCommentFromUrl"),_.extend(t,_.pick(e,["fetchIMadeItsOnly","saveIMadeItsOnly","skipUploaderModal","fetchRatings","numVisibleReplies","numCommentsToLoad","additionalCommentContext"])),t.setSubviewClasses(),t.setCommentModelClasses(),t.setCommentCollection(),n||t.createCommentViewsFromDOM();var i=t.collection;t.listenTo(i,"add",t.onCommentAdded),t.listenTo(i,"reset",t.onCommentsLoaded),t.listenToOnce(i,"noMoreComments",t.noMoreComments),this.shouldReloadCommentTree()?this.reloadCommentTree(t.showCommentFromUrl):t.showCommentFromUrl()},shouldReloadCommentTree:function(){return r.session.authenticated()},reloadCommentTree:function(e){this.collection&&this.collection.reloadCommentTree().done(e)},setSubviewClasses:function(){this.postingView=r.views.CommentPostingView,this.commentView=r.views.CommentView,this.editView=r.views.CommentEditView,this.replyPostingView=r.views.CommentReplyPostingView},createCommentViewsFromDOM:function(){var n=[],i=this;i.$(i.listSelector).children(i.itemSelector).each(function(){var e=$(this),t=i.makeCommentView({el:e,htmlPreRendered:!0});t.render(),n.push(t)}),i.commentItemViews=n},setCommentModelClasses:function(){this.commentModelClass=r.models.CommentModel,this.commentCollectionClass=r.collections.CommentCollection},setCommentCollection:function(){var e=this;e.collection||(e.collection=new this.commentCollectionClass([],_.extend({limit:e.numCommentsToLoad,numVisibleReplies:e.numVisibleReplies,IMadeIt:e.fetchIMadeItsOnly,fetchRatings:e.fetchRatings},e.getExtraCollectionProps())))},getExtraCollectionProps:function(){return{instructableId:this.model.get("id"),ratingOptions:["instructableId"],modelOptions:["instructableId"]}},makeCommentModel:function(e){return new this.commentModelClass(_.extend({},{instructableId:this.model.get("id"),IMadeIt:this.saveIMadeItsOnly},e),{collection:this.collection})},makeCommentView:function(e){return new this.commentView(_.extend({},{collection:this.collection,manager:this},e))},makeReplyPostingModel:function(e){return this.makeCommentModel({inReplyTo:e.get("id"),replyAuthor:e.get("author"),designations:e.isQuestion()?["answer"]:["comment"]})},makeReplyPostingView:function(e){return new this.replyPostingView({skipUploaderModal:this.skipUploaderModal,model:this.makeReplyPostingModel(e)})},makeEditView:function(e){return new(this.editView||this.postingView)({model:e,manager:this,collection:this.collection,skipUploaderModal:this.skipUploaderModal,isEdit:!0})},addComments:function(){this.collection.fetch()},noMoreComments:function(){this.$(this.moreSelector).hide()},onCommentAdded:function(e,t){this.renderComment(e,t)},onCommentsLoaded:function(){this.renderAllComments()},renderComment:function(e){var t=this,n=t.makeCommentView({model:e}).render().$el,i=t.$(t.itemSelector),s=e.collection.indexOf(e),r=t.listSelector;0===s?t.$(r).prepend(n):s===i.length?t.$(r).append(n):i.eq(s).before(n),t.$el.removeClass("hide")},renderAllComments:function(){var e=this.$(this.listSelector);_.each(this.commentItemViews,function(e){e.destroy()}),e.css({"min-height":e.outerHeight()}),e.empty(),this.collection.each(this.renderComment),e.css({"min-height":"initial"})},renderPoster:function(i){var s=this;i.preventDefault(),r.requireLogin(function(){var e=new s.postingView({model:s.makeCommentModel({designations:["comment"]}),skipUploaderModal:s.skipUploaderModal,manager:s}),t=e.render().$el.hide(),n=$(i.target);s.$el.append(t),t.show("slow"),n.attr("disabled",!0),s.listenToOnce(e,"posted destroyed",function(){n.attr("disabled",!1)}),s.listenToOnce(e,"posted",function(){var e=s.$el;e.removeClass("hide"),$("body,html").animate({scrollTop:e.offset().top},"slow")})},{sourcea:"comments:showPoster"})},getCommentIdFromUrl:function(){return n.location.hash.slice(1).replace("comment-","")||r.Q("commentId")},hasCommentId:function(e){return!!this.collection.get(e)},showAllComments:function(){this.$(".js-show-replies").click()},showCommentFromUrl:function(){var e=this,t=e.getCommentIdFromUrl();t&&e.hasCommentId(t)&&(e.showAllComments(),n.setTimeout(function(){e.scrollToComment(t)},100))},scrollToComment:function(e){var t,n,i=e&&$('[data-id="'+e+'"]');i&&(t=i.offset().top-$("#ible-header").outerHeight()-50,n="true"===r.Q("reply"),$(s).scrollTop(t),n&&i.find(".js-reply").click())},showRepliesStartingFromModel:function(e){for(var t,n=this.collection,i=n.indexOf(e)+1,s=n.length-1,r=n.models;i<=s&&(t=r[i]).isReply();i++)t.set("visible","true")}})}(window,document,Ibles),function(e){e.package("Ibles.views"),e.views.CommentDeletePrompt=e.views.BaseModalView.fullExtend({events:{"click .delete-btn":"deleteComment"},initialize:function(e){this._super(_.extend({wrapContent:!0,modalClass:"delete-prompt"},e))},getTemplate:function(){return _.template(e.JST["comment-delete-prompt"])},deleteComment:function(e){e.preventDefault(),$(e.currentTarget).html($("<span class='spinner'></span>")[0]).addClass("disabled"),this.showDeleteAction(this.options.deleteThread?this.model.deleteThread():this.model.deleteComment())},showDeleteAction:function(e){var t=this;e.then(function(){t.dismiss()}).fail(function(){t.$(".cancel-btn").remove(),t.$(".delete-btn").remove(),t.$(".alert-error").removeClass("hide")})}})}(Ibles),Ibles.package("Ibles.views"),Ibles.views.CommentRepliesManager=Ibles.views.CommentsManager.fullExtend({model:null,collection:null,initialize:function(e){this._super(e),this.comment=e.comment},shouldReloadCommentTree:function(){return!0},onCommentsLoaded:function(){this.hydratePrimaryCommentModel(),this.renderAllComments()},makeCommentView:function(e){return this._super(_.extend({lazyImage:!1},e))},hydratePrimaryCommentModel:function(){var e=this.comment,t=e.get("id"),n=this.collection.get(t);n&&e.set(n.attributes,{silent:!0})},renderAllComments:function(){var t=this,n=t.collection;n.each(function(e){t.renderComment(e,n)})}}),Ibles.package("Ibles.views"),Ibles.views.CommentModal=Ibles.views.BaseModalView.fullExtend({template:_.template(Ibles.JST["comment-modal"]),model:null,modalEventNamespace:"CommentModal",browserScrollable:!0,events:{"click .js-next":"nextComment","click .js-prev":"previousComment"},initialize:function(e){this._super(e),this.repliesCollection=this.createRepliesCollection(),this.repliesView=this.createRepliesView(),this.listenTo(this.repliesCollection,"reset",this.renderComponents)},createRepliesCollection:function(){return new Ibles.collections.CommentCollection([],{commentId:this.model.get("id"),instructableId:this.options.instructableModel.get("id")})},createRepliesView:function(){return new Ibles.views.CommentRepliesManager({el:this.$(".js-replies"),model:this.options.instructableModel,comment:this.model,collection:this.repliesCollection,skipUploaderModal:!0})},nextComment:function(){var e=this.model,t=e.collection,n=t.indexOf(e),i=n===t.length-1?0:n+1;Ibles.Events.trigger("{0}:next".format(this.modalEventNamespace),i)},previousComment:function(){var e=this.model,t=e.collection,n=t.indexOf(e),i=0===n?t.length-1:n-1;Ibles.Events.trigger("{0}:prev".format(this.modalEventNamespace),i)},getTemplateContext:function(){var e=this.model;return _.extend(this._super(),e.toJSON(),{hideNavigation:1===e.collection.length})},modalHidden:function(){this.model=null,this.repliesCollection=null,this.repliesView=null},renderComponents:function(){this.renderPrimaryComment(),this.model.get("fileSet").hasImages()&&this.renderCommentGallery()},renderPrimaryComment:function(){this.repliesView.makeCommentView({model:this.model,el:this.$(".js-primary-comment"),showPhotos:!1,lazyImage:!1}).render()},renderCommentGallery:function(){var e=_.template(Ibles.JST["comment-modal-gallery"]),t=Ibles.isMobile()?175:450,n=this.$(".modal-body").width(),i=this.model.get("fileSet").getImages(),s=this.galleryWillScroll(i,n,t);this.$(".js-gallery").append(e({galleryHeight:s?t:void 0,imageFiles:i,willScroll:s})),new Ibles.views.ScrollableCardsView({el:this.$(".js-gallery").children().first()})},galleryWillScroll:function(e,t,n){var i,s=e&&1<e.length,r=n;return s&&(i=_.reduce(e,function(e,t){return e+r*(t.get("width")/t.get("height"))},0)),s&&t<i}}),Ibles.JST["comment-image-file"]='<a rel="fancybox-thumb-<< commentId >>" href="<< imageLink >>" data-fancybox-href="/file/ << id >>">\n    <[ if (lazyImage) {]>\n        <img class="photo fancybox-thumb lazyload" alt="<< name >>" data-image-id="<< id >>" data-notes=\'<< imageNotes >>\' data-orig-height="<< height >>" data-orig-width="<< width >>" src="<< Ibles.staticUrl(\'img/pixel.png\') >>" data-src="<< imageSrc >>"/>\n    <[ } else { ]>\n        <img class="photo fancybox-thumb" alt="<< name >>" data-image-id="<< id >>" data-notes=\'<< imageNotes >>\' data-orig-height="<< height >>" data-orig-width="<< width >>" src="<< imageSrc >>"/>\n    <[ } ]>\n</a>\n',Ibles.JST["comment-flag-dropdown"]='<div class="action dropdown flag-dropdown hide">\n    <a class="dropdown-toggle" data-toggle="dropdown" href="#"><i class="icon-flag"></i></a>\n    <ul class="dropdown-menu">\n        <li><a class="js-flag" data-flagname="not_nice">Not Nice</a></li>\n        <li><a class="js-flag" data-flagname="inappropriate">Inappropriate</a></li>\n        <li><a class="js-flag" data-flagname="spam">Spam</a></li>\n    </ul>\n</div>\n',Ibles.JST["comment-admin"]='<div class="comment-admin">\n    <span class="checkbox pull-right action">\n        <input type="checkbox" class="js-approved" name=""/>Approved\n    </span>\n    <[ if (hasChildren){]>\n        <a class="action pull-right js-del-thread">[delete thread]</a>\n    <[ } else { ]>\n        <a class="action pull-right js-del-comment">[delete]</a>\n    <[ } ]>\n    <a class="action pull-right js-publish <[ if (!limbo && !quarantine) {]>hide<[}]>">[publish]</a>\n    <a class="action pull-right js-limbo <[ if (limbo) {]>hide<[}]>">[limbo]</a>\n    <a class="action pull-right js-quarantine  <[ if (quarantine) {]>hide<[}]>">[quarantine]</a>\n    <[ if (Ibles.pageContext.ibleData && Ibles.pageContext.ibleData.lessonId) { ]>\n        <a class="action pull-right js-limbo-class-projects">[limbo projects]</a>\n    <[ } ]>\n    <[ if (!inReplyTo) {]>\n    <a class="action pull-right js-to-tip <[ if (designatedTip) {]>hide<[}]>">[tip]</a>\n    <a class="action pull-right js-to-question <[ if (designatedQuestion) {]>hide<[}]>">[question]</a>\n    <a class="action pull-right js-to-comment <[ if (designatedComment) {]>hide<[}]>">[comment]</a>\n    <[ } ]>\n\n    <span class="checkbox pull-right action">\n        <input type="checkbox" class="js-imadeit" <[ if (IMadeIt) {]>checked<[}]>> IMadeIt <span class="alert-error imadeit-warning hide">(images required)</span>\n    </span>\n\n    <span class="checkbox pull-right action">\n        <input type="checkbox" class="js-sticky" name=""/>Feature Comment\n    </span>\n\n    <img class="request-img pull-right hide" src="<< Ibles.staticUrl(\'img/spinner.gif\') >>" height=\'10\' width=\'10\'/>\n    <img class="request-success pull-right hide" src="<< Ibles.staticUrl(\'img/ico_check.gif\') >>" height=\'10\' width=\'10\'/>\n    <img class="request-failure pull-right hide" src="<< Ibles.staticUrl(\'img/ico_cross.gif\') >>" height=\'10\' width=\'10\'/>\n</div>\n',function(u){u.package("Ibles.views"),u.views.CommentView=u.views.BaseCommentView.fullExtend({quarantineMessage:"THIS COMMENT HAS BEEN QUARANTINED",limboMessage:"THIS COMMENT HAS BEEN LIMBOED",imageTemplate:_.template(u.JST["comment-image-file"]),flagTemplate:_.template(u.JST["comment-flag-dropdown"]),adminActionsTemplate:_.template(u.JST["comment-admin"]),events:{"click .js-flag":"flagComment","click .js-to-tip":"makeTip","click .js-to-question":"makeQuestion","click .js-to-comment":"makeComment","click .js-imadeit":"toggleIMadeIt","click .js-edit":"editComment","click .js-limbo":"limboComment","click .js-quarantine":"quarantine","click .js-publish":"publishComment","click .js-sticky":"toggleSticky","click .js-approved":"toggleApproval","click .js-limbo-class-projects":"limboClassProjects"},initialize:function(e){this._super(e)},designate:function(e){this.showRequestFeedback(this.model.setDesignations(e)),this.model.get("IMadeIt")&&this.model.setIMadeIt(!1)},makeTip:function(){this.designate(["tip"])},makeQuestion:function(){this.designate(["question"])},makeComment:function(){this.designate(["comment"])},render:function(){var e,t,n,i=this,s=i.manager,r=i.model,o=u.session,a=o.isAdmin(),l=o.authenticated(),c=r.currentUserIsAuthor(),d=r.authorIsProjectOwner(s.model);return i._super(),a&&(i.$el.append(i.adminActionsTemplate(i.getTemplateContext())),e=r.get("status"),t=r.get("quarantine")||"QUARANTINED"==e,n=r.get("limbo")||"LIMBO"==e,(t||n)&&(i.$(".js-quarantine-message").html(t?i.quarantineMessage:i.limboMessage).show(),i.$(".js-publish").show()),t?i.$(".js-limbo").show():n?i.$(".js-quarantine").show():i.$(".js-limbo, .js-quarantine").show()),l&&i.$(".js-toolbar").prepend(i.flagTemplate()),d&&i.$(".author").addClass("owner"),r.get("author")===o.get("screenName")&&i.$(".js-del-comment").show(),!0===r.get("sticky")&&i.$(".js-sticky").prop("checked",!0),!0===r.get("approved")&&i.$(".js-approved").prop("checked",!0),(c||a)&&i.$(".js-toolbar").prepend(i.authorOptsTemplate(i.getTemplateContext())),i.attachCommentImagesFancybox(),i},flagComment:function(e){this.showRequestFeedback(this.model.flagComment($(e.currentTarget).data("flagname")))},limboComment:function(){this.showRequestFeedback(this.model.limbo()),this.$(".js-limbo").hide(),this.$(".js-publish, .js-quarantine").show(),this.$(".js-quarantine-message").html(this.limboMessage).show()},quarantine:function(){this.showRequestFeedback(this.model.quarantine()),this.$(".js-quarantine").hide(),this.$(".js-publish, .js-limbo").show(),this.$(".js-quarantine-message").html(this.quarantineMessage).show()},publishComment:function(){this.showRequestFeedback(this.model.publish()),this.$(".js-limbo").show(),this.$(".js-publish").hide(),this.$(".js-quarantine-message").hide()},toggleSticky:function(e){this.showRequestFeedback(this.model.toggleStickyComment($(e.currentTarget).prop("checked")))},toggleApproval:function(e){this.showRequestFeedback(this.model.toggleApproval($(e.currentTarget).prop("checked")))},showRequestFeedback:function(e){var t=this;this.$(".request-img").show(),e.then(function(){t.$(".request-img").hide(),t.$(".request-success").show(),t.$(".request-success").fadeOut()}).fail(function(){t.$(".request-img").hide(),t.$(".request-failure").show(),t.$(".request-failure").fadeOut()})},attachCommentImagesFancybox:function(){this.$(this.photosSelector).find("a").fancybox()},editComment:function(){var e=this,t=e.$(".js-edit-container"),n=e.manager.makeEditView(e.model);e.toggleSpaceForEditView(),e.editView=n,t.html(n.render().$el),e.listenTo(n,"canceled",e.onEditViewCanceled),e.listenTo(n,"posted",e.onEditViewPosted)},toggleSpaceForEditView:function(){this.$(".js-edit").toggle(),this.$(".js-hide-on-edit").toggle(),this.$(".js-text").toggle(),this.$(".js-photos").toggle()},onEditViewCanceled:function(){this.editView&&(this.toggleSpaceForEditView(),this.editView.destroy(),this.editView=null)},onEditViewPosted:function(){var e=this,t=e.model,n=e.manager.makeCommentView({model:t,lazyImage:!1}).render();e.editView.destroy(),e.editView=null,e.destroy(),e.$el.replaceWith(n.$el)},limboClassProjects:function(){var i,s,e=this.manager.model.containingCourse;confirm("Do you want to limbo all projects by "+this.model.get("author")+" in this class ("+e.get("title"),NaN)&&(i=this.model.get("authorId"),s=[],_.each(e.get("instructables"),function(e){u.API.getRequest("getComments",{instructableId:e.id,limit:200}).then(function(e){_.each(e.comments,function(e){var t,n;e.authorId!==i||e.limbo||(t={status:"LIMBO",id:e.id},n=u.API.jsonPostRequest("adminComment",t),s.push(n))})})}),this.showRequestFeedback($.when.apply(this,s)))},toggleIMadeIt:function(){var e=this.model,t=this.$(".imadeit-warning");t.hide();var n=e.setIMadeIt(this.$(".js-imadeit").is(":checked"));n.fail(function(){t.show()}),this.showRequestFeedback(n)}}),u.views.DesktopCommentView=u.views.CommentView}(Ibles),Ibles.JST["imadeit-item"]='<li data-id="<< id >>" class="imadeit js-comment <[ if (typeof hidden != \'undefined\' && hidden) {]>hide<[}]>">\n    <[ if (fileSet.models[0].isImage()) { ]>\n        <img class="lazyload" src="<< Ibles.staticUrl(\'img/pixel.png\') >>" data-src="<< fileSet.models[0].getSquare3AnimationUrl() >>">\n    <[ } else if (fileSet.models[0].isVideo()) { ]>\n        <img src="<< Ibles.staticUrl(\'img/placeholder-video.png\') >>" />\n    <[ } else { ]>\n        <img src="<< Ibles.staticUrl(\'img/placeholder-file.png\') >>" />\n    <[ } ]>\n    <h3 class="made-by"><a class="user" href="<< Ibles.reverseUrls.memberUrl(author) >>"><< author >></a> made it!</h3>\n</li>\n',Ibles.JST["imadeit-seemore"]='<li class="see-more">\n    <div class="see-more-inner">\n        <p>See << hiddenCount >> more that made it</p>\n    </div>\n</li>',Ibles.package("Ibles.views"),Ibles.views.ImadeItsManager=Ibles.views.CommentsManager.fullExtend({fetchIMadeItsOnly:!0,saveIMadeItsOnly:!0,events:{"click .see-more":"showHiddenItems"},initialize:function(e){this._super(e),this.listenTo(Ibles.Events,"iMadeItModal:next iMadeItModal:prev",this.onImadeItModalNav)},setSubviewClasses:function(){this._super(),this.commentView=Ibles.views.ImadeItItemView},setCommentModelClasses:function(){this.commentModelClass=Ibles.models.CommentModel,this.commentCollectionClass=Ibles.collections.ImadeItCollection},onCommentsLoaded:function(){this.setHiddenModels(),this.renderAllComments(),this.renderSeeMoreToggler()},onImadeItModalNav:function(e){new Ibles.views.ImadeItModal({model:this.collection.at(e),instructableModel:this.model}).render()},renderSeeMoreToggler:function(){var e,t=this.getHiddenCount();0<t&&(e=_.template(Ibles.JST["imadeit-seemore"]),this.$(this.listSelector).append(e({hiddenCount:t})))},showHiddenItems:function(){var e=this;Ibles.requireLogin(function(){e.$(".see-more").hide(),e.$("li.hide").removeClass("hide")},{sourcea:"imadeitSeeMore"})},showAllComments:function(){this.showHiddenItems()},getHiddenCount:function(){var e=this.collection.length,t=0;return 9<e?t=e-9:4<e&&9!=e&&(t=e-4),t},setHiddenModels:function(){var e=this.collection,n=e.length-this.getHiddenCount();e.each(function(e,t){e.set("hidden",n<=t)})}}),Ibles.package("Ibles.views"),Ibles.views.ImadeItItemView=Ibles.views.CommentView.fullExtend({template:_.template(Ibles.JST["imadeit-item"]),events:{click:"renderModal"},makeCommentModelFromEl:function(){var e=this.$el,t=(e.find("img").attr("src")||"").split("?")[0];return this.manager.makeCommentModel({id:e.data().id,author:e.find(".user").text(),files:[{originalUrl:t}]})},renderModal:function(){new Ibles.views.ImadeItModal({model:this.model,instructableModel:this.manager.model}).render()},onEditViewPosted:function(){this.manager.reloadCommentTree()}}),Ibles.package("Ibles.collections"),Ibles.collections.ImadeItCollection=Ibles.collections.CommentCollection.extend({apiEndPoint:"searchComments",getExtraCollectionProps:function(){return _.extend(this.super(),{IMadeIt:!0})}}),Ibles.package("Ibles.views"),Ibles.views.ImadeItModal=Ibles.views.CommentModal.fullExtend({modalClass:"imadeit-modal",modalEventNamespace:"iMadeItModal"}),Ibles.JST["hamburger-menu-auth-section"]='<div id="auth-section" class="clearfix">\n    <li class="auth-section-links">\n        <a class="main-menu profile-link" data-bypass="true" href="<< memberUrl >>">\n            <img class="avatar" src="<< avatarUrl >>"/> Profile\n        </a>\n        <a class="main-menu logout-link btn-logout">\n            Logout\n        </a>\n    </li>\n</div>\n',window.Modernizr=function(i,u,o){function t(e){p.cssText=e}function r(e,t){return typeof e===t}function s(e,t){return!!~(""+e).indexOf(t)}function a(e,t){for(var n in e){var i=e[n];if(!s(i,"-")&&p[i]!==o)return"pfx"!=t||i}return!1}function l(e,t,n){var i=e.charAt(0).toUpperCase()+e.slice(1),s=(e+" "+y.join(i+" ")+i).split(" ");return r(t,"string")||void 0===t?a(s,t):function(e,t,n){for(var i in e){var s=t[e[i]];if(s!==o)return!1===n?e[i]:r(s,"function")?s.bind(n||t):s}return!1}(s=(e+" "+_.join(i+" ")+i).split(" "),t,n)}function e(e,t,n,i){var s,r,o,a,l=u.createElement("div"),c=u.body,d=c||u.createElement("body");if(parseInt(n,10))for(;n--;)(o=u.createElement("div")).id=i?i[n]:m+(n+1),l.appendChild(o);return s=["&#173;",'<style id="s',m,'">',e,"</style>"].join(""),l.id=m,(c?l:d).innerHTML+=s,d.appendChild(l),c||(d.style.background="",d.style.overflow="hidden",a=f.style.overflow,f.style.overflow="hidden",f.appendChild(d)),r=t(l,e),c?l.parentNode.removeChild(l):(d.parentNode.removeChild(d),f.style.overflow=a),!!r}var n,c,d,h={},f=u.documentElement,m="modernizr",p=u.createElement(m).style,g=u.createElement("input"),b=":)",v=" -webkit- -moz- -o- -ms- ".split(" "),w="Webkit Moz O ms",y=w.split(" "),_=w.toLowerCase().split(" "),I={},k={},C={},x=[],S=x.slice,A=(c={select:"input",change:"input",submit:"form",reset:"form",error:"img",load:"img",abort:"img"},function(e,t){t=t||u.createElement(c[e]||"div");var n=(e="on"+e)in t;return n||(t.setAttribute||(t=u.createElement("div")),t.setAttribute&&t.removeAttribute&&(t.setAttribute(e,""),n=r(t[e],"function"),void 0===t[e]||(t[e]=o),t.removeAttribute(e))),t=null,n}),T={}.hasOwnProperty,E=void 0!==T&&void 0!==T.call?function(e,t){return T.call(e,t)}:function(e,t){return t in e&&void 0===e.constructor.prototype[t]};for(d in Function.prototype.bind||(Function.prototype.bind=function(i){var s=this;if("function"!=typeof s)throw new TypeError;var r=S.call(arguments,1),o=function(){if(this instanceof o){function e(){}e.prototype=s.prototype;var t=new e,n=s.apply(t,r.concat(S.call(arguments)));return Object(n)===n?n:t}return s.apply(i,r.concat(S.call(arguments)))};return o}),I.flexbox=function(){return l("flexWrap")},I.flexboxlegacy=function(){return l("boxDirection")},I.touch=function(){var t;return"ontouchstart"in i||i.DocumentTouch&&u instanceof DocumentTouch?t=!0:e(["@media (",v.join("touch-enabled),("),m,")","{#modernizr{top:9px;position:absolute}}"].join(""),function(e){t=9===e.offsetTop}),t},I.rgba=function(){return t("background-color:rgba(150,255,150,.5)"),s(p.backgroundColor,"rgba")},I.multiplebgs=function(){return t("background:url(https://),url(https://),red url(https://)"),/(url\s*\(.*?){3}/.test(p.background)},I.boxshadow=function(){return l("boxShadow")},I.textshadow=function(){return""===u.createElement("div").style.textShadow},I.opacity=function(){return t(v.join("opacity:.55;")+""),/^0.55$/.test(p.opacity)},I.cssanimations=function(){return l("animationName")},I.cssgradients=function(){var e="background-image:";return t((e+"-webkit- ".split(" ").join("gradient(linear,left top,right bottom,from(#9f9),to(white));"+e)+v.join("linear-gradient(left top,#9f9, white);"+e)).slice(0,-e.length)),s(p.backgroundImage,"gradient")},I.csstransforms=function(){return!!l("transform")},I.csstransforms3d=function(){var n=!!l("perspective");return n&&"webkitPerspective"in f.style&&e("@media (transform-3d),(-webkit-transform-3d){#modernizr{left:9px;position:absolute;height:3px;}}",function(e,t){n=9===e.offsetLeft&&3===e.offsetHeight}),n},I.csstransitions=function(){return l("transition")},I.generatedcontent=function(){var t;return e(["#",m,"{font:0/0 a}#",m,':after{content:"',b,'";visibility:hidden;font:3px/1 a}'].join(""),function(e){t=3<=e.offsetHeight}),t},I)E(I,d)&&(n=d.toLowerCase(),h[n]=I[d](),x.push((h[n]?"":"no-")+n));return h.input||(h.input=function(e){for(var t=0,n=e.length;t<n;t++)C[e[t]]=e[t]in g;return C.list&&(C.list=!!u.createElement("datalist")&&!!i.HTMLDataListElement),C}("autocomplete autofocus list placeholder max min multiple pattern required step".split(" ")),h.inputtypes=function(e){for(var t,n,i,s=0,r=e.length;s<r;s++)g.setAttribute("type",n=e[s]),(t="text"!==g.type)&&(g.value=b,g.style.cssText="position:absolute;visibility:hidden;",/^range$/.test(n)&&g.style.WebkitAppearance!==o?(f.appendChild(g),t=(i=u.defaultView).getComputedStyle&&"textfield"!==i.getComputedStyle(g,null).WebkitAppearance&&0!==g.offsetHeight,f.removeChild(g)):/^(search|tel)$/.test(n)||(t=/^(url|email)$/.test(n)?g.checkValidity&&!1===g.checkValidity():g.value!=b)),k[e[s]]=!!t;return k}("search tel url email datetime date month week time datetime-local number range color".split(" "))),h.addTest=function(e,t){if("object"==typeof e)for(var n in e)E(e,n)&&h.addTest(n,e[n]);else{if(e=e.toLowerCase(),h[e]!==o)return h;t="function"==typeof t?t():t,f.className+=" "+(t?"":"no-")+e,h[e]=t}return h},t(""),g=null,h._version="2.7.0",h._prefixes=v,h._domPrefixes=_,h._cssomPrefixes=y,h.hasEvent=A,h.testProp=function(e){return a([e])},h.testAllProps=l,h.testStyles=e,h.prefixed=function(e,t,n){return t?l(e,t,n):l(e,"pfx")},f.className=f.className.replace(/(^|\s)no-js(\s|$)/,"$1$2")+(" js "+x.join(" ")),h}(this,this.document),function(a,t){"use strict";var n=t.Modernizr,i=a("body");a.DLMenu=function(e,t){this.$el=a(t),this._init(e)},a.DLMenu.defaults={animationClasses:{classin:"dl-animate-in-1",classout:"dl-animate-out-1"},onLevelClick:function(e,t){return!1},onLinkClick:function(e,t){return!1}},a.DLMenu.prototype={_init:function(e){this.options=a.extend(!0,{},a.DLMenu.defaults,e),this._config(),n&&(this.animEndEventName={WebkitAnimation:"webkitAnimationEnd",OAnimation:"oAnimationEnd",msAnimation:"MSAnimationEnd",animation:"animationend"}[n.prefixed("animation")]+".dlmenu",this.transEndEventName={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd",msTransition:"MSTransitionEnd",transition:"transitionend"}[n.prefixed("transition")]+".dlmenu",this.supportAnimations=n.cssanimations,this.supportTransitions=n.csstransitions),this._initEvents()},_config:function(){this.open=!1,this.$trigger=this.$el.children(".dl-trigger"),this.$menu=this.$el.children("ul.dl-menu"),this.$menuitems=this.$menu.find("li:not(.dl-back)"),this.$el.find("ul.dl-submenu").prepend('<li class="dl-back"><a href="#">back</a></li>'),this.$back=this.$menu.find("li.dl-back")},_initEvents:function(){var o=this;this.$trigger.on("click.dlmenu",function(){return o.open?o._closeMenu():o._openMenu(),!1}),this.$menuitems.on("click.dlmenu",function(e){var t=a(this),n=t.children("ul.dl-submenu");if(t.hasClass("passthrough")||e.stopPropagation(),0<n.length){var i=n.clone().css("opacity",0).insertAfter(o.$menu),s=function(){o.$menu.off(o.animEndEventName).removeClass(o.options.animationClasses.classout).addClass("dl-subview"),t.addClass("dl-subviewopen").parents(".dl-subviewopen:first").removeClass("dl-subviewopen").addClass("dl-subview"),i.remove()};return setTimeout(function(){i.addClass(o.options.animationClasses.classin),o.$menu.addClass(o.options.animationClasses.classout),o.supportAnimations?o.$menu.on(o.animEndEventName,s):s.call(),o.options.onLevelClick(t,t.children("a:first").text())}),!1}o.options.onLinkClick(t,e)}),this.$back.on("click.dlmenu",function(e){function t(){o.$menu.off(o.animEndEventName).removeClass(o.options.animationClasses.classin),r.remove()}var n=a(this),i=n.parents("ul.dl-submenu:first"),s=i.parent(),r=i.clone().insertAfter(o.$menu);return setTimeout(function(){r.addClass(o.options.animationClasses.classout),o.$menu.addClass(o.options.animationClasses.classin),o.supportAnimations?o.$menu.on(o.animEndEventName,t):t.call(),s.removeClass("dl-subviewopen");var e=n.parents(".dl-subview:first");e.is("li")&&e.addClass("dl-subviewopen"),e.removeClass("dl-subview")}),!1})},closeMenu:function(){this.open&&this._closeMenu()},_closeMenu:function(){function e(){t.$menu.off(t.transEndEventName),t._resetMenu()}var t=this;this.$menu.removeClass("dl-menuopen"),this.$menu.addClass("dl-menu-toggle"),this.$trigger.removeClass("dl-active"),a(".overlay").removeClass("visible"),a("body").removeClass("stop-scrolling"),a("html").removeClass("stop-scrolling"),this.supportTransitions?this.$menu.on(this.transEndEventName,e):e.call(),this.open=!1},openMenu:function(){this.open||this._openMenu()},_openMenu:function(){var e=this;this.$menu.trigger("dlmenu.startOpen"),i.off("click").on("click.dlmenu",function(){e._closeMenu()}),this.$menu.addClass("dl-menuopen dl-menu-toggle").on(this.transEndEventName,function(){a(this).removeClass("dl-menu-toggle")}),this.$trigger.addClass("dl-active"),a("html").addClass("stop-scrolling"),a("body").addClass("stop-scrolling"),a(".overlay").addClass("visible"),this.open=!0},_resetMenu:function(){this.$menu.removeClass("dl-subview"),this.$menuitems.removeClass("dl-subview dl-subviewopen")}};function s(e){t.console&&t.console.error(e)}a.fn.dlmenu=function(t){var n;return"string"==typeof t?(n=Array.prototype.slice.call(arguments,1),this.each(function(){var e=a.data(this,"dlmenu");e?a.isFunction(e[t])&&"_"!==t.charAt(0)?e[t].apply(e,n):s("no such method '"+t+"' for dlmenu instance"):s("cannot call methods on dlmenu prior to initialization; attempted to call method '"+t+"'")})):this.each(function(){var e=a.data(this,"dlmenu");e?e._init():e=a.data(this,"dlmenu",new a.DLMenu(t,this))}),this}}(jQuery,window),function(n,r){r.package("Ibles.views"),r.views.HamburgerMenu=Backbone.View.extend({initialize:function(e){var t=this;e&&e.async?this.getMenuContents().done(function(){t.bindMenuPlugin(),t.enableResize(),t.updateAuthUI()}):(t.bindMenuPlugin(),t.enableResize(),t.updateAuthUI())},bindMenuPlugin:function(){this.$el.dlmenu({})},enableResize:function(){var e=this;e.setSizes(),$(n).resize(_.debounce(function(){e.setSizes()},250))},getMenuContents:function(){var t=this;return $.ajax("/parts/hamburger_menu/").then(function(e){t.$(".dl-menu").html(e),t.updateAuthUI()})},setSizes:function(){var e,t;r.isMobile()&&(e=$(n).height(),t=$("#main-header"),$(".overlay").height(e+70),$(".channels-menu").height(e-t.outerHeight()),$(".dl-menu").height(e-t.outerHeight()))},updateAuthUI:function(){var e,t,n,i=$(".logged-in-item"),s=$(".logged-out-item");r.session.authenticated()?(e=r.session,t=_.extend(r.session.toJSON(),{memberUrl:e.getMemberUrl(),avatarUrl:e.getAvatarUrl()}),n=_.template(r.JST["hamburger-menu-auth-section"]),$("#auth-container").html(n(t)),s.removeClass("visible"),i.addClass("visible"),$("#auth-container .btn-logout").on("click",function(){r.logout()})):(i.removeClass("visible"),s.addClass("visible"))}})}(window,Ibles),Ibles.JST["sticky-header-desktop"]='<div class="sticky-header" data-location="stickyNav">\n\t<div id="hamburger-menu" class="dl-menuwrapper hamburger-menu">\n\t\t<button class="dl-trigger"><i class="svg-icon svg-hamburger"></i><span class="sr-only">Open Menu</span></button>\n\t\t<ul class="dl-menu"></ul>\n\t</div>\n    <span class="byline">\n        <span class="title"><< title >></span> by <a class="author" rel="author" href="<< authorUrl >>"><< screenName >></a><button class="btn btn-yellow follow-btn">Follow</button>\n    </span>\n    <span class="ible-actions">\n        <[ if (type == "Step by Step") {]>\n        <button class="pdf-btn login-required" data-sourcea="download"><i class="svg-icon svg-pdf"></i>Download</button>\n        <[ } ]>\n        <button class="favorite-btn"><i class="svg-icon svg-favorite"></i><span class="favorite-txt">Favorite</span></button>\n        <[ if (type == "Step by Step") {]>\n        <button class="imadeit-btn"><i class="icon icon-imadeit"></i><span class="imadeit-txt">I Made It</span></button>\n        <button class="view-comments-btn"><a href="#discuss"><i class="svg-icon svg-comments"></i><span class="sr-only">View Comments</span></a></button>\n        <[ } ]>\n        <button class="share-menu-btn"><i class="svg-icon svg-share"></i><span class="sr-only">Share</span></button>\n        <button class="more-menu-btn"><i class="svg-icon svg-ellipsis"></i><span class="sr-only">More Options</span></button>\n    </span>\n    <div class="dropdown share-menu">\n        <button class="btn btn-facebook fb-btn"><i class="svg-icon svg-facebook"></i> Facebook</button>\n        <button class="btn btn-twitter twit-btn"><i class="svg-icon svg-twitter"></i> Twitter</button>\n        <button class="btn btn-danger pin-btn"><i class="svg-icon svg-pinterest"></i> Pinterest</button>\n        <button class="btn google-classroom-btn"><i class="icon-google-classroom"></i> Google Classroom</button>\n    </div>\n    <div class="dropdown more-menu">\n        <button class="btn flag-menu-btn">Flag</button>\n        <ul class="flag-menu unstyled hide">\n            <li><a class="flag-btn" data-as="wrong-category">Wrong Category</a></li>\n            <li><a class="flag-btn" data-as="inappropriate">Inappropriate</a></li>\n            <li><a class="flag-btn" data-as="incomplete">Incomplete</a></li>\n            <li><a class="flag-btn" data-as="spam">Spam</a></li>\n        </ul>\n        <button class="btn add-to-collection-btn">Add To Collection</button>\n        <button class="btn add-to-contest-btn admin-action">Add To Contest</button>\n        <button class="btn edit-btn author-action">Edit</button>\n    </div>\n</div>\n',Ibles.views.StickyHeaderBase=Backbone.View.extend({template:null,initialize:function(){this.render(),this.setupScrollFix()},hide:function(){},render:function(){var e=this.model,t=e.author;this.$el.append(this.template({title:e.get("title"),screenName:t.get("screenName"),authorUrl:t.getUrl(),authorAvatar:t.getAvatarFile().getTinyUrl(),type:e.get("type")}))},setupScrollFix:function(){var e=this,t=e.$(".sticky-header"),n=e.$(".article-header"),i=n.offset().top+n.height();$(window).scroll(_.throttle(function(){$(window).scrollTop()>=i?(t.addClass("affix"),Ibles.Events.trigger("fixHeaderShown",{headerHeight:50})):(t.removeClass("affix"),e.$(".more-menu").hide(),Ibles.Events.trigger("fixHeaderHidden"))},250))}}),Ibles.package("Ibles.views"),Ibles.views.StickyHeader=Ibles.views.StickyHeaderBase.fullExtend({template:_.template(Ibles.JST["sticky-header-desktop"]),events:{"click .flag-menu-btn":"toggleFlagMenu","click .flag-btn":"attemptFlag","click .edit-btn":"editBtnClicked","click .share-menu-btn":"toggleShareMenu","click .more-menu-btn":"toggleMoreMenu","click .add-to-collection-btn":"showAddToCollectionModal","click .add-to-contest-btn":"showAddToContestModal"},initialize:function(){this._super(),this.menu=new Ibles.views.HamburgerMenu({el:"#hamburger-menu",async:!0})},hide:function(){var e=this;setTimeout(function(){e.$(".sticky-header").removeClass("affix")},250)},editBtnClicked:function(){window.location=this.model.getEditUrl()},toggleShareMenu:function(e){this.toggleDropdownMenu(e,$(".share-menu-btn"),$(".share-menu"))},toggleMoreMenu:function(e){this.toggleDropdownMenu(e,$(".more-menu-btn"),$(".more-menu"))},toggleDropdownMenu:function(e,s,r){r.is(":visible")?(r.hide(),$(document).off("click.outside-menu")):(r.show(),setTimeout(function(){$(document).on("click.outside-menu",function(e){var t=$(e.target),n=t.is(s),i=!!t.closest(".dropdown").length;n||i||($(document).off("click.outside-menu"),r.hide())})}))},toggleFlagMenu:function(){Ibles.requireLogin(function(){this.$(".flag-menu").toggle()},{sourcea:"flag"})},attemptFlag:function(e){e.preventDefault();var t=this.model,n=$(e.target),i=n.text(),s=n.attr("data-as");new Ibles.views.ConfirmationView({model:new Ibles.models.ConfirmationModel({confirmationMessage:Ibles.T(Ibles.text.messages.confirmFlag.replace("<< reason >>",i))}),callbackFn:function(){t.set("flaggedAs",s),t.flagAction().success(Ibles.views.AlertView.callbackFactory("success")).error(Ibles.views.AlertView.callbackFactory("error"))}})},showAddToCollectionModal:function(){var e=this;this.$(".more-menu").hide(),Ibles.requireLogin(function(){Ibles.loadJsBundle("create_collection_js",$.proxy(e.renderAddToCollectionModal,e))},{sourcea:"showAddToCollectionModal"})},renderAddToCollectionModal:function(){var e,t;this.addToCollectionView||((e=$(".add-to-collection-btn")).addClass("loading"),t=Ibles.pageContext.ibleData,this.addToCollectionView=new Ibles.views.AddToCollectionView({ibleId:t.id,ibleTitle:t.title,coverImage:t.coverImage}),this.listenToOnce(this.addToCollectionView,"ready",function(){e.removeClass("loading")})),this.addToCollectionView.render()},showAddToContestModal:function(){this.addToContestView||(this.addToContestView=new Ibles.views.AddToContestView({ibleData:Ibles.pageContext.ibleData})),this.addToContestView.render()}}),function(){var e=Ibles.pageContext.ibleData;e&&window.LogHit&&window.LogHit(e.id,"Step by Step"===e.type?"E":"O",e.author.id)}(),Ibles.package("Ibles.views"),Ibles.views.BaseInstructableView=Backbone.View.extend({events:{"click .favorite-btn":"attemptFave","click .follow-btn":"attemptFollow","click .download-pdf, .pdf-btn":"downloadPDF","click .facebook-share-button, .fb-btn":"shareOnFacebook","click .pinterest-share-button, .pin-btn":"shareOnPinterest","click .twittr-share-button, .twit-btn":"shareOnTwitter","click .google-classroom-btn":"shareOnGoogleClassroom"},initialize:function(e){this.opts=_.clone(e||{}),this.renderPostedDate(),this.setUpCategoryTracking(),this.updateFollowingState(),this.updateFavoriteState(),this.listenTo(this.model,"change:favorite",this.updateFavoriteState),this.listenTo(this.model.author,"change:following",this.updateFollowingState),this.listenTo(this.model,"change:favorites change:views",this.updateStats)},renderPostedDate:function(){var e,t;Ibles.session.authenticated()&&(e=moment(this.model.get("publishDate")),t="Unpublished",this.model.get("isPreview")||(t="Published "+e.format("MMM Do, YYYY")),this.$(".posted-date").text(" "+t).show())},downloadPDF:function(){Ibles.featureFlagEnabled("zippable_project")?this.downloadZipBundle():this.downloadPdfOnly()},downloadPdfOnly:function(){Ibles.locationAssign(this.model.getPdfUrl())},downloadZipBundle:function(){var e=this.$(".download-pdf, .pdf-btn").button("loading");this.model.downloadZipBundle().always(function(){e.button("reset")}).fail(function(){alert(Ibles.text.errors.somethingImportantWentWrong)})},attemptFave:function(e){var t=this;e.preventDefault(),Ibles.requireLogin(function(){Ibles.alertWhenError(t.model.favoriteAction())},{sourcea:"favorite"})},attemptFollow:function(e){var t=this;e.preventDefault(),Ibles.requireLogin(function(){Ibles.alertWhenError(t.model.author.toggleFollowing())},{sourcea:"follow"})},updateFavoriteState:function(){var e=$(".favorite-btn"),t=$(".favorite-txt");this.model.get("favorite")?(e.addClass("active"),t.text("Favorited")):(e.removeClass("active"),t.text("Favorite"))},updateFollowingState:function(){var e=this.model.author.get("following");$(".follow-btn").html(e?"Following":"Follow")},updateStats:function(){var e=this.model,t=e.get("favorites"),n=e.get("views");0<t&&this.$(".favorite-count").html(t.toLocaleString()),0<n&&this.$(".view-count").html(n.toLocaleString())},shareOnFacebook:function(e){e.preventDefault(),Ibles.fbShare(this.model.get("fullUrl"))},shareOnPinterest:function(e){e.preventDefault(),window.open("https://www.pinterest.com/pin/create/button/?url={0}&description={1}&media={2}".format(encodeURIComponent(this.model.get("fullUrl")),encodeURIComponent(this.model.get("title")),encodeURIComponent(this.model.get("shareImageUrl"))),"_blank")},shareOnTwitter:function(e){e.preventDefault(),window.open("https://twitter.com/intent/tweet?text={0}&url={1}".format(encodeURIComponent(this.model.get("title")),encodeURIComponent(this.model.get("fullUrl"))),"_blank")},shareOnGoogleClassroom:function(e){e.preventDefault();var t=encodeURIComponent(this.model.get("fullUrl"));window.open("https://classroom.google.com/share?url={0}".format(t),"_blank")},setupSyntaxHighlighting:function(){var i=[];$("pre").each(function(e,t){var n;$(t).attr("data-src")&&""!=$(t).attr("data-src")&&(n=$.ajax({url:$(t).attr("data-src"),type:"GET",success:function(e){$(t).append($("<code></code>").text(e))}}),i.push(n))}),0<i.length&&($("head").append('<link rel="stylesheet" href="'+Ibles.staticUrl("css/prism.css")+'" type="text/css" />'),$.when.apply($,i).always(function(){sessionReady([Ibles.staticUrl("js/libs/prism.js")],function(){Prism.highlightAll(!0)})}))},setUpCategoryTracking:function(){var e={},t={},n=this.model.get("category"),i=this.model.get("channel");if(_.isUndefined(Ibles.getCookie("categoryTimer"))){var s=moment().add(30,"m"),r=Ibles.reverseUrls.ibleUrl(this.model.get("urlString"));Ibles.setCookie("categoryTimer",this.model.get("id"),{path:r,expires:s.toDate()});try{_.isUndefined(localStorage.ibleCategories)||(e=JSON.parse(localStorage.ibleCategories)),_.isUndefined(e[n])?e[n]=1:e[n]=e[n]+1,localStorage.ibleCategories=JSON.stringify(e),_.isUndefined(i)||(_.isUndefined(localStorage.ibleChannels)||(t=JSON.parse(localStorage.ibleChannels)),_.isUndefined(t[i])?t[i]=1:t[i]=t[i]+1,localStorage.ibleChannels=JSON.stringify(t))}catch(e){try{localStorage.clear()}catch(e){}}}},setupAdminPanel:function(){var e,t;!Ibles.isMobile()&&this.model.isEditableByCurrentUser()&&(e=this,(t=$("#admin-container")).length&&Ibles.loadJsBundle("ible_admin_js",function(){e.adminPanel=new Ibles.views.Admin({el:t,model:e.model,collapsible:!0})}))}}),Ibles.package("Ibles.views"),Ibles.views.InstructableView=Ibles.views.BaseInstructableView.fullExtend({events:{"click .license-btn":"showLicense","click .finalized-contests, .contest-entry, .view-btn":"viewContest","click .step-tip":"showTipPoster","click .step-question":"showQuestionPoster","click .step-comment":"showCommentPoster","click .view-comments-btn, .comment-count":"scrollToComments","click .imadeit-btn":"scrollToIMadeIts"},initialize:function(e){this._super(e),this.setupStickyHeader(),this.setupImadeIts(),this.setupComments(),this.listenTo(this.model,"userDataSynced",this.afterUserDataSynced)},afterUserDataSynced:function(){},setupStickyHeader:function(){this.stickyHeader=new Ibles.views.StickyHeader({el:this.$el,model:this.model})},setupImadeIts:function(){this.IMadeItsManager=new Ibles.views.ImadeItsManager({el:"#imadeits",model:this.model})},setupComments:function(){var n=this,e=n.model;e.get("disableComments")||sessionReady(function(){n.commentsManager=new Ibles.views.CommentsManager({el:"#comments",model:e,fetchRatings:!0,additionalCommentContext:function(e){var t=e.get("stepId");return t?n.getStepProps(t):{}}}),n.commentTypeSelector=new Ibles.views.CommentTypeSelector({el:"#discuss",manager:n.commentsManager}).render()})},showLicense:function(){var e=this.$(".license-btn").data("url");window.open(e,"LICENSE","status=yes,scrollbars=yes,resizable=yes,width=800,height=400")},viewContest:function(e){var t=$(e.target).closest(".contest-entry").find("a").attr("href");window.location=t},getTitleForPhotoset:function(e){var t=$(e).prev(".step-title").text();return t.substring(t.indexOf(":")+1).trim()},getStepId:function(e){return $(e.target).closest(".step").data("stepid")},getStepProps:function(e){var t,n=$('.step[data-stepid="'+e+'"]'),i={};return n.length&&(t=n.find(".step-title").text(),_.extend(i,{stepId:e,stepAnchorId:n.attr("id"),stepIndexLabel:t.substring(0,t.indexOf(":")).trim()})),i},showTipPoster:function(e){this.showStepCommentPoster(e,"tip")},showQuestionPoster:function(e){this.showStepCommentPoster(e,"question")},showCommentPoster:function(e){this.showStepCommentPoster(e,"comment")},showStepCommentPoster:function(e,t){var n=this,i=n.commentTypeSelector;i.renderPoster({designation:t,modelProps:{stepId:$(e.target).closest(".step").data("stepid"),designations:[t]},callback:function(){i.scrollToMe(),n.stickyHeader.hide()}})},scrollToComments:function(){window.location.hash="#discuss"},scrollToIMadeIts:function(e){this.IMadeItsManager.renderPoster(e),window.location.hash="#imadeits"}}),Ibles.package("Ibles.views"),Ibles.views.DesktopInstructableView=Ibles.views.InstructableView.fullExtend({events:{"click .view-in-3d-btn":"viewIn3d","click .step-link":"stepLinkClicked"},initialize:function(e){this._super(e),this.setupPhotosets(),this.setupSyntaxHighlighting(),this.showAuthorActions(),this.updateFeaturedBy(),this.updatePublishDate()},afterUserDataSynced:function(){this._super(),this.setupAdminPanel()},setupPhotosets:function(){var i=this;this.model.getPhotosetFiles().done(function(n){var e=i.$(".mediaset");_.each(e,function(e,t){new Ibles.views.PhotosetView({el:e,model:i.model,fileCollection:n[t],title:i.getTitleForPhotoset(e)})})})},isViewedByAuthor:function(){var e=Ibles.session;return e.authenticated()&&e.get("screenName")===this.model.author.get("screenName")},showAuthorActions:function(){var e=Ibles.session,t=e.authenticated()&&e.isAdmin(),n=this.isViewedByAuthor(),i=!_.isEmpty(this.model.get("collaborators"))&&!_.isEmpty(_.findWhere(this.model.get("collaborators"),{screenName:e.get("screenName")}));(t||n||i)&&this.$(".author-action").removeClass("author-action"),t&&this.$(".admin-action").removeClass("admin-action")},updatePublishDate:function(){var e;Ibles.session.authenticated()&&(e=moment(this.model.get("publishDate")).format("MMMM DD YYYY"),this.$(".publish-date").html(e))},updateFeaturedBy:function(){(Ibles.session.isAdmin()||Ibles.session.isStaff())&&(!0!==this.model.get("featureFlag")||_.isUndefined(this.model.get("featuredBy"))||this.$(".featured-by").html(_.template(Ibles.JST["featured-by"])(this.model.toJSON())))},viewIn3d:function(t){t.preventDefault();var e=$($(t.target).attr("data-embed-html"));e.removeAttr("width"),e.removeAttr("height");var n=$("<div></div>");n.append(e),head.load(Ibles.staticUrl("css/embedModal.css")),Ibles.loadJsBundle("ible_modal_embed_viewer_js",function(){var e=new Ibles.views.EmbedModalView({model:new Ibles.models.EmbedModel({embedCode:n.html(),fileName:$(t.target).attr("data-embed-filename")})});$("body").append(e.render())})},stepLinkClicked:function(){this.stickyHeader.hide()}}),Ibles.JST["image-bucket-image"]='<img src="<< bucketImageUrl >>"/>\n<div class="remove">&times;</div>\n',Ibles.package("Ibles.views"),Ibles.views.FileUploader=Backbone.View.extend({defaults:{multiple:!1,uploadField:null,validFileTypes:[],singleFileUploads:!0,sequentialUploads:!0,autoUpload:!0,replaceFileInput:!1,imageOrientation:!0,disableImageResize:!1,imageMaxWidth:null,imageMaxHeight:null,imageMinWidth:null,imageMinHeight:null},initialize:function(e){this.options=_.extend(this.defaults,e||{}),this.enableUploader()},showUploader:function(){this.uploadField.click()},isValidFiles:function(e,n){return _.every(e,function(e){var t=e.name.split(".").pop().toLowerCase();return _.contains(n,t)})},getUploadField:function(){var e=this.options;return e.uploadField?e.uploadField:e.multiple?$('<input type="file" name="files[]" multiple>'):$('<input type="file" name="files[]">')},enableUploader:function(){var i=this,n=this.options,s=0;Ibles.loadJsBundle("ible_mobile_uploader_js",function(){i.uploadField=i.getUploadField(),i.uploadWidget=i.uploadField.fileupload(_.extend({url:"//"+window.location.host+"/json-api/upload"},n)).on("fileuploadchange",function(e,t){if(!_.isEmpty(n.validFileTypes)&&!i.isValidFiles(t.files,n.validFileTypes))return i.trigger("upload:invalid",t),!1}).on("fileuploadprocessfail",function(e,t){i.trigger("upload:error",t)}).on("fileuploaddone",function(e,t){var n=t.result;$.isArray(n.loaded)?i.trigger("upload:success",n.loaded[0]):i.trigger("upload:error",t)}).on("fileuploadsubmit",function(e,t){i.trigger("upload:start",t)}).on("fileuploadalways",function(e,t){s++,t.originalFiles.length===s&&i.trigger("upload:complete")}).on("fileuploadfail",function(e,t){i.trigger("upload:error",t)})})}}),Ibles.package("Ibles.views"),Ibles.views.ImageBucketView=Backbone.View.extend({multiple:!1,initialize:function(e){_.bindAll(this,"showUploader","hideIfEmpty");var t=this;e=e||{},this.itemViewConstructor=e.itemViewConstructor||Ibles.views.ImageBucketImageView,this.multiple=!!e.multiple,this.prepend=!!e.prepend,this.textarea=e.textarea,this.skipUploaderModal=!!e.skipUploaderModal||Ibles.isMobile(),this.validFileTypes=e.validFileTypes||[],this.loadingIndicator=e.loadingIndicator,this.imageViews=[],this.skipUploaderModal&&Ibles.loadJsBundle("ible_mobile_uploader_js"),_.isEmpty(this.collection)&&(this.collection=new Ibles.collections.FileCollection([])),0<this.collection.length&&this.collection.each(function(e){t.renderModel(e,!1)})},addImages:function(){this.showUploader()},getFiles:function(){return new Ibles.collections.FileCollection(this.collection.models)},showUploader:function(){var e=this;this.skipUploaderModal?this.showMobileUploader():Ibles.fetchUploader(function(){e.showDesktopUploader()})},showMobileUploader:function(){this.stopListening(),this.uploader=new Ibles.views.FileUploader({multiple:this.multiple,validFileTypes:this.validFileTypes}),this.listenToOnce(this.uploader,"upload:start",_.bind(function(){this.trigger("imagebucket:uploading"),this.loadingIndicator&&this.loadingIndicator.show()},this)),this.listenTo(this.uploader,"upload:success",_.bind(function(e){this.uploadSuccess(_.clone(e)),this.trigger("imagebucket:imageadded",_.clone(e))},this)),this.listenToOnce(this.uploader,"upload:complete",_.bind(function(){this.trigger("imagebucket:uploadcomplete"),this.loadingIndicator&&this.loadingIndicator.hide()},this)),this.listenToOnce(this.uploader,"upload:error",_.bind(function(){this.trigger("imagebucket:uploaderror")},this)),this.listenToOnce(this.uploader,"upload:invalid",_.bind(function(){this.trigger("imagebucket:uploadinvalid")},this)),this.uploader.showUploader()},showDesktopUploader:function(){this.stopListening();var e=new Ibles.FileSet;this.listenTo(e,"add",_.bind(function(e){this.uploadSuccess(_.clone(e.attributes)),this.trigger("imagebucket:imageadded",_.clone(e.attributes))},this)),this.uploader=new Ibles.uploadModalView({collection:e})},uploadSuccess:function(e){var t=new Ibles.models.FileModel(e);this.renderModel(t,this.prepend)},renderModel:function(e,t){var n=new this.itemViewConstructor({model:e});t?(this.collection.add(e,{at:0}),this.$el.prepend(n.render().$el)):(this.collection.add(e),this.$el.append(n.render().$el)),this.imageViews.push(n),this.listenToOnce(e,"remove",this.onFileRemoved),_.isEmpty(this.textarea)||this.textarea.addClass("has-images"),this.$el.show()},onFileRemoved:function(e){this.removeImageView(e),this.hideIfEmpty()},removeImageView:function(t){var e=this.imageViews,n=_.find(e,function(e){return e.model==t});n&&e.splice(_.indexOf(e,n),1)},hideIfEmpty:function(){_.delay($.proxy(function(){0===this.collection.length&&(this.$el.hide(),_.isEmpty(this.textarea)||this.textarea.removeClass("has-images"))},this))},destroy:function(){_.each(this.imageViews,function(e){e.destroy&&e.destroy()}),this.undelegateEvents(),_.isEmpty(this.textarea)||this.textarea.removeClass("has-images"),this.$el.hide(),this.$el.empty(),this.stopListening(),this.collection.off(null,null,this)}}),Ibles.package("Ibles.views"),Ibles.views.ImageBucketImageView=Backbone.View.extend({template:_.template(Ibles.JST["image-bucket-image"]),className:"bucket-image",events:{"click .remove":"remove"},render:function(){var e=this.model,t=e.toJSON();return t.bucketImageUrl=e.isPdf()||e.isVideo()?e.getTypeThumbnailUrl():e.getTinyUrl(),this.$el.html(this.template(t)),this},remove:function(e){e.preventDefault(),e.stopPropagation(),this.model.collection.remove(this.model),this.$el.remove()}}),Ibles.package("Ibles.models"),Ibles.models.VotableContestModel=Backbone.Model.extend({defaults:{id:null,instructableId:null,title:null,urlString:null,votedFor:!1},vote:function(e){var t=this;Ibles.API.contestAjaxRequest("vote/",{contestId:this.get("id"),instructableId:this.get("instructableId"),posted:(new Date).getTime(),add:!this.get("votedFor")},{success:function(){t.set({votedFor:!t.get("votedFor")})},complete:function(){_.isFunction(e)&&e()}})}}),Ibles.package("Ibles.collections"),Ibles.collections.VotableContestCollection=Backbone.Collection.extend({model:Ibles.models.VotableContestModel}),Ibles.package("Ibles.views"),Ibles.views.VotableContestViews=Backbone.View.extend({events:{"click .vote-btn":"toggleVote"},model:null,votableContestCollection:null,initialize:function(){var e=this.model.get("votableContests");this.votableContestCollection=new Ibles.collections.VotableContestCollection([]),_.each(e,function(e){e.instructableId=this.model.get("id");var t=new Ibles.models.VotableContestModel(e);this.votableContestCollection.add(t),this.updateVote(t),this.listenTo(t,"change:votedFor",this.updateVote)},this)},updateVote:function(e){var t=this.$("[data-contestid='"+e.get("id")+"']").find(".vote-btn");e.get("votedFor")?t.html("Voted"):t.html("Vote Now!")},toggleVote:function(e){var t=this,n=$(e.currentTarget),i=n.closest("[data-contestid]").data("contestid"),s=this.votableContestCollection.get(i);n.attr("disabled","disabled").html("Voting..."),s.vote(function(){n.removeAttr("disabled"),t.updateVote(s)})},destroy:function(){this.undelegateEvents(),this.stopListening()}}),Ibles.JST["contest-passcode-view"]='<div class="contest-passcode-container">\n    <h3>This is an invite-only contest</h3>\n    <div class="passcode-message"><< message >></div>\n    <p><strong>Enter the passcode:</strong></p>\n    <input class="form-control input-block-level" name="passcode"></input>\n</div>',Ibles.package("Ibles.views"),Ibles.views.ContestPasscodeView=Backbone.View.extend({template:_.template(Ibles.JST["contest-passcode-view"]),model:null,events:{'input input[name="passcode"]':"updatePasscode",'keyup input[name="passcode"]':"onPasscodeKeyup"},initialize:function(){this.render()},destroy:function(){this.$el.html("")},updatePasscode:function(e){this.model.set({help:this.model.get("help"),passcode:$(e.target).val()})},onPasscodeKeyup:function(){},render:function(){this.$el.html(this.template({message:this.model.get("help")}))}}),Ibles.models.ContestPasscodeModel=Backbone.Model.extend({defaults:{help:"",passcode:"",contestId:null,contestPath:null}}),function(e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).JSZip=e()}(function(){return function r(o,a,l){function c(n,e){if(!a[n]){if(!o[n]){var t="function"==typeof require&&require;if(!e&&t)return t(n,!0);if(d)return d(n,!0);var i=new Error("Cannot find module '"+n+"'");throw i.code="MODULE_NOT_FOUND",i}var s=a[n]={exports:{}};o[n][0].call(s.exports,function(e){var t=o[n][1][e];return c(t||e)},s,s.exports,r,o,a,l)}return a[n].exports}for(var d="function"==typeof require&&require,e=0;e<l.length;e++)c(l[e]);return c}({1:[function(e,t,n){"use strict";var f=e("./utils"),u=e("./support"),m="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";n.encode=function(e){for(var t,n,i,s,r,o,a,l,c=[],d=0,u=e.length,h="string"!==f.getTypeOf(e);d<e.length;)l=u-d,i=h?(t=e[d++],n=d<u?e[d++]:0,d<u?e[d++]:0):(t=e.charCodeAt(d++),n=d<u?e.charCodeAt(d++):0,d<u?e.charCodeAt(d++):0),s=t>>2,r=(3&t)<<4|n>>4,o=1<l?(15&n)<<2|i>>6:64,a=2<l?63&i:64,c.push(m.charAt(s)+m.charAt(r)+m.charAt(o)+m.charAt(a));return c.join("")},n.decode=function(e){var t,n,i,s,r,o,a=0,l=0;if("data:"===e.substr(0,"data:".length))throw new Error("Invalid base64 input, it looks like a data url.");var c,d=3*(e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"")).length/4;if(e.charAt(e.length-1)===m.charAt(64)&&d--,e.charAt(e.length-2)===m.charAt(64)&&d--,d%1!=0)throw new Error("Invalid base64 input, bad content length.");for(c=new(u.uint8array?Uint8Array:Array)(0|d);a<e.length;)t=m.indexOf(e.charAt(a++))<<2|(s=m.indexOf(e.charAt(a++)))>>4,n=(15&s)<<4|(r=m.indexOf(e.charAt(a++)))>>2,i=(3&r)<<6|(o=m.indexOf(e.charAt(a++))),c[l++]=t,64!==r&&(c[l++]=n),64!==o&&(c[l++]=i);return c}},{"./support":30,"./utils":32}],2:[function(e,t,n){"use strict";var i=e("./external"),s=e("./stream/DataWorker"),r=e("./stream/DataLengthProbe"),o=e("./stream/Crc32Probe"),r=e("./stream/DataLengthProbe");function a(e,t,n,i,s){this.compressedSize=e,this.uncompressedSize=t,this.crc32=n,this.compression=i,this.compressedContent=s}a.prototype={getContentWorker:function(){var e=new s(i.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new r("data_length")),t=this;return e.on("end",function(){if(this.streamInfo.data_length!==t.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),e},getCompressedWorker:function(){return new s(i.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},a.createWorkerFrom=function(e,t,n){return e.pipe(new o).pipe(new r("uncompressedSize")).pipe(t.compressWorker(n)).pipe(new r("compressedSize")).withStreamInfo("compression",t)},t.exports=a},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(e,t,n){"use strict";var i=e("./stream/GenericWorker");n.STORE={magic:"\0\0",compressWorker:function(e){return new i("STORE compression")},uncompressWorker:function(){return new i("STORE decompression")}},n.DEFLATE=e("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(e,t,n){"use strict";var i=e("./utils");var a=function(){for(var e,t=[],n=0;n<256;n++){e=n;for(var i=0;i<8;i++)e=1&e?3988292384^e>>>1:e>>>1;t[n]=e}return t}();t.exports=function(e,t){return void 0!==e&&e.length?("string"!==i.getTypeOf(e)?function(e,t,n,i){var s=a,r=i+n;e^=-1;for(var o=i;o<r;o++)e=e>>>8^s[255&(e^t[o])];return-1^e}:function(e,t,n,i){var s=a,r=i+n;e^=-1;for(var o=i;o<r;o++)e=e>>>8^s[255&(e^t.charCodeAt(o))];return-1^e})(0|t,e,e.length,0):0}},{"./utils":32}],5:[function(e,t,n){"use strict";n.base64=!1,n.binary=!1,n.dir=!1,n.createFolders=!0,n.date=null,n.compression=null,n.compressionOptions=null,n.comment=null,n.unixPermissions=null,n.dosPermissions=null},{}],6:[function(e,t,n){"use strict";var i=null,i="undefined"!=typeof Promise?Promise:e("lie");t.exports={Promise:i}},{lie:37}],7:[function(e,t,n){"use strict";var i="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Uint32Array,s=e("pako"),r=e("./utils"),o=e("./stream/GenericWorker"),a=i?"uint8array":"array";function l(e,t){o.call(this,"FlateWorker/"+e),this._pako=null,this._pakoAction=e,this._pakoOptions=t,this.meta={}}n.magic="\b\0",r.inherits(l,o),l.prototype.processChunk=function(e){this.meta=e.meta,null===this._pako&&this._createPako(),this._pako.push(r.transformTo(a,e.data),!1)},l.prototype.flush=function(){o.prototype.flush.call(this),null===this._pako&&this._createPako(),this._pako.push([],!0)},l.prototype.cleanUp=function(){o.prototype.cleanUp.call(this),this._pako=null},l.prototype._createPako=function(){this._pako=new s[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var t=this;this._pako.onData=function(e){t.push({data:e,meta:t.meta})}},n.compressWorker=function(e){return new l("Deflate",e)},n.uncompressWorker=function(){return new l("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(e,t,n){"use strict";function R(e,t){for(var n="",i=0;i<t;i++)n+=String.fromCharCode(255&e),e>>>=8;return n}function s(e,t,n,i,s,r){var o,a,l,c,d=e.file,u=e.compression,h=r!==O.utf8encode,f=M.transformTo("string",r(d.name)),m=M.transformTo("string",O.utf8encode(d.name)),p=d.comment,g=M.transformTo("string",r(p)),b=M.transformTo("string",O.utf8encode(p)),v=m.length!==d.name.length,w=b.length!==p.length,y="",_=d.dir,I=d.date,k={crc32:0,compressedSize:0,uncompressedSize:0};t&&!n||(k.crc32=e.crc32,k.compressedSize=e.compressedSize,k.uncompressedSize=e.uncompressedSize);var C=0;t&&(C|=8),h||!v&&!w||(C|=2048);var x,S,A=0,T=0;_&&(A|=16),"UNIX"===s?(T=798,A|=(x=d.unixPermissions,S=_,(65535&(x?x:S?16893:33204))<<16)):(T=20,A|=63&(d.dosPermissions||0)),o=I.getUTCHours(),o<<=6,o|=I.getUTCMinutes(),o<<=5,o|=I.getUTCSeconds()/2,a=I.getUTCFullYear()-1980,a<<=4,a|=I.getUTCMonth()+1,a<<=5,a|=I.getUTCDate(),v&&(l=R(1,1)+R(P(f),4)+m,y+="up"+R(l.length,2)+l),w&&(c=R(1,1)+R(P(g),4)+b,y+="uc"+R(c.length,2)+c);var E="";return E+="\n\0",E+=R(C,2),E+=u.magic,E+=R(o,2),E+=R(a,2),E+=R(k.crc32,4),E+=R(k.compressedSize,4),E+=R(k.uncompressedSize,4),E+=R(f.length,2),E+=R(y.length,2),{fileRecord:z.LOCAL_FILE_HEADER+E+f+y,dirRecord:z.CENTRAL_FILE_HEADER+R(T,2)+E+R(g.length,2)+"\0\0\0\0"+R(A,4)+R(i,4)+f+y+g}}var M=e("../utils"),r=e("../stream/GenericWorker"),O=e("../utf8"),P=e("../crc32"),z=e("../signature");function i(e,t,n,i){r.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=t,this.zipPlatform=n,this.encodeFileName=i,this.streamFiles=e,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}M.inherits(i,r),i.prototype.push=function(e){var t=e.meta.percent||0,n=this.entriesCount,i=this._sources.length;this.accumulate?this.contentBuffer.push(e):(this.bytesWritten+=e.data.length,r.prototype.push.call(this,{data:e.data,meta:{currentFile:this.currentFile,percent:n?(t+100*(n-i-1))/n:100}}))},i.prototype.openedSource=function(e){this.currentSourceOffset=this.bytesWritten,this.currentFile=e.file.name;var t,n=this.streamFiles&&!e.file.dir;n?(t=s(e,n,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName),this.push({data:t.fileRecord,meta:{percent:0}})):this.accumulate=!0},i.prototype.closedSource=function(e){this.accumulate=!1;var t,n=this.streamFiles&&!e.file.dir,i=s(e,n,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(i.dirRecord),n)this.push({data:(t=e,z.DATA_DESCRIPTOR+R(t.crc32,4)+R(t.compressedSize,4)+R(t.uncompressedSize,4)),meta:{percent:100}});else for(this.push({data:i.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},i.prototype.flush=function(){for(var e=this.bytesWritten,t=0;t<this.dirRecords.length;t++)this.push({data:this.dirRecords[t],meta:{percent:100}});var n,i,s,r,o,a,l=this.bytesWritten-e,c=(n=this.dirRecords.length,i=l,s=e,r=this.zipComment,o=this.encodeFileName,a=M.transformTo("string",o(r)),z.CENTRAL_DIRECTORY_END+"\0\0\0\0"+R(n,2)+R(n,2)+R(i,4)+R(s,4)+R(a.length,2)+a);this.push({data:c,meta:{percent:100}})},i.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},i.prototype.registerPrevious=function(e){this._sources.push(e);var t=this;return e.on("data",function(e){t.processChunk(e)}),e.on("end",function(){t.closedSource(t.previous.streamInfo),t._sources.length?t.prepareNextSource():t.end()}),e.on("error",function(e){t.error(e)}),this},i.prototype.resume=function(){return!!r.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},i.prototype.error=function(e){var t=this._sources;if(!r.prototype.error.call(this,e))return!1;for(var n=0;n<t.length;n++)try{t[n].error(e)}catch(e){}return!0},i.prototype.lock=function(){r.prototype.lock.call(this);for(var e=this._sources,t=0;t<e.length;t++)e[t].lock()},t.exports=i},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(e,t,n){"use strict";var c=e("../compressions"),i=e("./ZipFileWorker");n.generateWorker=function(e,o,t){var a=new i(o.streamFiles,t,o.platform,o.encodeFileName),l=0;try{e.forEach(function(e,t){l++;var n=function(e,t){var n=e||t,i=c[n];if(!i)throw new Error(n+" is not a valid compression method !");return i}(t.options.compression,o.compression),i=t.options.compressionOptions||o.compressionOptions||{},s=t.dir,r=t.date;t._compressWorker(n,i).withStreamInfo("file",{name:e,dir:s,date:r,comment:t.comment||"",unixPermissions:t.unixPermissions,dosPermissions:t.dosPermissions}).pipe(a)}),a.entriesCount=l}catch(e){a.error(e)}return a}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(e,t,n){"use strict";function i(){if(!(this instanceof i))return new i;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files={},this.comment=null,this.root="",this.clone=function(){var e,t=new i;for(e in this)"function"!=typeof this[e]&&(t[e]=this[e]);return t}}(i.prototype=e("./object")).loadAsync=e("./load"),i.support=e("./support"),i.defaults=e("./defaults"),i.version="3.2.0",i.loadAsync=function(e,t){return(new i).loadAsync(e,t)},i.external=e("./external"),t.exports=i},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(e,t,n){"use strict";var i=e("./utils"),s=e("./external"),a=e("./utf8"),i=e("./utils"),l=e("./zipEntries"),c=e("./stream/Crc32Probe"),d=e("./nodejsUtils");t.exports=function(e,r){var o=this;return r=i.extend(r||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:a.utf8decode}),d.isNode&&d.isStream(e)?s.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):i.prepareContent("the loaded zip file",e,!0,r.optimizedBinaryString,r.base64).then(function(e){var t=new l(r);return t.load(e),t}).then(function(e){var t=[s.Promise.resolve(e)],n=e.files;if(r.checkCRC32)for(var i=0;i<n.length;i++)t.push(function(i){return new s.Promise(function(e,t){var n=i.decompressed.getContentWorker().pipe(new c);n.on("error",function(e){t(e)}).on("end",function(){n.streamInfo.crc32!==i.decompressed.crc32?t(new Error("Corrupted zip : CRC32 mismatch")):e()}).resume()})}(n[i]));return s.Promise.all(t)}).then(function(e){for(var t=e.shift(),n=t.files,i=0;i<n.length;i++){var s=n[i];o.file(s.fileNameStr,s.decompressed,{binary:!0,optimizedBinaryString:!0,date:s.date,dir:s.dir,comment:s.fileCommentStr.length?s.fileCommentStr:null,unixPermissions:s.unixPermissions,dosPermissions:s.dosPermissions,createFolders:r.createFolders})}return t.zipComment.length&&(o.comment=t.zipComment),o})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(e,t,n){"use strict";var i=e("../utils"),s=e("../stream/GenericWorker");function r(e,t){s.call(this,"Nodejs stream input adapter for "+e),this._upstreamEnded=!1,this._bindStream(t)}i.inherits(r,s),r.prototype._bindStream=function(e){var t=this;(this._stream=e).pause(),e.on("data",function(e){t.push({data:e,meta:{percent:0}})}).on("error",function(e){t.isPaused?this.generatedError=e:t.error(e)}).on("end",function(){t.isPaused?t._upstreamEnded=!0:t.end()})},r.prototype.pause=function(){return!!s.prototype.pause.call(this)&&(this._stream.pause(),!0)},r.prototype.resume=function(){return!!s.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},t.exports=r},{"../stream/GenericWorker":28,"../utils":32}],13:[function(e,t,n){"use strict";var s=e("readable-stream").Readable;function i(e,t,n){s.call(this,t),this._helper=e;var i=this;e.on("data",function(e,t){i.push(e)||i._helper.pause(),n&&n(t)}).on("error",function(e){i.emit("error",e)}).on("end",function(){i.push(null)})}e("../utils").inherits(i,s),i.prototype._read=function(){this._helper.resume()},t.exports=i},{"../utils":32,"readable-stream":16}],14:[function(e,t,n){"use strict";t.exports={isNode:"undefined"!=typeof Buffer,newBufferFrom:function(e,t){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(e,t);if("number"==typeof e)throw new Error('The "data" argument must not be a number');return new Buffer(e,t)},allocBuffer:function(e){if(Buffer.alloc)return Buffer.alloc(e);var t=new Buffer(e);return t.fill(0),t},isBuffer:function(e){return Buffer.isBuffer(e)},isStream:function(e){return e&&"function"==typeof e.on&&"function"==typeof e.pause&&"function"==typeof e.resume}}},{}],15:[function(e,t,n){"use strict";function r(e,t,n){var i,s=c.getTypeOf(t),r=c.extend(n||{},u);r.date=r.date||new Date,null!==r.compression&&(r.compression=r.compression.toUpperCase()),"string"==typeof r.unixPermissions&&(r.unixPermissions=parseInt(r.unixPermissions,8)),r.unixPermissions&&16384&r.unixPermissions&&(r.dir=!0),r.dosPermissions&&16&r.dosPermissions&&(r.dir=!0),r.dir&&(e=b(e)),r.createFolders&&(i=g(e))&&v.call(this,i,!0);var o="string"===s&&!1===r.binary&&!1===r.base64;n&&void 0!==n.binary||(r.binary=!o),(t instanceof h&&0===t.uncompressedSize||r.dir||!t||0===t.length)&&(r.base64=!1,r.binary=!0,t="",r.compression="STORE");var a=null,a=t instanceof h||t instanceof d?t:m.isNode&&m.isStream(t)?new p(e,t):c.prepareContent(e,t,r.binary,r.optimizedBinaryString,r.base64),l=new f(e,a,r);this.files[e]=l}var s=e("./utf8"),c=e("./utils"),d=e("./stream/GenericWorker"),o=e("./stream/StreamHelper"),u=e("./defaults"),h=e("./compressedObject"),f=e("./zipObject"),a=e("./generate"),m=e("./nodejsUtils"),p=e("./nodejs/NodejsStreamInputAdapter"),g=function(e){"/"===e.slice(-1)&&(e=e.substring(0,e.length-1));var t=e.lastIndexOf("/");return 0<t?e.substring(0,t):""},b=function(e){return"/"!==e.slice(-1)&&(e+="/"),e},v=function(e,t){return t=void 0!==t?t:u.createFolders,e=b(e),this.files[e]||r.call(this,e,null,{dir:!0,createFolders:t}),this.files[e]};function l(e){return"[object RegExp]"===Object.prototype.toString.call(e)}var i={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(e){var t,n,i;for(t in this.files)this.files.hasOwnProperty(t)&&(i=this.files[t],(n=t.slice(this.root.length,t.length))&&t.slice(0,this.root.length)===this.root&&e(n,i))},filter:function(n){var i=[];return this.forEach(function(e,t){n(e,t)&&i.push(t)}),i},file:function(e,t,n){if(1!==arguments.length)return e=this.root+e,r.call(this,e,t,n),this;if(l(e)){var i=e;return this.filter(function(e,t){return!t.dir&&i.test(e)})}var s=this.files[this.root+e];return s&&!s.dir?s:null},folder:function(n){if(!n)return this;if(l(n))return this.filter(function(e,t){return t.dir&&n.test(e)});var e=this.root+n,t=v.call(this,e),i=this.clone();return i.root=t.name,i},remove:function(n){n=this.root+n;var e=this.files[n];if(e||("/"!==n.slice(-1)&&(n+="/"),e=this.files[n]),e&&!e.dir)delete this.files[n];else for(var t=this.filter(function(e,t){return t.name.slice(0,n.length)===n}),i=0;i<t.length;i++)delete this.files[t[i].name];return this},generate:function(e){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(e){var t={};try{if((t=c.extend(e||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:s.utf8encode})).type=t.type.toLowerCase(),t.compression=t.compression.toUpperCase(),"binarystring"===t.type&&(t.type="string"),!t.type)throw new Error("No output type specified.");c.checkSupport(t.type),"darwin"!==t.platform&&"freebsd"!==t.platform&&"linux"!==t.platform&&"sunos"!==t.platform||(t.platform="UNIX"),"win32"===t.platform&&(t.platform="DOS");var n=t.comment||this.comment||"",i=a.generateWorker(this,t,n)}catch(e){(i=new d("error")).error(e)}return new o(i,t.type||"string",t.mimeType)},generateAsync:function(e,t){return this.generateInternalStream(e).accumulate(t)},generateNodeStream:function(e,t){return(e=e||{}).type||(e.type="nodebuffer"),this.generateInternalStream(e).toNodejsStream(t)}};t.exports=i},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(e,t,n){t.exports=e("stream")},{stream:void 0}],17:[function(e,t,n){"use strict";var i=e("./DataReader");function s(e){i.call(this,e);for(var t=0;t<this.data.length;t++)e[t]=255&e[t]}e("../utils").inherits(s,i),s.prototype.byteAt=function(e){return this.data[this.zero+e]},s.prototype.lastIndexOfSignature=function(e){for(var t=e.charCodeAt(0),n=e.charCodeAt(1),i=e.charCodeAt(2),s=e.charCodeAt(3),r=this.length-4;0<=r;--r)if(this.data[r]===t&&this.data[r+1]===n&&this.data[r+2]===i&&this.data[r+3]===s)return r-this.zero;return-1},s.prototype.readAndCheckSignature=function(e){var t=e.charCodeAt(0),n=e.charCodeAt(1),i=e.charCodeAt(2),s=e.charCodeAt(3),r=this.readData(4);return t===r[0]&&n===r[1]&&i===r[2]&&s===r[3]},s.prototype.readData=function(e){if(this.checkOffset(e),0===e)return[];var t=this.data.slice(this.zero+this.index,this.zero+this.index+e);return this.index+=e,t},t.exports=s},{"../utils":32,"./DataReader":18}],18:[function(e,t,n){"use strict";var i=e("../utils");function s(e){this.data=e,this.length=e.length,this.index=0,this.zero=0}s.prototype={checkOffset:function(e){this.checkIndex(this.index+e)},checkIndex:function(e){if(this.length<this.zero+e||e<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+e+"). Corrupted zip ?")},setIndex:function(e){this.checkIndex(e),this.index=e},skip:function(e){this.setIndex(this.index+e)},byteAt:function(e){},readInt:function(e){var t,n=0;for(this.checkOffset(e),t=this.index+e-1;t>=this.index;t--)n=(n<<8)+this.byteAt(t);return this.index+=e,n},readString:function(e){return i.transformTo("string",this.readData(e))},readData:function(e){},lastIndexOfSignature:function(e){},readAndCheckSignature:function(e){},readDate:function(){var e=this.readInt(4);return new Date(Date.UTC(1980+(e>>25&127),(e>>21&15)-1,e>>16&31,e>>11&31,e>>5&63,(31&e)<<1))}},t.exports=s},{"../utils":32}],19:[function(e,t,n){"use strict";var i=e("./Uint8ArrayReader");function s(e){i.call(this,e)}e("../utils").inherits(s,i),s.prototype.readData=function(e){this.checkOffset(e);var t=this.data.slice(this.zero+this.index,this.zero+this.index+e);return this.index+=e,t},t.exports=s},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(e,t,n){"use strict";var i=e("./DataReader");function s(e){i.call(this,e)}e("../utils").inherits(s,i),s.prototype.byteAt=function(e){return this.data.charCodeAt(this.zero+e)},s.prototype.lastIndexOfSignature=function(e){return this.data.lastIndexOf(e)-this.zero},s.prototype.readAndCheckSignature=function(e){return e===this.readData(4)},s.prototype.readData=function(e){this.checkOffset(e);var t=this.data.slice(this.zero+this.index,this.zero+this.index+e);return this.index+=e,t},t.exports=s},{"../utils":32,"./DataReader":18}],21:[function(e,t,n){"use strict";var i=e("./ArrayReader");function s(e){i.call(this,e)}e("../utils").inherits(s,i),s.prototype.readData=function(e){if(this.checkOffset(e),0===e)return new Uint8Array(0);var t=this.data.subarray(this.zero+this.index,this.zero+this.index+e);return this.index+=e,t},t.exports=s},{"../utils":32,"./ArrayReader":17}],22:[function(e,t,n){"use strict";var i=e("../utils"),s=e("../support"),r=e("./ArrayReader"),o=e("./StringReader"),a=e("./NodeBufferReader"),l=e("./Uint8ArrayReader");t.exports=function(e){var t=i.getTypeOf(e);return i.checkSupport(t),"string"!==t||s.uint8array?"nodebuffer"===t?new a(e):s.uint8array?new l(i.transformTo("uint8array",e)):new r(i.transformTo("array",e)):new o(e)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(e,t,n){"use strict";n.LOCAL_FILE_HEADER="PK",n.CENTRAL_FILE_HEADER="PK",n.CENTRAL_DIRECTORY_END="PK",n.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK",n.ZIP64_CENTRAL_DIRECTORY_END="PK",n.DATA_DESCRIPTOR="PK\b"},{}],24:[function(e,t,n){"use strict";var i=e("./GenericWorker"),s=e("../utils");function r(e){i.call(this,"ConvertWorker to "+e),this.destType=e}s.inherits(r,i),r.prototype.processChunk=function(e){this.push({data:s.transformTo(this.destType,e.data),meta:e.meta})},t.exports=r},{"../utils":32,"./GenericWorker":28}],25:[function(e,t,n){"use strict";var i=e("./GenericWorker"),s=e("../crc32");function r(){i.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}e("../utils").inherits(r,i),r.prototype.processChunk=function(e){this.streamInfo.crc32=s(e.data,this.streamInfo.crc32||0),this.push(e)},t.exports=r},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(e,t,n){"use strict";var i=e("../utils"),s=e("./GenericWorker");function r(e){s.call(this,"DataLengthProbe for "+e),this.propName=e,this.withStreamInfo(e,0)}i.inherits(r,s),r.prototype.processChunk=function(e){var t;e&&(t=this.streamInfo[this.propName]||0,this.streamInfo[this.propName]=t+e.data.length),s.prototype.processChunk.call(this,e)},t.exports=r},{"../utils":32,"./GenericWorker":28}],27:[function(e,t,n){"use strict";var i=e("../utils"),s=e("./GenericWorker");function r(e){s.call(this,"DataWorker");var t=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,e.then(function(e){t.dataIsReady=!0,t.data=e,t.max=e&&e.length||0,t.type=i.getTypeOf(e),t.isPaused||t._tickAndRepeat()},function(e){t.error(e)})}i.inherits(r,s),r.prototype.cleanUp=function(){s.prototype.cleanUp.call(this),this.data=null},r.prototype.resume=function(){return!!s.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,i.delay(this._tickAndRepeat,[],this)),!0)},r.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(i.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},r.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var e=null,t=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":e=this.data.substring(this.index,t);break;case"uint8array":e=this.data.subarray(this.index,t);break;case"array":case"nodebuffer":e=this.data.slice(this.index,t)}return this.index=t,this.push({data:e,meta:{percent:this.max?this.index/this.max*100:0}})},t.exports=r},{"../utils":32,"./GenericWorker":28}],28:[function(e,t,n){"use strict";function i(e){this.name=e||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}i.prototype={push:function(e){this.emit("data",e)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(e){this.emit("error",e)}return!0},error:function(e){return!this.isFinished&&(this.isPaused?this.generatedError=e:(this.isFinished=!0,this.emit("error",e),this.previous&&this.previous.error(e),this.cleanUp()),!0)},on:function(e,t){return this._listeners[e].push(t),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(e,t){if(this._listeners[e])for(var n=0;n<this._listeners[e].length;n++)this._listeners[e][n].call(this,t)},pipe:function(e){return e.registerPrevious(this)},registerPrevious:function(e){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=e.streamInfo,this.mergeStreamInfo(),this.previous=e;var t=this;return e.on("data",function(e){t.processChunk(e)}),e.on("end",function(){t.end()}),e.on("error",function(e){t.error(e)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var e=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),e=!0),this.previous&&this.previous.resume(),!e},flush:function(){},processChunk:function(e){this.push(e)},withStreamInfo:function(e,t){return this.extraStreamInfo[e]=t,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var e in this.extraStreamInfo)this.extraStreamInfo.hasOwnProperty(e)&&(this.streamInfo[e]=this.extraStreamInfo[e])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var e="Worker "+this.name;return this.previous?this.previous+" -> "+e:e}},t.exports=i},{}],29:[function(e,t,n){"use strict";var l=e("../utils"),s=e("./ConvertWorker"),r=e("./GenericWorker"),c=e("../base64"),i=e("../support"),o=e("../external"),a=null;if(i.nodestream)try{a=e("../nodejs/NodejsStreamOutputAdapter")}catch(e){}function d(e,a){return new o.Promise(function(t,n){var i=[],s=e._internalType,r=e._outputType,o=e._mimeType;e.on("data",function(e,t){i.push(e),a&&a(t)}).on("error",function(e){i=[],n(e)}).on("end",function(){try{var e=function(e,t,n){switch(e){case"blob":return l.newBlob(l.transformTo("arraybuffer",t),n);case"base64":return c.encode(t);default:return l.transformTo(e,t)}}(r,function(e,t){for(var n=0,i=null,s=0,r=0;r<t.length;r++)s+=t[r].length;switch(e){case"string":return t.join("");case"array":return Array.prototype.concat.apply([],t);case"uint8array":for(i=new Uint8Array(s),r=0;r<t.length;r++)i.set(t[r],n),n+=t[r].length;return i;case"nodebuffer":return Buffer.concat(t);default:throw new Error("concat : unsupported type '"+e+"'")}}(s,i),o);t(e)}catch(e){n(e)}i=[]}).resume()})}function u(e,t,n){var i=t;switch(t){case"blob":case"arraybuffer":i="uint8array";break;case"base64":i="string"}try{this._internalType=i,this._outputType=t,this._mimeType=n,l.checkSupport(i),this._worker=e.pipe(new s(i)),e.lock()}catch(e){this._worker=new r("error"),this._worker.error(e)}}u.prototype={accumulate:function(e){return d(this,e)},on:function(e,t){var n=this;return"data"===e?this._worker.on(e,function(e){t.call(n,e.data,e.meta)}):this._worker.on(e,function(){l.delay(t,arguments,n)}),this},resume:function(){return l.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(e){if(l.checkSupport("nodestream"),"nodebuffer"!==this._outputType)throw new Error(this._outputType+" is not supported by this method");return new a(this,{objectMode:"nodebuffer"!==this._outputType},e)}},t.exports=u},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(e,t,n){"use strict";if(n.base64=!0,n.array=!0,n.string=!0,n.arraybuffer="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof Uint8Array,n.nodebuffer="undefined"!=typeof Buffer,n.uint8array="undefined"!=typeof Uint8Array,"undefined"==typeof ArrayBuffer)n.blob=!1;else{var i=new ArrayBuffer(0);try{n.blob=0===new Blob([i],{type:"application/zip"}).size}catch(e){try{var s=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);s.append(i),n.blob=0===s.getBlob("application/zip").size}catch(e){n.blob=!1}}}try{n.nodestream=!!e("readable-stream").Readable}catch(e){n.nodestream=!1}},{"readable-stream":16}],31:[function(e,t,r){"use strict";for(var a=e("./utils"),l=e("./support"),n=e("./nodejsUtils"),i=e("./stream/GenericWorker"),c=new Array(256),s=0;s<256;s++)c[s]=252<=s?6:248<=s?5:240<=s?4:224<=s?3:192<=s?2:1;c[254]=c[254]=1;function o(){i.call(this,"utf-8 decode"),this.leftOver=null}function d(){i.call(this,"utf-8 encode")}r.utf8encode=function(e){return l.nodebuffer?n.newBufferFrom(e,"utf-8"):function(e){for(var t,n,i,s,r=e.length,o=0,a=0;a<r;a++)55296==(64512&(n=e.charCodeAt(a)))&&a+1<r&&56320==(64512&(i=e.charCodeAt(a+1)))&&(n=65536+(n-55296<<10)+(i-56320),a++),o+=n<128?1:n<2048?2:n<65536?3:4;for(t=new(l.uint8array?Uint8Array:Array)(o),a=s=0;s<o;a++)55296==(64512&(n=e.charCodeAt(a)))&&a+1<r&&56320==(64512&(i=e.charCodeAt(a+1)))&&(n=65536+(n-55296<<10)+(i-56320),a++),n<128?t[s++]=n:(n<2048?t[s++]=192|n>>>6:(n<65536?t[s++]=224|n>>>12:(t[s++]=240|n>>>18,t[s++]=128|n>>>12&63),t[s++]=128|n>>>6&63),t[s++]=128|63&n);return t}(e)},r.utf8decode=function(e){return l.nodebuffer?a.transformTo("nodebuffer",e).toString("utf-8"):function(e){for(var t,n,i=e.length,s=new Array(2*i),r=0,o=0;o<i;)if((t=e[o++])<128)s[r++]=t;else if(4<(n=c[t]))s[r++]=65533,o+=n-1;else{for(t&=2===n?31:3===n?15:7;1<n&&o<i;)t=t<<6|63&e[o++],n--;1<n?s[r++]=65533:t<65536?s[r++]=t:(t-=65536,s[r++]=55296|t>>10&1023,s[r++]=56320|1023&t)}return s.length!==r&&(s.subarray?s=s.subarray(0,r):s.length=r),a.applyFromCharCode(s)}(e=a.transformTo(l.uint8array?"uint8array":"array",e))},a.inherits(o,i),o.prototype.processChunk=function(e){var t,n=a.transformTo(l.uint8array?"uint8array":"array",e.data);this.leftOver&&this.leftOver.length&&(l.uint8array?(t=n,(n=new Uint8Array(t.length+this.leftOver.length)).set(this.leftOver,0),n.set(t,this.leftOver.length)):n=this.leftOver.concat(n),this.leftOver=null);var i=function(e,t){var n;for((t=t||e.length)>e.length&&(t=e.length),n=t-1;0<=n&&128==(192&e[n]);)n--;return!(n<0)&&0!==n&&n+c[e[n]]>t?n:t}(n),s=n;i!==n.length&&(l.uint8array?(s=n.subarray(0,i),this.leftOver=n.subarray(i,n.length)):(s=n.slice(0,i),this.leftOver=n.slice(i,n.length))),this.push({data:r.utf8decode(s),meta:e.meta})},o.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:r.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},r.Utf8DecodeWorker=o,a.inherits(d,i),d.prototype.processChunk=function(e){this.push({data:r.utf8encode(e.data),meta:e.meta})},r.Utf8EncodeWorker=d},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(e,t,a){"use strict";var l=e("./support"),c=e("./base64"),n=e("./nodejsUtils"),i=e("set-immediate-shim"),d=e("./external");function s(e){return e}function u(e,t){for(var n=0;n<e.length;++n)t[n]=255&e.charCodeAt(n);return t}a.newBlob=function(t,n){a.checkSupport("blob");try{return new Blob([t],{type:n})}catch(e){try{var i=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return i.append(t),i.getBlob(n)}catch(e){throw new Error("Bug : can't construct the Blob.")}}};var r={stringifyByChunk:function(e,t,n){var i=[],s=0,r=e.length;if(r<=n)return String.fromCharCode.apply(null,e);for(;s<r;)"array"===t||"nodebuffer"===t?i.push(String.fromCharCode.apply(null,e.slice(s,Math.min(s+n,r)))):i.push(String.fromCharCode.apply(null,e.subarray(s,Math.min(s+n,r)))),s+=n;return i.join("")},stringifyByChar:function(e){for(var t="",n=0;n<e.length;n++)t+=String.fromCharCode(e[n]);return t},applyCanBeUsed:{uint8array:function(){try{return l.uint8array&&1===String.fromCharCode.apply(null,new Uint8Array(1)).length}catch(e){return!1}}(),nodebuffer:function(){try{return l.nodebuffer&&1===String.fromCharCode.apply(null,n.allocBuffer(1)).length}catch(e){return!1}}()}};function o(e){var t=65536,n=a.getTypeOf(e),i=!0;if("uint8array"===n?i=r.applyCanBeUsed.uint8array:"nodebuffer"===n&&(i=r.applyCanBeUsed.nodebuffer),i)for(;1<t;)try{return r.stringifyByChunk(e,n,t)}catch(e){t=Math.floor(t/2)}return r.stringifyByChar(e)}function h(e,t){for(var n=0;n<e.length;n++)t[n]=e[n];return t}a.applyFromCharCode=o;var f={};f.string={string:s,array:function(e){return u(e,new Array(e.length))},arraybuffer:function(e){return f.string.uint8array(e).buffer},uint8array:function(e){return u(e,new Uint8Array(e.length))},nodebuffer:function(e){return u(e,n.allocBuffer(e.length))}},f.array={string:o,array:s,arraybuffer:function(e){return new Uint8Array(e).buffer},uint8array:function(e){return new Uint8Array(e)},nodebuffer:function(e){return n.newBufferFrom(e)}},f.arraybuffer={string:function(e){return o(new Uint8Array(e))},array:function(e){return h(new Uint8Array(e),new Array(e.byteLength))},arraybuffer:s,uint8array:function(e){return new Uint8Array(e)},nodebuffer:function(e){return n.newBufferFrom(new Uint8Array(e))}},f.uint8array={string:o,array:function(e){return h(e,new Array(e.length))},arraybuffer:function(e){return e.buffer},uint8array:s,nodebuffer:function(e){return n.newBufferFrom(e)}},f.nodebuffer={string:o,array:function(e){return h(e,new Array(e.length))},arraybuffer:function(e){return f.nodebuffer.uint8array(e).buffer},uint8array:function(e){return h(e,new Uint8Array(e.length))},nodebuffer:s},a.transformTo=function(e,t){if(t=t||"",!e)return t;a.checkSupport(e);var n=a.getTypeOf(t);return f[n][e](t)},a.getTypeOf=function(e){return"string"==typeof e?"string":"[object Array]"===Object.prototype.toString.call(e)?"array":l.nodebuffer&&n.isBuffer(e)?"nodebuffer":l.uint8array&&e instanceof Uint8Array?"uint8array":l.arraybuffer&&e instanceof ArrayBuffer?"arraybuffer":void 0},a.checkSupport=function(e){if(!l[e.toLowerCase()])throw new Error(e+" is not supported by this platform")},a.MAX_VALUE_16BITS=65535,a.MAX_VALUE_32BITS=-1,a.pretty=function(e){for(var t,n="",i=0;i<(e||"").length;i++)n+="\\x"+((t=e.charCodeAt(i))<16?"0":"")+t.toString(16).toUpperCase();return n},a.delay=function(e,t,n){i(function(){e.apply(n||null,t||[])})},a.inherits=function(e,t){function n(){}n.prototype=t.prototype,e.prototype=new n},a.extend=function(){for(var e,t={},n=0;n<arguments.length;n++)for(e in arguments[n])arguments[n].hasOwnProperty(e)&&void 0===t[e]&&(t[e]=arguments[n][e]);return t},a.prepareContent=function(i,e,s,r,o){return d.Promise.resolve(e).then(function(i){return l.blob&&(i instanceof Blob||-1!==["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(i)))&&"undefined"!=typeof FileReader?new d.Promise(function(t,n){var e=new FileReader;e.onload=function(e){t(e.target.result)},e.onerror=function(e){n(e.target.error)},e.readAsArrayBuffer(i)}):i}).then(function(e){var t,n=a.getTypeOf(e);return n?("arraybuffer"===n?e=a.transformTo("uint8array",e):"string"===n&&(o?e=c.decode(e):s&&!0!==r&&(e=u(t=e,new(l.uint8array?Uint8Array:Array)(t.length)))),e):d.Promise.reject(new Error("Can't read the data of '"+i+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,"set-immediate-shim":54}],33:[function(e,t,n){"use strict";var i=e("./reader/readerFor"),s=e("./utils"),r=e("./signature"),o=e("./zipEntry"),a=(e("./utf8"),e("./support"));function l(e){this.files=[],this.loadOptions=e}l.prototype={checkSignature:function(e){if(!this.reader.readAndCheckSignature(e)){this.reader.index-=4;var t=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+s.pretty(t)+", expected "+s.pretty(e)+")")}},isSignature:function(e,t){var n=this.reader.index;this.reader.setIndex(e);var i=this.reader.readString(4)===t;return this.reader.setIndex(n),i},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var e=this.reader.readData(this.zipCommentLength),t=a.uint8array?"uint8array":"array",n=s.transformTo(t,e);this.zipComment=this.loadOptions.decodeFileName(n)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var e,t,n,i=this.zip64EndOfCentralSize-44;0<i;)e=this.reader.readInt(2),t=this.reader.readInt(4),n=this.reader.readData(t),this.zip64ExtensibleData[e]={id:e,length:t,value:n}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){for(var e,t=0;t<this.files.length;t++)e=this.files[t],this.reader.setIndex(e.localHeaderOffset),this.checkSignature(r.LOCAL_FILE_HEADER),e.readLocalPart(this.reader),e.handleUTF8(),e.processAttributes()},readCentralDir:function(){var e;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(r.CENTRAL_FILE_HEADER);)(e=new o({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(e);if(this.centralDirRecords!==this.files.length&&0!==this.centralDirRecords&&0===this.files.length)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var e=this.reader.lastIndexOfSignature(r.CENTRAL_DIRECTORY_END);if(e<0)throw!this.isSignature(0,r.LOCAL_FILE_HEADER)?new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html"):new Error("Corrupted zip: can't find end of central directory");this.reader.setIndex(e);var t=e;if(this.checkSignature(r.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===s.MAX_VALUE_16BITS||this.diskWithCentralDirStart===s.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===s.MAX_VALUE_16BITS||this.centralDirRecords===s.MAX_VALUE_16BITS||this.centralDirSize===s.MAX_VALUE_32BITS||this.centralDirOffset===s.MAX_VALUE_32BITS){if(this.zip64=!0,(e=this.reader.lastIndexOfSignature(r.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(e),this.checkSignature(r.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,r.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(r.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(r.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var n=this.centralDirOffset+this.centralDirSize;this.zip64&&(n+=20,n+=12+this.zip64EndOfCentralSize);var i=t-n;if(0<i)this.isSignature(t,r.CENTRAL_FILE_HEADER)||(this.reader.zero=i);else if(i<0)throw new Error("Corrupted zip: missing "+Math.abs(i)+" bytes.")},prepareReader:function(e){this.reader=i(e)},load:function(e){this.prepareReader(e),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},t.exports=l},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utf8":31,"./utils":32,"./zipEntry":34}],34:[function(e,t,n){"use strict";var i=e("./reader/readerFor"),r=e("./utils"),s=e("./compressedObject"),o=e("./crc32"),a=e("./utf8"),l=e("./compressions"),c=e("./support");function d(e,t){this.options=e,this.loadOptions=t}d.prototype={isEncrypted:function(){return 1==(1&this.bitFlag)},useUTF8:function(){return 2048==(2048&this.bitFlag)},readLocalPart:function(e){var t,n;if(e.skip(22),this.fileNameLength=e.readInt(2),n=e.readInt(2),this.fileName=e.readData(this.fileNameLength),e.skip(n),-1===this.compressedSize||-1===this.uncompressedSize)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if(null===(t=function(e){for(var t in l)if(l.hasOwnProperty(t)&&l[t].magic===e)return l[t];return null}(this.compressionMethod)))throw new Error("Corrupted zip : compression "+r.pretty(this.compressionMethod)+" unknown (inner file : "+r.transformTo("string",this.fileName)+")");this.decompressed=new s(this.compressedSize,this.uncompressedSize,this.crc32,t,e.readData(this.compressedSize))},readCentralPart:function(e){this.versionMadeBy=e.readInt(2),e.skip(2),this.bitFlag=e.readInt(2),this.compressionMethod=e.readString(2),this.date=e.readDate(),this.crc32=e.readInt(4),this.compressedSize=e.readInt(4),this.uncompressedSize=e.readInt(4);var t=e.readInt(2);if(this.extraFieldsLength=e.readInt(2),this.fileCommentLength=e.readInt(2),this.diskNumberStart=e.readInt(2),this.internalFileAttributes=e.readInt(2),this.externalFileAttributes=e.readInt(4),this.localHeaderOffset=e.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");e.skip(t),this.readExtraFields(e),this.parseZIP64ExtraField(e),this.fileComment=e.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var e=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),0==e&&(this.dosPermissions=63&this.externalFileAttributes),3==e&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||"/"!==this.fileNameStr.slice(-1)||(this.dir=!0)},parseZIP64ExtraField:function(e){var t;this.extraFields[1]&&(t=i(this.extraFields[1].value),this.uncompressedSize===r.MAX_VALUE_32BITS&&(this.uncompressedSize=t.readInt(8)),this.compressedSize===r.MAX_VALUE_32BITS&&(this.compressedSize=t.readInt(8)),this.localHeaderOffset===r.MAX_VALUE_32BITS&&(this.localHeaderOffset=t.readInt(8)),this.diskNumberStart===r.MAX_VALUE_32BITS&&(this.diskNumberStart=t.readInt(4)))},readExtraFields:function(e){var t,n,i,s=e.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});e.index<s;)t=e.readInt(2),n=e.readInt(2),i=e.readData(n),this.extraFields[t]={id:t,length:n,value:i}},handleUTF8:function(){var e,t,n,i,s=c.uint8array?"uint8array":"array";this.useUTF8()?(this.fileNameStr=a.utf8decode(this.fileName),this.fileCommentStr=a.utf8decode(this.fileComment)):(null!==(e=this.findExtraFieldUnicodePath())?this.fileNameStr=e:(t=r.transformTo(s,this.fileName),this.fileNameStr=this.loadOptions.decodeFileName(t)),null!==(n=this.findExtraFieldUnicodeComment())?this.fileCommentStr=n:(i=r.transformTo(s,this.fileComment),this.fileCommentStr=this.loadOptions.decodeFileName(i)))},findExtraFieldUnicodePath:function(){var e=this.extraFields[28789];if(e){var t=i(e.value);return 1!==t.readInt(1)?null:o(this.fileName)!==t.readInt(4)?null:a.utf8decode(t.readData(e.length-5))}return null},findExtraFieldUnicodeComment:function(){var e=this.extraFields[25461];if(e){var t=i(e.value);return 1!==t.readInt(1)?null:o(this.fileComment)!==t.readInt(4)?null:a.utf8decode(t.readData(e.length-5))}return null}},t.exports=d},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(e,t,n){"use strict";function i(e,t,n){this.name=e,this.dir=n.dir,this.date=n.date,this.comment=n.comment,this.unixPermissions=n.unixPermissions,this.dosPermissions=n.dosPermissions,this._data=t,this._dataBinary=n.binary,this.options={compression:n.compression,compressionOptions:n.compressionOptions}}var r=e("./stream/StreamHelper"),s=e("./stream/DataWorker"),o=e("./utf8"),a=e("./compressedObject"),l=e("./stream/GenericWorker");i.prototype={internalStream:function(e){var t=null,n="string";try{if(!e)throw new Error("No output type specified.");var i="string"===(n=e.toLowerCase())||"text"===n;"binarystring"!==n&&"text"!==n||(n="string"),t=this._decompressWorker();var s=!this._dataBinary;s&&!i&&(t=t.pipe(new o.Utf8EncodeWorker)),!s&&i&&(t=t.pipe(new o.Utf8DecodeWorker))}catch(e){(t=new l("error")).error(e)}return new r(t,n,"")},async:function(e,t){return this.internalStream(e).accumulate(t)},nodeStream:function(e,t){return this.internalStream(e||"nodebuffer").toNodejsStream(t)},_compressWorker:function(e,t){if(this._data instanceof a&&this._data.compression.magic===e.magic)return this._data.getCompressedWorker();var n=this._decompressWorker();return this._dataBinary||(n=n.pipe(new o.Utf8EncodeWorker)),a.createWorkerFrom(n,e,t)},_decompressWorker:function(){return this._data instanceof a?this._data.getContentWorker():this._data instanceof l?this._data:new s(this._data)}};for(var c=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],d=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},u=0;u<c.length;u++)i.prototype[c[u]]=d;t.exports=i},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(e,d,t){(function(t){"use strict";var e,n,i,s,r,o=t.MutationObserver||t.WebKitMutationObserver,a=o?(e=0,n=new o(c),i=t.document.createTextNode(""),n.observe(i,{characterData:!0}),function(){i.data=e=++e%2}):t.setImmediate||void 0===t.MessageChannel?"document"in t&&"onreadystatechange"in t.document.createElement("script")?function(){var e=t.document.createElement("script");e.onreadystatechange=function(){c(),e.onreadystatechange=null,e.parentNode.removeChild(e),e=null},t.document.documentElement.appendChild(e)}:function(){setTimeout(c,0)}:((s=new t.MessageChannel).port1.onmessage=c,function(){s.port2.postMessage(0)}),l=[];function c(){var e,t;r=!0;for(var n=l.length;n;){for(t=l,l=[],e=-1;++e<n;)t[e]();n=l.length}r=!1}d.exports=function(e){1!==l.push(e)||r||a()}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],37:[function(e,t,n){"use strict";var s=e("immediate");function l(){}var c={},r=["REJECTED"],o=["FULFILLED"],i=["PENDING"];function a(e){if("function"!=typeof e)throw new TypeError("resolver must be a function");this.state=i,this.queue=[],this.outcome=void 0,e!==l&&f(this,e)}function d(e,t,n){this.promise=e,"function"==typeof t&&(this.onFulfilled=t,this.callFulfilled=this.otherCallFulfilled),"function"==typeof n&&(this.onRejected=n,this.callRejected=this.otherCallRejected)}function u(t,n,i){s(function(){var e;try{e=n(i)}catch(e){return c.reject(t,e)}e===t?c.reject(t,new TypeError("Cannot resolve promise with itself")):c.resolve(t,e)})}function h(e){var t=e&&e.then;if(e&&("object"==typeof e||"function"==typeof e)&&"function"==typeof t)return function(){t.apply(e,arguments)}}function f(t,e){var n=!1;function i(e){n||(n=!0,c.reject(t,e))}function s(e){n||(n=!0,c.resolve(t,e))}var r=m(function(){e(s,i)});"error"===r.status&&i(r.value)}function m(e,t){var n={};try{n.value=e(t),n.status="success"}catch(e){n.status="error",n.value=e}return n}(t.exports=a).prototype.finally=function(t){if("function"!=typeof t)return this;var n=this.constructor;return this.then(function(e){return n.resolve(t()).then(function(){return e})},function(e){return n.resolve(t()).then(function(){throw e})})},a.prototype.catch=function(e){return this.then(null,e)},a.prototype.then=function(e,t){if("function"!=typeof e&&this.state===o||"function"!=typeof t&&this.state===r)return this;var n=new this.constructor(l);return this.state!==i?u(n,this.state===o?e:t,this.outcome):this.queue.push(new d(n,e,t)),n},d.prototype.callFulfilled=function(e){c.resolve(this.promise,e)},d.prototype.otherCallFulfilled=function(e){u(this.promise,this.onFulfilled,e)},d.prototype.callRejected=function(e){c.reject(this.promise,e)},d.prototype.otherCallRejected=function(e){u(this.promise,this.onRejected,e)},c.resolve=function(e,t){var n=m(h,t);if("error"===n.status)return c.reject(e,n.value);var i=n.value;if(i)f(e,i);else{e.state=o,e.outcome=t;for(var s=-1,r=e.queue.length;++s<r;)e.queue[s].callFulfilled(t)}return e},c.reject=function(e,t){e.state=r,e.outcome=t;for(var n=-1,i=e.queue.length;++n<i;)e.queue[n].callRejected(t);return e},a.resolve=function(e){if(e instanceof this)return e;return c.resolve(new this(l),e)},a.reject=function(e){var t=new this(l);return c.reject(t,e)},a.all=function(e){var n=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var i=e.length,s=!1;if(!i)return this.resolve([]);var r=new Array(i),o=0,t=-1,a=new this(l);for(;++t<i;)!function(e,t){n.resolve(e).then(function(e){r[t]=e,++o!==i||s||(s=!0,c.resolve(a,r))},function(e){s||(s=!0,c.reject(a,e))})}(e[t],t);return a},a.race=function(e){var t=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var n=e.length,i=!1;if(!n)return this.resolve([]);var s=-1,r=new this(l);for(;++s<n;)!function(e){t.resolve(e).then(function(e){i||(i=!0,c.resolve(r,e))},function(e){i||(i=!0,c.reject(r,e))})}(e[s]);return r}},{immediate:36}],38:[function(e,t,n){"use strict";var i={};(0,e("./lib/utils/common").assign)(i,e("./lib/deflate"),e("./lib/inflate"),e("./lib/zlib/constants")),t.exports=i},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(e,t,n){"use strict";var o=e("./zlib/deflate"),a=e("./utils/common"),l=e("./utils/strings"),s=e("./zlib/messages"),r=e("./zlib/zstream"),c=Object.prototype.toString,d=0,u=-1,h=0,f=8;function m(e){if(!(this instanceof m))return new m(e);this.options=a.assign({level:u,method:f,chunkSize:16384,windowBits:15,memLevel:8,strategy:h,to:""},e||{});var t=this.options;if(t.raw&&0<t.windowBits?t.windowBits=-t.windowBits:t.gzip&&0<t.windowBits&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new r,this.strm.avail_out=0,(n=o.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy))!==d)throw new Error(s[n]);if(t.header&&o.deflateSetHeader(this.strm,t.header),t.dictionary){var n,i="string"==typeof t.dictionary?l.string2buf(t.dictionary):"[object ArrayBuffer]"===c.call(t.dictionary)?new Uint8Array(t.dictionary):t.dictionary;if((n=o.deflateSetDictionary(this.strm,i))!==d)throw new Error(s[n]);this._dict_set=!0}}function i(e,t){var n=new m(t);if(n.push(e,!0),n.err)throw n.msg||s[n.err];return n.result}m.prototype.push=function(e,t){var n,i,s=this.strm,r=this.options.chunkSize;if(this.ended)return!1;i=t===~~t?t:!0===t?4:0,"string"==typeof e?s.input=l.string2buf(e):"[object ArrayBuffer]"===c.call(e)?s.input=new Uint8Array(e):s.input=e,s.next_in=0,s.avail_in=s.input.length;do{if(0===s.avail_out&&(s.output=new a.Buf8(r),s.next_out=0,s.avail_out=r),1!==(n=o.deflate(s,i))&&n!==d)return this.onEnd(n),!(this.ended=!0);0!==s.avail_out&&(0!==s.avail_in||4!==i&&2!==i)||("string"===this.options.to?this.onData(l.buf2binstring(a.shrinkBuf(s.output,s.next_out))):this.onData(a.shrinkBuf(s.output,s.next_out)))}while((0<s.avail_in||0===s.avail_out)&&1!==n);return 4===i?(n=o.deflateEnd(this.strm),this.onEnd(n),this.ended=!0,n===d):2!==i||(this.onEnd(d),!(s.avail_out=0))},m.prototype.onData=function(e){this.chunks.push(e)},m.prototype.onEnd=function(e){e===d&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=a.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},n.Deflate=m,n.deflate=i,n.deflateRaw=function(e,t){return(t=t||{}).raw=!0,i(e,t)},n.gzip=function(e,t){return(t=t||{}).gzip=!0,i(e,t)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(e,t,n){"use strict";var h=e("./zlib/inflate"),f=e("./utils/common"),m=e("./utils/strings"),p=e("./zlib/constants"),i=e("./zlib/messages"),s=e("./zlib/zstream"),r=e("./zlib/gzheader"),g=Object.prototype.toString;function o(e){if(!(this instanceof o))return new o(e);this.options=f.assign({chunkSize:16384,windowBits:0,to:""},e||{});var t=this.options;t.raw&&0<=t.windowBits&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(0<=t.windowBits&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),15<t.windowBits&&t.windowBits<48&&0==(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new s,this.strm.avail_out=0;var n=h.inflateInit2(this.strm,t.windowBits);if(n!==p.Z_OK)throw new Error(i[n]);this.header=new r,h.inflateGetHeader(this.strm,this.header)}function a(e,t){var n=new o(t);if(n.push(e,!0),n.err)throw n.msg||i[n.err];return n.result}o.prototype.push=function(e,t){var n,i,s,r,o,a,l=this.strm,c=this.options.chunkSize,d=this.options.dictionary,u=!1;if(this.ended)return!1;i=t===~~t?t:!0===t?p.Z_FINISH:p.Z_NO_FLUSH,"string"==typeof e?l.input=m.binstring2buf(e):"[object ArrayBuffer]"===g.call(e)?l.input=new Uint8Array(e):l.input=e,l.next_in=0,l.avail_in=l.input.length;do{if(0===l.avail_out&&(l.output=new f.Buf8(c),l.next_out=0,l.avail_out=c),(n=h.inflate(l,p.Z_NO_FLUSH))===p.Z_NEED_DICT&&d&&(a="string"==typeof d?m.string2buf(d):"[object ArrayBuffer]"===g.call(d)?new Uint8Array(d):d,n=h.inflateSetDictionary(this.strm,a)),n===p.Z_BUF_ERROR&&!0===u&&(n=p.Z_OK,u=!1),n!==p.Z_STREAM_END&&n!==p.Z_OK)return this.onEnd(n),!(this.ended=!0);l.next_out&&(0!==l.avail_out&&n!==p.Z_STREAM_END&&(0!==l.avail_in||i!==p.Z_FINISH&&i!==p.Z_SYNC_FLUSH)||("string"===this.options.to?(s=m.utf8border(l.output,l.next_out),r=l.next_out-s,o=m.buf2string(l.output,s),l.next_out=r,l.avail_out=c-r,r&&f.arraySet(l.output,l.output,s,r,0),this.onData(o)):this.onData(f.shrinkBuf(l.output,l.next_out)))),0===l.avail_in&&0===l.avail_out&&(u=!0)}while((0<l.avail_in||0===l.avail_out)&&n!==p.Z_STREAM_END);return n===p.Z_STREAM_END&&(i=p.Z_FINISH),i===p.Z_FINISH?(n=h.inflateEnd(this.strm),this.onEnd(n),this.ended=!0,n===p.Z_OK):i!==p.Z_SYNC_FLUSH||(this.onEnd(p.Z_OK),!(l.avail_out=0))},o.prototype.onData=function(e){this.chunks.push(e)},o.prototype.onEnd=function(e){e===p.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=f.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},n.Inflate=o,n.inflate=a,n.inflateRaw=function(e,t){return(t=t||{}).raw=!0,a(e,t)},n.ungzip=a},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(e,t,n){"use strict";var i="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;n.assign=function(e){for(var t=Array.prototype.slice.call(arguments,1);t.length;){var n=t.shift();if(n){if("object"!=typeof n)throw new TypeError(n+"must be non-object");for(var i in n)n.hasOwnProperty(i)&&(e[i]=n[i])}}return e},n.shrinkBuf=function(e,t){return e.length===t?e:e.subarray?e.subarray(0,t):(e.length=t,e)};var s={arraySet:function(e,t,n,i,s){if(t.subarray&&e.subarray)e.set(t.subarray(n,n+i),s);else for(var r=0;r<i;r++)e[s+r]=t[n+r]},flattenChunks:function(e){for(var t,n,i,s=0,r=0,o=e.length;r<o;r++)s+=e[r].length;for(i=new Uint8Array(s),r=t=0,o=e.length;r<o;r++)n=e[r],i.set(n,t),t+=n.length;return i}},r={arraySet:function(e,t,n,i,s){for(var r=0;r<i;r++)e[s+r]=t[n+r]},flattenChunks:function(e){return[].concat.apply([],e)}};n.setTyped=function(e){e?(n.Buf8=Uint8Array,n.Buf16=Uint16Array,n.Buf32=Int32Array,n.assign(n,s)):(n.Buf8=Array,n.Buf16=Array,n.Buf32=Array,n.assign(n,r))},n.setTyped(i)},{}],42:[function(e,t,n){"use strict";var l=e("./common"),s=!0,r=!0;try{String.fromCharCode.apply(null,[0])}catch(e){s=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){r=!1}for(var c=new l.Buf8(256),i=0;i<256;i++)c[i]=252<=i?6:248<=i?5:240<=i?4:224<=i?3:192<=i?2:1;function d(e,t){if(t<65537&&(e.subarray&&r||!e.subarray&&s))return String.fromCharCode.apply(null,l.shrinkBuf(e,t));for(var n="",i=0;i<t;i++)n+=String.fromCharCode(e[i]);return n}c[254]=c[254]=1,n.string2buf=function(e){for(var t,n,i,s,r=e.length,o=0,a=0;a<r;a++)55296==(64512&(n=e.charCodeAt(a)))&&a+1<r&&56320==(64512&(i=e.charCodeAt(a+1)))&&(n=65536+(n-55296<<10)+(i-56320),a++),o+=n<128?1:n<2048?2:n<65536?3:4;for(t=new l.Buf8(o),a=s=0;s<o;a++)55296==(64512&(n=e.charCodeAt(a)))&&a+1<r&&56320==(64512&(i=e.charCodeAt(a+1)))&&(n=65536+(n-55296<<10)+(i-56320),a++),n<128?t[s++]=n:(n<2048?t[s++]=192|n>>>6:(n<65536?t[s++]=224|n>>>12:(t[s++]=240|n>>>18,t[s++]=128|n>>>12&63),t[s++]=128|n>>>6&63),t[s++]=128|63&n);return t},n.buf2binstring=function(e){return d(e,e.length)},n.binstring2buf=function(e){for(var t=new l.Buf8(e.length),n=0,i=t.length;n<i;n++)t[n]=e.charCodeAt(n);return t},n.buf2string=function(e,t){for(var n,i,s=t||e.length,r=new Array(2*s),o=0,a=0;a<s;)if((n=e[a++])<128)r[o++]=n;else if(4<(i=c[n]))r[o++]=65533,a+=i-1;else{for(n&=2===i?31:3===i?15:7;1<i&&a<s;)n=n<<6|63&e[a++],i--;1<i?r[o++]=65533:n<65536?r[o++]=n:(n-=65536,r[o++]=55296|n>>10&1023,r[o++]=56320|1023&n)}return d(r,o)},n.utf8border=function(e,t){var n;for((t=t||e.length)>e.length&&(t=e.length),n=t-1;0<=n&&128==(192&e[n]);)n--;return!(n<0)&&0!==n&&n+c[e[n]]>t?n:t}},{"./common":41}],43:[function(e,t,n){"use strict";t.exports=function(e,t,n,i){for(var s=65535&e|0,r=e>>>16&65535|0,o=0;0!==n;){for(n-=o=2e3<n?2e3:n;r=r+(s=s+t[i++]|0)|0,--o;);s%=65521,r%=65521}return s|r<<16|0}},{}],44:[function(e,t,n){"use strict";t.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(e,t,n){"use strict";var a=function(){for(var e,t=[],n=0;n<256;n++){e=n;for(var i=0;i<8;i++)e=1&e?3988292384^e>>>1:e>>>1;t[n]=e}return t}();t.exports=function(e,t,n,i){var s=a,r=i+n;e^=-1;for(var o=i;o<r;o++)e=e>>>8^s[255&(e^t[o])];return-1^e}},{}],46:[function(e,t,n){"use strict";var l,h=e("../utils/common"),c=e("./trees"),f=e("./adler32"),m=e("./crc32"),i=e("./messages"),d=0,u=4,p=0,g=-2,b=-1,v=4,s=2,w=8,y=9,r=286,o=30,a=19,_=2*r+1,I=15,k=3,C=258,x=C+k+1,S=42,A=113,T=1,E=2,R=3,M=4;function O(e,t){return e.msg=i[t],t}function P(e){return(e<<1)-(4<e?9:0)}function z(e){for(var t=e.length;0<=--t;)e[t]=0}function j(e){var t=e.state,n=t.pending;n>e.avail_out&&(n=e.avail_out),0!==n&&(h.arraySet(e.output,t.pending_buf,t.pending_out,n,e.next_out),e.next_out+=n,t.pending_out+=n,e.total_out+=n,e.avail_out-=n,t.pending-=n,0===t.pending&&(t.pending_out=0))}function U(e,t){c._tr_flush_block(e,0<=e.block_start?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,j(e.strm)}function B(e,t){e.pending_buf[e.pending++]=t}function D(e,t){e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t}function F(e,t){var n,i,s=e.max_chain_length,r=e.strstart,o=e.prev_length,a=e.nice_match,l=e.strstart>e.w_size-x?e.strstart-(e.w_size-x):0,c=e.window,d=e.w_mask,u=e.prev,h=e.strstart+C,f=c[r+o-1],m=c[r+o];e.prev_length>=e.good_match&&(s>>=2),a>e.lookahead&&(a=e.lookahead);do{if(c[(n=t)+o]===m&&c[n+o-1]===f&&c[n]===c[r]&&c[++n]===c[r+1]){r+=2,n++;do{}while(c[++r]===c[++n]&&c[++r]===c[++n]&&c[++r]===c[++n]&&c[++r]===c[++n]&&c[++r]===c[++n]&&c[++r]===c[++n]&&c[++r]===c[++n]&&c[++r]===c[++n]&&r<h);if(i=C-(h-r),r=h-C,o<i){if(e.match_start=t,a<=(o=i))break;f=c[r+o-1],m=c[r+o]}}}while((t=u[t&d])>l&&0!=--s);return o<=e.lookahead?o:e.lookahead}function N(e){var t,n,i,s,r,o,a,l,c,d,u=e.w_size;do{if(s=e.window_size-e.lookahead-e.strstart,e.strstart>=u+(u-x)){for(h.arraySet(e.window,e.window,u,u,0),e.match_start-=u,e.strstart-=u,e.block_start-=u,t=n=e.hash_size;i=e.head[--t],e.head[t]=u<=i?i-u:0,--n;);for(t=n=u;i=e.prev[--t],e.prev[t]=u<=i?i-u:0,--n;);s+=u}if(0===e.strm.avail_in)break;if(o=e.strm,a=e.window,l=e.strstart+e.lookahead,c=s,d=void 0,d=o.avail_in,c<d&&(d=c),n=0===d?0:(o.avail_in-=d,h.arraySet(a,o.input,o.next_in,d,l),1===o.state.wrap?o.adler=f(o.adler,a,d,l):2===o.state.wrap&&(o.adler=m(o.adler,a,d,l)),o.next_in+=d,o.total_in+=d,d),e.lookahead+=n,e.lookahead+e.insert>=k)for(r=e.strstart-e.insert,e.ins_h=e.window[r],e.ins_h=(e.ins_h<<e.hash_shift^e.window[r+1])&e.hash_mask;e.insert&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[r+k-1])&e.hash_mask,e.prev[r&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=r,r++,e.insert--,!(e.lookahead+e.insert<k)););}while(e.lookahead<x&&0!==e.strm.avail_in)}function $(e,t){for(var n,i;;){if(e.lookahead<x){if(N(e),e.lookahead<x&&t===d)return T;if(0===e.lookahead)break}if(n=0,e.lookahead>=k&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+k-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==n&&e.strstart-n<=e.w_size-x&&(e.match_length=F(e,n)),e.match_length>=k)if(i=c._tr_tally(e,e.strstart-e.match_start,e.match_length-k),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=k){for(e.match_length--;e.strstart++,e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+k-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart,0!=--e.match_length;);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+1])&e.hash_mask;else i=c._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(i&&(U(e,!1),0===e.strm.avail_out))return T}return e.insert=e.strstart<k-1?e.strstart:k-1,t===u?(U(e,!0),0===e.strm.avail_out?R:M):e.last_lit&&(U(e,!1),0===e.strm.avail_out)?T:E}function L(e,t){for(var n,i,s;;){if(e.lookahead<x){if(N(e),e.lookahead<x&&t===d)return T;if(0===e.lookahead)break}if(n=0,e.lookahead>=k&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+k-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=k-1,0!==n&&e.prev_length<e.max_lazy_match&&e.strstart-n<=e.w_size-x&&(e.match_length=F(e,n),e.match_length<=5&&(1===e.strategy||e.match_length===k&&4096<e.strstart-e.match_start)&&(e.match_length=k-1)),e.prev_length>=k&&e.match_length<=e.prev_length){for(s=e.strstart+e.lookahead-k,i=c._tr_tally(e,e.strstart-1-e.prev_match,e.prev_length-k),e.lookahead-=e.prev_length-1,e.prev_length-=2;++e.strstart<=s&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+k-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!=--e.prev_length;);if(e.match_available=0,e.match_length=k-1,e.strstart++,i&&(U(e,!1),0===e.strm.avail_out))return T}else if(e.match_available){if((i=c._tr_tally(e,0,e.window[e.strstart-1]))&&U(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return T}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(i=c._tr_tally(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<k-1?e.strstart:k-1,t===u?(U(e,!0),0===e.strm.avail_out?R:M):e.last_lit&&(U(e,!1),0===e.strm.avail_out)?T:E}function V(e,t,n,i,s){this.good_length=e,this.max_lazy=t,this.nice_length=n,this.max_chain=i,this.func=s}function q(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=w,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new h.Buf16(2*_),this.dyn_dtree=new h.Buf16(2*(2*o+1)),this.bl_tree=new h.Buf16(2*(2*a+1)),z(this.dyn_ltree),z(this.dyn_dtree),z(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new h.Buf16(I+1),this.heap=new h.Buf16(2*r+1),z(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new h.Buf16(2*r+1),z(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function H(e){var t;return e&&e.state?(e.total_in=e.total_out=0,e.data_type=s,(t=e.state).pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap?S:A,e.adler=2===t.wrap?0:1,t.last_flush=d,c._tr_init(t),p):O(e,g)}function W(e){var t,n=H(e);return n===p&&((t=e.state).window_size=2*t.w_size,z(t.head),t.max_lazy_match=l[t.level].max_lazy,t.good_match=l[t.level].good_length,t.nice_match=l[t.level].nice_length,t.max_chain_length=l[t.level].max_chain,t.strstart=0,t.block_start=0,t.lookahead=0,t.insert=0,t.match_length=t.prev_length=k-1,t.match_available=0,t.ins_h=0),n}function Z(e,t,n,i,s,r){if(!e)return g;var o=1;if(t===b&&(t=6),i<0?(o=0,i=-i):15<i&&(o=2,i-=16),s<1||y<s||n!==w||i<8||15<i||t<0||9<t||r<0||v<r)return O(e,g);8===i&&(i=9);var a=new q;return(e.state=a).strm=e,a.wrap=o,a.gzhead=null,a.w_bits=i,a.w_size=1<<a.w_bits,a.w_mask=a.w_size-1,a.hash_bits=s+7,a.hash_size=1<<a.hash_bits,a.hash_mask=a.hash_size-1,a.hash_shift=~~((a.hash_bits+k-1)/k),a.window=new h.Buf8(2*a.w_size),a.head=new h.Buf16(a.hash_size),a.prev=new h.Buf16(a.w_size),a.lit_bufsize=1<<s+6,a.pending_buf_size=4*a.lit_bufsize,a.pending_buf=new h.Buf8(a.pending_buf_size),a.d_buf=+a.lit_bufsize,a.l_buf=3*a.lit_bufsize,a.level=t,a.strategy=r,a.method=n,W(e)}l=[new V(0,0,0,0,function(e,t){var n=65535;for(n>e.pending_buf_size-5&&(n=e.pending_buf_size-5);;){if(e.lookahead<=1){if(N(e),0===e.lookahead&&t===d)return T;if(0===e.lookahead)break}e.strstart+=e.lookahead,e.lookahead=0;var i=e.block_start+n;if((0===e.strstart||e.strstart>=i)&&(e.lookahead=e.strstart-i,e.strstart=i,U(e,!1),0===e.strm.avail_out))return T;if(e.strstart-e.block_start>=e.w_size-x&&(U(e,!1),0===e.strm.avail_out))return T}return e.insert=0,t===u?(U(e,!0),0===e.strm.avail_out?R:M):(e.strstart>e.block_start&&(U(e,!1),e.strm.avail_out),T)}),new V(4,4,8,4,$),new V(4,5,16,8,$),new V(4,6,32,32,$),new V(4,4,16,16,L),new V(8,16,32,32,L),new V(8,16,128,128,L),new V(8,32,128,256,L),new V(32,128,258,1024,L),new V(32,258,258,4096,L)],n.deflateInit=function(e,t){return Z(e,t,w,15,8,0)},n.deflateInit2=Z,n.deflateReset=W,n.deflateResetKeep=H,n.deflateSetHeader=function(e,t){return!e||!e.state||2!==e.state.wrap?g:(e.state.gzhead=t,p)},n.deflate=function(e,t){var n,i,s,r,o;if(!e||!e.state||5<t||t<0)return e?O(e,g):g;if(i=e.state,!e.output||!e.input&&0!==e.avail_in||666===i.status&&t!==u)return O(e,0===e.avail_out?-5:g);if(i.strm=e,n=i.last_flush,i.last_flush=t,i.status===S&&(2===i.wrap?(e.adler=0,B(i,31),B(i,139),B(i,8),i.gzhead?(B(i,(i.gzhead.text?1:0)+(i.gzhead.hcrc?2:0)+(i.gzhead.extra?4:0)+(i.gzhead.name?8:0)+(i.gzhead.comment?16:0)),B(i,255&i.gzhead.time),B(i,i.gzhead.time>>8&255),B(i,i.gzhead.time>>16&255),B(i,i.gzhead.time>>24&255),B(i,9===i.level?2:2<=i.strategy||i.level<2?4:0),B(i,255&i.gzhead.os),i.gzhead.extra&&i.gzhead.extra.length&&(B(i,255&i.gzhead.extra.length),B(i,i.gzhead.extra.length>>8&255)),i.gzhead.hcrc&&(e.adler=m(e.adler,i.pending_buf,i.pending,0)),i.gzindex=0,i.status=69):(B(i,0),B(i,0),B(i,0),B(i,0),B(i,0),B(i,9===i.level?2:2<=i.strategy||i.level<2?4:0),B(i,3),i.status=A)):(o=w+(i.w_bits-8<<4)<<8,o|=(2<=i.strategy||i.level<2?0:i.level<6?1:6===i.level?2:3)<<6,0!==i.strstart&&(o|=32),o+=31-o%31,i.status=A,D(i,o),0!==i.strstart&&(D(i,e.adler>>>16),D(i,65535&e.adler)),e.adler=1)),69===i.status)if(i.gzhead.extra){for(s=i.pending;i.gzindex<(65535&i.gzhead.extra.length)&&(i.pending!==i.pending_buf_size||(i.gzhead.hcrc&&i.pending>s&&(e.adler=m(e.adler,i.pending_buf,i.pending-s,s)),j(e),s=i.pending,i.pending!==i.pending_buf_size));)B(i,255&i.gzhead.extra[i.gzindex]),i.gzindex++;i.gzhead.hcrc&&i.pending>s&&(e.adler=m(e.adler,i.pending_buf,i.pending-s,s)),i.gzindex===i.gzhead.extra.length&&(i.gzindex=0,i.status=73)}else i.status=73;if(73===i.status)if(i.gzhead.name){s=i.pending;do{if(i.pending===i.pending_buf_size&&(i.gzhead.hcrc&&i.pending>s&&(e.adler=m(e.adler,i.pending_buf,i.pending-s,s)),j(e),s=i.pending,i.pending===i.pending_buf_size)){r=1;break}r=i.gzindex<i.gzhead.name.length?255&i.gzhead.name.charCodeAt(i.gzindex++):0,B(i,r)}while(0!==r);i.gzhead.hcrc&&i.pending>s&&(e.adler=m(e.adler,i.pending_buf,i.pending-s,s)),0===r&&(i.gzindex=0,i.status=91)}else i.status=91;if(91===i.status)if(i.gzhead.comment){s=i.pending;do{if(i.pending===i.pending_buf_size&&(i.gzhead.hcrc&&i.pending>s&&(e.adler=m(e.adler,i.pending_buf,i.pending-s,s)),j(e),s=i.pending,i.pending===i.pending_buf_size)){r=1;break}r=i.gzindex<i.gzhead.comment.length?255&i.gzhead.comment.charCodeAt(i.gzindex++):0,B(i,r)}while(0!==r);i.gzhead.hcrc&&i.pending>s&&(e.adler=m(e.adler,i.pending_buf,i.pending-s,s)),0===r&&(i.status=103)}else i.status=103;if(103===i.status&&(i.gzhead.hcrc?(i.pending+2>i.pending_buf_size&&j(e),i.pending+2<=i.pending_buf_size&&(B(i,255&e.adler),B(i,e.adler>>8&255),e.adler=0,i.status=A)):i.status=A),0!==i.pending){if(j(e),0===e.avail_out)return i.last_flush=-1,p}else if(0===e.avail_in&&P(t)<=P(n)&&t!==u)return O(e,-5);if(666===i.status&&0!==e.avail_in)return O(e,-5);if(0!==e.avail_in||0!==i.lookahead||t!==d&&666!==i.status){var a=2===i.strategy?function(e,t){for(var n;;){if(0===e.lookahead&&(N(e),0===e.lookahead)){if(t===d)return T;break}if(e.match_length=0,n=c._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,n&&(U(e,!1),0===e.strm.avail_out))return T}return e.insert=0,t===u?(U(e,!0),0===e.strm.avail_out?R:M):e.last_lit&&(U(e,!1),0===e.strm.avail_out)?T:E}(i,t):3===i.strategy?function(e,t){for(var n,i,s,r,o=e.window;;){if(e.lookahead<=C){if(N(e),e.lookahead<=C&&t===d)return T;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=k&&0<e.strstart&&(i=o[s=e.strstart-1])===o[++s]&&i===o[++s]&&i===o[++s]){r=e.strstart+C;do{}while(i===o[++s]&&i===o[++s]&&i===o[++s]&&i===o[++s]&&i===o[++s]&&i===o[++s]&&i===o[++s]&&i===o[++s]&&s<r);e.match_length=C-(r-s),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=k?(n=c._tr_tally(e,1,e.match_length-k),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(n=c._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),n&&(U(e,!1),0===e.strm.avail_out))return T}return e.insert=0,t===u?(U(e,!0),0===e.strm.avail_out?R:M):e.last_lit&&(U(e,!1),0===e.strm.avail_out)?T:E}(i,t):l[i.level].func(i,t);if(a!==R&&a!==M||(i.status=666),a===T||a===R)return 0===e.avail_out&&(i.last_flush=-1),p;if(a===E&&(1===t?c._tr_align(i):5!==t&&(c._tr_stored_block(i,0,0,!1),3===t&&(z(i.head),0===i.lookahead&&(i.strstart=0,i.block_start=0,i.insert=0))),j(e),0===e.avail_out))return i.last_flush=-1,p}return t!==u?p:i.wrap<=0?1:(2===i.wrap?(B(i,255&e.adler),B(i,e.adler>>8&255),B(i,e.adler>>16&255),B(i,e.adler>>24&255),B(i,255&e.total_in),B(i,e.total_in>>8&255),B(i,e.total_in>>16&255),B(i,e.total_in>>24&255)):(D(i,e.adler>>>16),D(i,65535&e.adler)),j(e),0<i.wrap&&(i.wrap=-i.wrap),0!==i.pending?p:1)},n.deflateEnd=function(e){var t;return e&&e.state?(t=e.state.status)!==S&&69!==t&&73!==t&&91!==t&&103!==t&&t!==A&&666!==t?O(e,g):(e.state=null,t===A?O(e,-3):p):g},n.deflateSetDictionary=function(e,t){var n,i,s,r,o,a,l,c,d=t.length;if(!e||!e.state)return g;if(2===(r=(n=e.state).wrap)||1===r&&n.status!==S||n.lookahead)return g;for(1===r&&(e.adler=f(e.adler,t,d,0)),n.wrap=0,d>=n.w_size&&(0===r&&(z(n.head),n.strstart=0,n.block_start=0,n.insert=0),c=new h.Buf8(n.w_size),h.arraySet(c,t,d-n.w_size,n.w_size,0),t=c,d=n.w_size),o=e.avail_in,a=e.next_in,l=e.input,e.avail_in=d,e.next_in=0,e.input=t,N(n);n.lookahead>=k;){for(i=n.strstart,s=n.lookahead-(k-1);n.ins_h=(n.ins_h<<n.hash_shift^n.window[i+k-1])&n.hash_mask,n.prev[i&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=i,i++,--s;);n.strstart=i,n.lookahead=k-1,N(n)}return n.strstart+=n.lookahead,n.block_start=n.strstart,n.insert=n.lookahead,n.lookahead=0,n.match_length=n.prev_length=k-1,n.match_available=0,e.next_in=a,e.input=l,e.avail_in=o,n.wrap=r,p},n.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(e,t,n){"use strict";t.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(e,t,n){"use strict";t.exports=function(e,t){var n,i,s,r,o,a,l=e.state,c=e.next_in,d=e.input,u=c+(e.avail_in-5),h=e.next_out,f=e.output,m=h-(t-e.avail_out),p=h+(e.avail_out-257),g=l.dmax,b=l.wsize,v=l.whave,w=l.wnext,y=l.window,_=l.hold,I=l.bits,k=l.lencode,C=l.distcode,x=(1<<l.lenbits)-1,S=(1<<l.distbits)-1;e:do{I<15&&(_+=d[c++]<<I,I+=8,_+=d[c++]<<I,I+=8),n=k[_&x];t:for(;;){if(_>>>=i=n>>>24,I-=i,0===(i=n>>>16&255))f[h++]=65535&n;else{if(!(16&i)){if(0==(64&i)){n=k[(65535&n)+(_&(1<<i)-1)];continue t}if(32&i){l.mode=12;break e}e.msg="invalid literal/length code",l.mode=30;break e}s=65535&n,(i&=15)&&(I<i&&(_+=d[c++]<<I,I+=8),s+=_&(1<<i)-1,_>>>=i,I-=i),I<15&&(_+=d[c++]<<I,I+=8,_+=d[c++]<<I,I+=8),n=C[_&S];n:for(;;){if(_>>>=i=n>>>24,I-=i,!(16&(i=n>>>16&255))){if(0==(64&i)){n=C[(65535&n)+(_&(1<<i)-1)];continue n}e.msg="invalid distance code",l.mode=30;break e}if(r=65535&n,I<(i&=15)&&(_+=d[c++]<<I,(I+=8)<i&&(_+=d[c++]<<I,I+=8)),g<(r+=_&(1<<i)-1)){e.msg="invalid distance too far back",l.mode=30;break e}if(_>>>=i,I-=i,(i=h-m)<r){if(v<(i=r-i)&&l.sane){e.msg="invalid distance too far back",l.mode=30;break e}if(a=y,(o=0)===w){if(o+=b-i,i<s){for(s-=i;f[h++]=y[o++],--i;);o=h-r,a=f}}else if(w<i){if(o+=b+w-i,(i-=w)<s){for(s-=i;f[h++]=y[o++],--i;);if(o=0,w<s){for(s-=i=w;f[h++]=y[o++],--i;);o=h-r,a=f}}}else if(o+=w-i,i<s){for(s-=i;f[h++]=y[o++],--i;);o=h-r,a=f}for(;2<s;)f[h++]=a[o++],f[h++]=a[o++],f[h++]=a[o++],s-=3;s&&(f[h++]=a[o++],1<s&&(f[h++]=a[o++]))}else{for(o=h-r;f[h++]=f[o++],f[h++]=f[o++],f[h++]=f[o++],2<(s-=3););s&&(f[h++]=f[o++],1<s&&(f[h++]=f[o++]))}break}}break}}while(c<u&&h<p);c-=s=I>>3,_&=(1<<(I-=s<<3))-1,e.next_in=c,e.next_out=h,e.avail_in=c<u?u-c+5:5-(c-u),e.avail_out=h<p?p-h+257:257-(h-p),l.hold=_,l.bits=I}},{}],49:[function(e,t,n){"use strict";var E=e("../utils/common"),R=e("./adler32"),M=e("./crc32"),O=e("./inffast"),P=e("./inftrees"),z=1,j=2,U=0,B=-2,D=1,i=852,s=592;function F(e){return(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24)}function r(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new E.Buf16(320),this.work=new E.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function o(e){var t;return e&&e.state?(t=e.state,e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=D,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new E.Buf32(i),t.distcode=t.distdyn=new E.Buf32(s),t.sane=1,t.back=-1,U):B}function a(e){var t;return e&&e.state?((t=e.state).wsize=0,t.whave=0,t.wnext=0,o(e)):B}function l(e,t){var n,i;return e&&e.state?(i=e.state,t<0?(n=0,t=-t):(n=1+(t>>4),t<48&&(t&=15)),t&&(t<8||15<t)?B:(null!==i.window&&i.wbits!==t&&(i.window=null),i.wrap=n,i.wbits=t,a(e))):B}function c(e,t){var n,i;return e?(i=new r,(e.state=i).window=null,(n=l(e,t))!==U&&(e.state=null),n):B}var N,$,L=!0;function V(e,t,n,i){var s,r=e.state;return null===r.window&&(r.wsize=1<<r.wbits,r.wnext=0,r.whave=0,r.window=new E.Buf8(r.wsize)),i>=r.wsize?(E.arraySet(r.window,t,n-r.wsize,r.wsize,0),r.wnext=0,r.whave=r.wsize):(i<(s=r.wsize-r.wnext)&&(s=i),E.arraySet(r.window,t,n-i,s,r.wnext),(i-=s)?(E.arraySet(r.window,t,n-i,i,0),r.wnext=i,r.whave=r.wsize):(r.wnext+=s,r.wnext===r.wsize&&(r.wnext=0),r.whave<r.wsize&&(r.whave+=s))),0}n.inflateReset=a,n.inflateReset2=l,n.inflateResetKeep=o,n.inflateInit=function(e){return c(e,15)},n.inflateInit2=c,n.inflate=function(e,t){var n,i,s,r,o,a,l,c,d,u,h,f,m,p,g,b,v,w,y,_,I,k,C,x,S=0,A=new E.Buf8(4),T=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!e||!e.state||!e.output||!e.input&&0!==e.avail_in)return B;12===(n=e.state).mode&&(n.mode=13),o=e.next_out,s=e.output,l=e.avail_out,r=e.next_in,i=e.input,a=e.avail_in,c=n.hold,d=n.bits,u=a,h=l,k=U;e:for(;;)switch(n.mode){case D:if(0===n.wrap){n.mode=13;break}for(;d<16;){if(0===a)break e;a--,c+=i[r++]<<d,d+=8}if(2&n.wrap&&35615===c){A[n.check=0]=255&c,A[1]=c>>>8&255,n.check=M(n.check,A,2,0),d=c=0,n.mode=2;break}if(n.flags=0,n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&c)<<8)+(c>>8))%31){e.msg="incorrect header check",n.mode=30;break}if(8!=(15&c)){e.msg="unknown compression method",n.mode=30;break}if(d-=4,I=8+(15&(c>>>=4)),0===n.wbits)n.wbits=I;else if(I>n.wbits){e.msg="invalid window size",n.mode=30;break}n.dmax=1<<I,e.adler=n.check=1,n.mode=512&c?10:12,d=c=0;break;case 2:for(;d<16;){if(0===a)break e;a--,c+=i[r++]<<d,d+=8}if(n.flags=c,8!=(255&n.flags)){e.msg="unknown compression method",n.mode=30;break}if(57344&n.flags){e.msg="unknown header flags set",n.mode=30;break}n.head&&(n.head.text=c>>8&1),512&n.flags&&(A[0]=255&c,A[1]=c>>>8&255,n.check=M(n.check,A,2,0)),d=c=0,n.mode=3;case 3:for(;d<32;){if(0===a)break e;a--,c+=i[r++]<<d,d+=8}n.head&&(n.head.time=c),512&n.flags&&(A[0]=255&c,A[1]=c>>>8&255,A[2]=c>>>16&255,A[3]=c>>>24&255,n.check=M(n.check,A,4,0)),d=c=0,n.mode=4;case 4:for(;d<16;){if(0===a)break e;a--,c+=i[r++]<<d,d+=8}n.head&&(n.head.xflags=255&c,n.head.os=c>>8),512&n.flags&&(A[0]=255&c,A[1]=c>>>8&255,n.check=M(n.check,A,2,0)),d=c=0,n.mode=5;case 5:if(1024&n.flags){for(;d<16;){if(0===a)break e;a--,c+=i[r++]<<d,d+=8}n.length=c,n.head&&(n.head.extra_len=c),512&n.flags&&(A[0]=255&c,A[1]=c>>>8&255,n.check=M(n.check,A,2,0)),d=c=0}else n.head&&(n.head.extra=null);n.mode=6;case 6:if(1024&n.flags&&(a<(f=n.length)&&(f=a),f&&(n.head&&(I=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Array(n.head.extra_len)),E.arraySet(n.head.extra,i,r,f,I)),512&n.flags&&(n.check=M(n.check,i,f,r)),a-=f,r+=f,n.length-=f),n.length))break e;n.length=0,n.mode=7;case 7:if(2048&n.flags){if(0===a)break e;for(f=0;I=i[r+f++],n.head&&I&&n.length<65536&&(n.head.name+=String.fromCharCode(I)),I&&f<a;);if(512&n.flags&&(n.check=M(n.check,i,f,r)),a-=f,r+=f,I)break e}else n.head&&(n.head.name=null);n.length=0,n.mode=8;case 8:if(4096&n.flags){if(0===a)break e;for(f=0;I=i[r+f++],n.head&&I&&n.length<65536&&(n.head.comment+=String.fromCharCode(I)),I&&f<a;);if(512&n.flags&&(n.check=M(n.check,i,f,r)),a-=f,r+=f,I)break e}else n.head&&(n.head.comment=null);n.mode=9;case 9:if(512&n.flags){for(;d<16;){if(0===a)break e;a--,c+=i[r++]<<d,d+=8}if(c!==(65535&n.check)){e.msg="header crc mismatch",n.mode=30;break}d=c=0}n.head&&(n.head.hcrc=n.flags>>9&1,n.head.done=!0),e.adler=n.check=0,n.mode=12;break;case 10:for(;d<32;){if(0===a)break e;a--,c+=i[r++]<<d,d+=8}e.adler=n.check=F(c),d=c=0,n.mode=11;case 11:if(0===n.havedict)return e.next_out=o,e.avail_out=l,e.next_in=r,e.avail_in=a,n.hold=c,n.bits=d,2;e.adler=n.check=1,n.mode=12;case 12:if(5===t||6===t)break e;case 13:if(n.last){c>>>=7&d,d-=7&d,n.mode=27;break}for(;d<3;){if(0===a)break e;a--,c+=i[r++]<<d,d+=8}switch(n.last=1&c,--d,3&(c>>>=1)){case 0:n.mode=14;break;case 1:if(!function(e){if(L){var t;for(N=new E.Buf32(512),$=new E.Buf32(32),t=0;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(P(z,e.lens,0,288,N,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;P(j,e.lens,0,32,$,0,e.work,{bits:5}),L=!1}e.lencode=N,e.lenbits=9,e.distcode=$,e.distbits=5}(n),n.mode=20,6!==t)break;c>>>=2,d-=2;break e;case 2:n.mode=17;break;case 3:e.msg="invalid block type",n.mode=30}c>>>=2,d-=2;break;case 14:for(c>>>=7&d,d-=7&d;d<32;){if(0===a)break e;a--,c+=i[r++]<<d,d+=8}if((65535&c)!=(c>>>16^65535)){e.msg="invalid stored block lengths",n.mode=30;break}if(n.length=65535&c,d=c=0,n.mode=15,6===t)break e;case 15:n.mode=16;case 16:if(f=n.length){if(a<f&&(f=a),l<f&&(f=l),0===f)break e;E.arraySet(s,i,r,f,o),a-=f,r+=f,l-=f,o+=f,n.length-=f;break}n.mode=12;break;case 17:for(;d<14;){if(0===a)break e;a--,c+=i[r++]<<d,d+=8}if(n.nlen=257+(31&c),c>>>=5,d-=5,n.ndist=1+(31&c),c>>>=5,d-=5,n.ncode=4+(15&c),c>>>=4,d-=4,286<n.nlen||30<n.ndist){e.msg="too many length or distance symbols",n.mode=30;break}n.have=0,n.mode=18;case 18:for(;n.have<n.ncode;){for(;d<3;){if(0===a)break e;a--,c+=i[r++]<<d,d+=8}n.lens[T[n.have++]]=7&c,c>>>=3,d-=3}for(;n.have<19;)n.lens[T[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,C={bits:n.lenbits},k=P(0,n.lens,0,19,n.lencode,0,n.work,C),n.lenbits=C.bits,k){e.msg="invalid code lengths set",n.mode=30;break}n.have=0,n.mode=19;case 19:for(;n.have<n.nlen+n.ndist;){for(;b=(S=n.lencode[c&(1<<n.lenbits)-1])>>>16&255,v=65535&S,!((g=S>>>24)<=d);){if(0===a)break e;a--,c+=i[r++]<<d,d+=8}if(v<16)c>>>=g,d-=g,n.lens[n.have++]=v;else{if(16===v){for(x=g+2;d<x;){if(0===a)break e;a--,c+=i[r++]<<d,d+=8}if(c>>>=g,d-=g,0===n.have){e.msg="invalid bit length repeat",n.mode=30;break}I=n.lens[n.have-1],f=3+(3&c),c>>>=2,d-=2}else if(17===v){for(x=g+3;d<x;){if(0===a)break e;a--,c+=i[r++]<<d,d+=8}d-=g,I=0,f=3+(7&(c>>>=g)),c>>>=3,d-=3}else{for(x=g+7;d<x;){if(0===a)break e;a--,c+=i[r++]<<d,d+=8}d-=g,I=0,f=11+(127&(c>>>=g)),c>>>=7,d-=7}if(n.have+f>n.nlen+n.ndist){e.msg="invalid bit length repeat",n.mode=30;break}for(;f--;)n.lens[n.have++]=I}}if(30===n.mode)break;if(0===n.lens[256]){e.msg="invalid code -- missing end-of-block",n.mode=30;break}if(n.lenbits=9,C={bits:n.lenbits},k=P(z,n.lens,0,n.nlen,n.lencode,0,n.work,C),n.lenbits=C.bits,k){e.msg="invalid literal/lengths set",n.mode=30;break}if(n.distbits=6,n.distcode=n.distdyn,C={bits:n.distbits},k=P(j,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,C),n.distbits=C.bits,k){e.msg="invalid distances set",n.mode=30;break}if(n.mode=20,6===t)break e;case 20:n.mode=21;case 21:if(6<=a&&258<=l){e.next_out=o,e.avail_out=l,e.next_in=r,e.avail_in=a,n.hold=c,n.bits=d,O(e,h),o=e.next_out,s=e.output,l=e.avail_out,r=e.next_in,i=e.input,a=e.avail_in,c=n.hold,d=n.bits,12===n.mode&&(n.back=-1);break}for(n.back=0;b=(S=n.lencode[c&(1<<n.lenbits)-1])>>>16&255,v=65535&S,!((g=S>>>24)<=d);){if(0===a)break e;a--,c+=i[r++]<<d,d+=8}if(b&&0==(240&b)){for(w=g,y=b,_=v;b=(S=n.lencode[_+((c&(1<<w+y)-1)>>w)])>>>16&255,v=65535&S,!(w+(g=S>>>24)<=d);){if(0===a)break e;a--,c+=i[r++]<<d,d+=8}c>>>=w,d-=w,n.back+=w}if(c>>>=g,d-=g,n.back+=g,n.length=v,0===b){n.mode=26;break}if(32&b){n.back=-1,n.mode=12;break}if(64&b){e.msg="invalid literal/length code",n.mode=30;break}n.extra=15&b,n.mode=22;case 22:if(n.extra){for(x=n.extra;d<x;){if(0===a)break e;a--,c+=i[r++]<<d,d+=8}n.length+=c&(1<<n.extra)-1,c>>>=n.extra,d-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=23;case 23:for(;b=(S=n.distcode[c&(1<<n.distbits)-1])>>>16&255,v=65535&S,!((g=S>>>24)<=d);){if(0===a)break e;a--,c+=i[r++]<<d,d+=8}if(0==(240&b)){for(w=g,y=b,_=v;b=(S=n.distcode[_+((c&(1<<w+y)-1)>>w)])>>>16&255,v=65535&S,!(w+(g=S>>>24)<=d);){if(0===a)break e;a--,c+=i[r++]<<d,d+=8}c>>>=w,d-=w,n.back+=w}if(c>>>=g,d-=g,n.back+=g,64&b){e.msg="invalid distance code",n.mode=30;break}n.offset=v,n.extra=15&b,n.mode=24;case 24:if(n.extra){for(x=n.extra;d<x;){if(0===a)break e;a--,c+=i[r++]<<d,d+=8}n.offset+=c&(1<<n.extra)-1,c>>>=n.extra,d-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){e.msg="invalid distance too far back",n.mode=30;break}n.mode=25;case 25:if(0===l)break e;if(f=h-l,n.offset>f){if((f=n.offset-f)>n.whave&&n.sane){e.msg="invalid distance too far back",n.mode=30;break}m=f>n.wnext?(f-=n.wnext,n.wsize-f):n.wnext-f,f>n.length&&(f=n.length),p=n.window}else p=s,m=o-n.offset,f=n.length;for(l<f&&(f=l),l-=f,n.length-=f;s[o++]=p[m++],--f;);0===n.length&&(n.mode=21);break;case 26:if(0===l)break e;s[o++]=n.length,l--,n.mode=21;break;case 27:if(n.wrap){for(;d<32;){if(0===a)break e;a--,c|=i[r++]<<d,d+=8}if(h-=l,e.total_out+=h,n.total+=h,h&&(e.adler=n.check=(n.flags?M:R)(n.check,s,h,o-h)),h=l,(n.flags?c:F(c))!==n.check){e.msg="incorrect data check",n.mode=30;break}d=c=0}n.mode=28;case 28:if(n.wrap&&n.flags){for(;d<32;){if(0===a)break e;a--,c+=i[r++]<<d,d+=8}if(c!==(4294967295&n.total)){e.msg="incorrect length check",n.mode=30;break}d=c=0}n.mode=29;case 29:k=1;break e;case 30:k=-3;break e;case 31:return-4;case 32:default:return B}return e.next_out=o,e.avail_out=l,e.next_in=r,e.avail_in=a,n.hold=c,n.bits=d,(n.wsize||h!==e.avail_out&&n.mode<30&&(n.mode<27||4!==t))&&V(e,e.output,e.next_out,h-e.avail_out)?(n.mode=31,-4):(u-=e.avail_in,h-=e.avail_out,e.total_in+=u,e.total_out+=h,n.total+=h,n.wrap&&h&&(e.adler=n.check=(n.flags?M:R)(n.check,s,h,e.next_out-h)),e.data_type=n.bits+(n.last?64:0)+(12===n.mode?128:0)+(20===n.mode||15===n.mode?256:0),(0==u&&0===h||4===t)&&k===U&&(k=-5),k)},n.inflateEnd=function(e){if(!e||!e.state)return B;var t=e.state;return t.window&&(t.window=null),e.state=null,U},n.inflateGetHeader=function(e,t){var n;return!e||!e.state||0==(2&(n=e.state).wrap)?B:((n.head=t).done=!1,U)},n.inflateSetDictionary=function(e,t){var n,i=t.length;return!e||!e.state||0!==(n=e.state).wrap&&11!==n.mode?B:11===n.mode&&R(1,t,i,0)!==n.check?-3:V(e,t,i,i)?(n.mode=31,-4):(n.havedict=1,U)},n.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(e,t,n){"use strict";var z=e("../utils/common"),j=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],U=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],B=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],D=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];t.exports=function(e,t,n,i,s,r,o,a){for(var l,c,d,u,h,f,m,p,g,b=a.bits,v=0,w=0,y=0,_=0,I=0,k=0,C=0,x=0,S=0,A=0,T=null,E=0,R=new z.Buf16(16),M=new z.Buf16(16),O=null,P=0,v=0;v<=15;v++)R[v]=0;for(w=0;w<i;w++)R[t[n+w]]++;for(I=b,_=15;1<=_&&0===R[_];_--);if(_<I&&(I=_),0===_)return s[r++]=20971520,s[r++]=20971520,a.bits=1,0;for(y=1;y<_&&0===R[y];y++);for(I<y&&(I=y),v=x=1;v<=15;v++)if(x<<=1,(x-=R[v])<0)return-1;if(0<x&&(0===e||1!==_))return-1;for(M[1]=0,v=1;v<15;v++)M[v+1]=M[v]+R[v];for(w=0;w<i;w++)0!==t[n+w]&&(o[M[t[n+w]]++]=w);if(f=0===e?(T=O=o,19):1===e?(T=j,E-=257,O=U,P-=257,256):(T=B,O=D,-1),v=y,h=r,C=w=A=0,d=-1,u=(S=1<<(k=I))-1,1===e&&852<S||2===e&&592<S)return 1;for(;;){for(m=v-C,g=o[w]<f?(p=0,o[w]):o[w]>f?(p=O[P+o[w]],T[E+o[w]]):(p=96,0),l=1<<v-C,y=c=1<<k;s[h+(A>>C)+(c-=l)]=m<<24|p<<16|g|0,0!==c;);for(l=1<<v-1;A&l;)l>>=1;if(0!==l?(A&=l-1,A+=l):A=0,w++,0==--R[v]){if(v===_)break;v=t[n+o[w]]}if(I<v&&(A&u)!==d){for(0===C&&(C=I),h+=y,x=1<<(k=v-C);k+C<_&&!((x-=R[k+C])<=0);)k++,x<<=1;if(S+=1<<k,1===e&&852<S||2===e&&592<S)return 1;s[d=A&u]=I<<24|k<<16|h-r|0}}return 0!==A&&(s[h+A]=v-C<<24|64<<16|0),a.bits=I,0}},{"../utils/common":41}],51:[function(e,t,n){"use strict";t.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(e,t,n){"use strict";var l=e("../utils/common"),a=0,c=1;function i(e){for(var t=e.length;0<=--t;)e[t]=0}var d=0,o=29,u=256,h=u+1+o,f=30,m=19,g=2*h+1,b=15,s=16,p=7,v=256,w=16,y=17,_=18,I=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],k=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],C=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],x=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],S=new Array(2*(h+2));i(S);var A=new Array(2*f);i(A);var T=new Array(512);i(T);var E=new Array(256);i(E);var R=new Array(o);i(R);var M,O,P,z=new Array(f);function j(e,t,n,i,s){this.static_tree=e,this.extra_bits=t,this.extra_base=n,this.elems=i,this.max_length=s,this.has_stree=e&&e.length}function r(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}function U(e){return e<256?T[e]:T[256+(e>>>7)]}function B(e,t){e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255}function D(e,t,n){e.bi_valid>s-n?(e.bi_buf|=t<<e.bi_valid&65535,B(e,e.bi_buf),e.bi_buf=t>>s-e.bi_valid,e.bi_valid+=n-s):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=n)}function F(e,t,n){D(e,n[2*t],n[2*t+1])}function N(e,t){for(var n=0;n|=1&e,e>>>=1,n<<=1,0<--t;);return n>>>1}function $(e,t,n){for(var i,s=new Array(b+1),r=0,o=1;o<=b;o++)s[o]=r=r+n[o-1]<<1;for(i=0;i<=t;i++){var a=e[2*i+1];0!==a&&(e[2*i]=N(s[a]++,a))}}function L(e){for(var t=0;t<h;t++)e.dyn_ltree[2*t]=0;for(t=0;t<f;t++)e.dyn_dtree[2*t]=0;for(t=0;t<m;t++)e.bl_tree[2*t]=0;e.dyn_ltree[2*v]=1,e.opt_len=e.static_len=0,e.last_lit=e.matches=0}function V(e){8<e.bi_valid?B(e,e.bi_buf):0<e.bi_valid&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0}function q(e,t,n,i){var s=2*t,r=2*n;return e[s]<e[r]||e[s]===e[r]&&i[t]<=i[n]}function H(e,t,n){for(var i=e.heap[n],s=n<<1;s<=e.heap_len&&(s<e.heap_len&&q(t,e.heap[s+1],e.heap[s],e.depth)&&s++,!q(t,i,e.heap[s],e.depth));)e.heap[n]=e.heap[s],n=s,s<<=1;e.heap[n]=i}function W(e,t,n){var i,s,r,o,a=0;if(0!==e.last_lit)for(;i=e.pending_buf[e.d_buf+2*a]<<8|e.pending_buf[e.d_buf+2*a+1],s=e.pending_buf[e.l_buf+a],a++,0==i?F(e,s,t):(F(e,(r=E[s])+u+1,t),0!==(o=I[r])&&D(e,s-=R[r],o),F(e,r=U(--i),n),0!==(o=k[r])&&D(e,i-=z[r],o)),a<e.last_lit;);F(e,v,t)}function Z(e,t){var n,i,s,r=t.dyn_tree,o=t.stat_desc.static_tree,a=t.stat_desc.has_stree,l=t.stat_desc.elems,c=-1;for(e.heap_len=0,e.heap_max=g,n=0;n<l;n++)0!==r[2*n]?(e.heap[++e.heap_len]=c=n,e.depth[n]=0):r[2*n+1]=0;for(;e.heap_len<2;)r[2*(s=e.heap[++e.heap_len]=c<2?++c:0)]=1,e.depth[s]=0,e.opt_len--,a&&(e.static_len-=o[2*s+1]);for(t.max_code=c,n=e.heap_len>>1;1<=n;n--)H(e,r,n);for(s=l;n=e.heap[1],e.heap[1]=e.heap[e.heap_len--],H(e,r,1),i=e.heap[1],e.heap[--e.heap_max]=n,e.heap[--e.heap_max]=i,r[2*s]=r[2*n]+r[2*i],e.depth[s]=(e.depth[n]>=e.depth[i]?e.depth[n]:e.depth[i])+1,r[2*n+1]=r[2*i+1]=s,e.heap[1]=s++,H(e,r,1),2<=e.heap_len;);e.heap[--e.heap_max]=e.heap[1],function(e,t){for(var n,i,s,r,o,a=t.dyn_tree,l=t.max_code,c=t.stat_desc.static_tree,d=t.stat_desc.has_stree,u=t.stat_desc.extra_bits,h=t.stat_desc.extra_base,f=t.stat_desc.max_length,m=0,p=0;p<=b;p++)e.bl_count[p]=0;for(a[2*e.heap[e.heap_max]+1]=0,n=e.heap_max+1;n<g;n++)f<(p=a[2*a[2*(i=e.heap[n])+1]+1]+1)&&(p=f,m++),a[2*i+1]=p,l<i||(e.bl_count[p]++,r=0,h<=i&&(r=u[i-h]),o=a[2*i],e.opt_len+=o*(p+r),d&&(e.static_len+=o*(c[2*i+1]+r)));if(0!==m){do{for(p=f-1;0===e.bl_count[p];)p--;e.bl_count[p]--,e.bl_count[p+1]+=2,e.bl_count[f]--,m-=2}while(0<m);for(p=f;0!==p;p--)for(i=e.bl_count[p];0!==i;)l<(s=e.heap[--n])||(a[2*s+1]!==p&&(e.opt_len+=(p-a[2*s+1])*a[2*s],a[2*s+1]=p),i--)}}(e,t),$(r,c,e.bl_count)}function G(e,t,n){var i,s,r=-1,o=t[1],a=0,l=7,c=4;for(0===o&&(l=138,c=3),t[2*(n+1)+1]=65535,i=0;i<=n;i++)s=o,o=t[2*(i+1)+1],++a<l&&s===o||(a<c?e.bl_tree[2*s]+=a:0!==s?(s!==r&&e.bl_tree[2*s]++,e.bl_tree[2*w]++):a<=10?e.bl_tree[2*y]++:e.bl_tree[2*_]++,r=s,c=(a=0)===o?(l=138,3):s===o?(l=6,3):(l=7,4))}function J(e,t,n){var i,s,r=-1,o=t[1],a=0,l=7,c=4;for(0===o&&(l=138,c=3),i=0;i<=n;i++)if(s=o,o=t[2*(i+1)+1],!(++a<l&&s===o)){if(a<c)for(;F(e,s,e.bl_tree),0!=--a;);else 0!==s?(s!==r&&(F(e,s,e.bl_tree),a--),F(e,w,e.bl_tree),D(e,a-3,2)):a<=10?(F(e,y,e.bl_tree),D(e,a-3,3)):(F(e,_,e.bl_tree),D(e,a-11,7));r=s,c=(a=0)===o?(l=138,3):s===o?(l=6,3):(l=7,4)}}i(z);var K=!1;function Q(e,t,n,i){var s,r,o,a;D(e,(d<<1)+(i?1:0),3),r=t,o=n,a=!0,V(s=e),a&&(B(s,o),B(s,~o)),l.arraySet(s.pending_buf,s.window,r,o,s.pending),s.pending+=o}n._tr_init=function(e){K||(function(){for(var e,t,n,i=new Array(b+1),s=0,r=0;r<o-1;r++)for(R[r]=s,e=0;e<1<<I[r];e++)E[s++]=r;for(E[s-1]=r,r=n=0;r<16;r++)for(z[r]=n,e=0;e<1<<k[r];e++)T[n++]=r;for(n>>=7;r<f;r++)for(z[r]=n<<7,e=0;e<1<<k[r]-7;e++)T[256+n++]=r;for(t=0;t<=b;t++)i[t]=0;for(e=0;e<=143;)S[2*e+1]=8,e++,i[8]++;for(;e<=255;)S[2*e+1]=9,e++,i[9]++;for(;e<=279;)S[2*e+1]=7,e++,i[7]++;for(;e<=287;)S[2*e+1]=8,e++,i[8]++;for($(S,h+1,i),e=0;e<f;e++)A[2*e+1]=5,A[2*e]=N(e,5);M=new j(S,I,u+1,h,b),O=new j(A,k,0,f,b),P=new j(new Array(0),C,0,m,p)}(),K=!0),e.l_desc=new r(e.dyn_ltree,M),e.d_desc=new r(e.dyn_dtree,O),e.bl_desc=new r(e.bl_tree,P),e.bi_buf=0,e.bi_valid=0,L(e)},n._tr_stored_block=Q,n._tr_flush_block=function(e,t,n,i){var s,r,o=0;0<e.level?(2===e.strm.data_type&&(e.strm.data_type=function(e){for(var t=4093624447,n=0;n<=31;n++,t>>>=1)if(1&t&&0!==e.dyn_ltree[2*n])return a;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return c;for(n=32;n<u;n++)if(0!==e.dyn_ltree[2*n])return c;return a}(e)),Z(e,e.l_desc),Z(e,e.d_desc),o=function(e){var t;for(G(e,e.dyn_ltree,e.l_desc.max_code),G(e,e.dyn_dtree,e.d_desc.max_code),Z(e,e.bl_desc),t=m-1;3<=t&&0===e.bl_tree[2*x[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t}(e),s=e.opt_len+3+7>>>3,(r=e.static_len+3+7>>>3)<=s&&(s=r)):s=r=n+5,n+4<=s&&-1!==t?Q(e,t,n,i):4===e.strategy||r===s?(D(e,2+(i?1:0),3),W(e,S,A)):(D(e,4+(i?1:0),3),function(e,t,n,i){var s;for(D(e,t-257,5),D(e,n-1,5),D(e,i-4,4),s=0;s<i;s++)D(e,e.bl_tree[2*x[s]+1],3);J(e,e.dyn_ltree,t-1),J(e,e.dyn_dtree,n-1)}(e,e.l_desc.max_code+1,e.d_desc.max_code+1,o+1),W(e,e.dyn_ltree,e.dyn_dtree)),L(e),i&&V(e)},n._tr_tally=function(e,t,n){return e.pending_buf[e.d_buf+2*e.last_lit]=t>>>8&255,e.pending_buf[e.d_buf+2*e.last_lit+1]=255&t,e.pending_buf[e.l_buf+e.last_lit]=255&n,e.last_lit++,0===t?e.dyn_ltree[2*n]++:(e.matches++,t--,e.dyn_ltree[2*(E[n]+u+1)]++,e.dyn_dtree[2*U(t)]++),e.last_lit===e.lit_bufsize-1},n._tr_align=function(e){var t;D(e,2,3),F(e,v,S),16===(t=e).bi_valid?(B(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):8<=t.bi_valid&&(t.pending_buf[t.pending++]=255&t.bi_buf,t.bi_buf>>=8,t.bi_valid-=8)}},{"../utils/common":41}],53:[function(e,t,n){"use strict";t.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(e,t,n){"use strict";t.exports="function"==typeof setImmediate?setImmediate:function(){var e=[].slice.apply(arguments);e.splice(1,0,0),setTimeout.apply(null,e)}},{}]},{},[10])(10)}),function(e){"object"==typeof exports?module.exports=e():"function"==typeof define&&define.amd?define(e):"undefined"!=typeof window?window.JSZipUtils=e():"undefined"!=typeof global?global.JSZipUtils=e():"undefined"!=typeof self&&(self.JSZipUtils=e())}(function(){return function s(r,o,a){function l(n,e){if(!o[n]){if(!r[n]){var t="function"==typeof require&&require;if(!e&&t)return t(n,!0);if(c)return c(n,!0);throw new Error("Cannot find module '"+n+"'")}var i=o[n]={exports:{}};r[n][0].call(i.exports,function(e){var t=r[n][1][e];return l(t||e)},i,i.exports,s,r,o,a)}return o[n].exports}for(var c="function"==typeof require&&require,e=0;e<a.length;e++)l(a[e]);return l}({1:[function(e,t,n){"use strict";var a={};function i(){try{return new window.XMLHttpRequest}catch(e){}}a._getBinaryFromXHR=function(e){return e.response||e.responseText};var l="undefined"!=typeof window&&window.ActiveXObject?function(){return i()||function(){try{return new window.ActiveXObject("Microsoft.XMLHTTP")}catch(e){}}()}:i;a.getBinaryContent=function(t,n){var e,i,s,r;"function"==typeof(n=n||{})?(r=n,n={}):"function"==typeof n.callback&&(r=n.callback),r||"undefined"==typeof Promise?(i=function(e){r(null,e)},s=function(e){r(e,null)}):e=new Promise(function(e,t){i=e,s=t});try{var o=l();o.open("GET",t,!0),"responseType"in o&&(o.responseType="arraybuffer"),o.overrideMimeType&&o.overrideMimeType("text/plain; charset=x-user-defined"),o.onreadystatechange=function(e){if(4===o.readyState)if(200===o.status||0===o.status)try{i(a._getBinaryFromXHR(o))}catch(e){s(new Error(e))}else s(new Error("Ajax error for "+t+" : "+this.status+" "+this.statusText))},n.progress&&(o.onprogress=function(e){n.progress({path:t,originalEvent:e,percent:e.loaded/e.total*100,loaded:e.loaded,total:e.total})}),o.send()}catch(e){s(new Error(e),null)}return e},t.exports=a},{}]},{},[1])(1)});var saveAs=saveAs||"undefined"!=typeof navigator&&navigator.msSaveOrOpenBlob&&navigator.msSaveOrOpenBlob.bind(navigator)||function(p){"use strict";if("undefined"==typeof navigator||!/MSIE [1-9]\./.test(navigator.userAgent)){var g=p.document,b=function(){return p.URL||p.webkitURL||p},v=g.createElementNS("http://www.w3.org/1999/xhtml","a"),w=!p.externalHost&&"download"in v,y=p.webkitRequestFileSystem,_=p.requestFileSystem||y||p.mozRequestFileSystem,I="application/octet-stream",k=0,C=[],e=function(){for(var e=C.length;e--;){var t=C[e];"string"==typeof t?b().revokeObjectURL(t):t.remove()}C.length=0},x=function(e,t,n){for(var i=(t=[].concat(t)).length;i--;){var s=e["on"+t[i]];if("function"==typeof s)try{s.call(e,n||e)}catch(e){!function(e){(p.setImmediate||p.setTimeout)(function(){throw e},0)}(e)}}},n=function(i,n){function e(){var e=b().createObjectURL(i);return C.push(e),e}function t(){x(u,"writestart progress write writeend".split(" "))}function s(){!f&&o||(o=e()),a?a.location.href=o:window.open(o,"_blank"),u.readyState=u.DONE,t()}function r(e){return function(){if(u.readyState!==u.DONE)return e.apply(this,arguments)}}var o,a,l,c,d,u=this,h=i.type,f=!1,m={create:!0,exclusive:!1};if(u.readyState=u.INIT,n=n||"download",w)return o=e(),v.href=o,v.download=n,c=v,(d=g.createEvent("MouseEvents")).initMouseEvent("click",!0,!1,p,0,0,0,0,0,!1,!1,!1,!1,0,null),c.dispatchEvent(d),u.readyState=u.DONE,void t();p.chrome&&h&&h!==I&&(l=i.slice||i.webkitSlice,i=l.call(i,0,i.size,I),f=!0),y&&"download"!==n&&(n+=".download"),h!==I&&!y||(a=p),_?(k+=i.size,_(p.TEMPORARY,k,r(function(e){e.root.getDirectory("saved",m,r(function(e){function t(){e.getFile(n,m,r(function(n){n.createWriter(r(function(t){t.onwriteend=function(e){a.location.href=n.toURL(),C.push(n),u.readyState=u.DONE,x(u,"writeend",e)},t.onerror=function(){var e=t.error;e.code!==e.ABORT_ERR&&s()},"writestart progress write abort".split(" ").forEach(function(e){t["on"+e]=u["on"+e]}),t.write(i),u.abort=function(){t.abort(),u.readyState=u.DONE},u.readyState=u.WRITING}),s)}),s)}e.getFile(n,{create:!1},r(function(e){e.remove(),t()}),r(function(e){(e.code===e.NOT_FOUND_ERR?t:s)()}))}),s)}),s)):s()},t=n.prototype,i=function(e,t){return new n(e,t)};return t.abort=function(){this.readyState=this.DONE,x(this,"abort")},t.readyState=t.INIT=0,t.WRITING=1,t.DONE=2,t.error=t.onwritestart=t.onprogress=t.onwrite=t.onabort=t.onerror=t.onwriteend=null,p.addEventListener("unload",e,!1),i.unload=function(){e(),p.removeEventListener("unload",e,!1)},i}}("undefined"!=typeof self&&self||"undefined"!=typeof window&&window||this.content);"undefined"!=typeof module&&null!==module?module.exports=saveAs:"undefined"!=typeof define&&null!==define&&null!=define.amd&&define([],function(){return saveAs}),Ibles.JST["featured-by"]='featured by: <a href="<< Ibles.reverseUrls.memberUrl(featuredBy) >>"><< featuredBy >> </a>',Ibles.JST["add-to-contest-modal"]='<div class="modal-header">\n    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>\n    <h3>Contests</h3>\n</div>\n<div class="modal-body">\n    <div class="loading center">\n        <h4>Loading...</h4>\n        <img src="<< Ibles.staticUrl(\'img/lb_loading.gif\') >>"/>\n    </div>\n    <ul class="unstyled eligible-contests hide"></ul>\n    <p class="msg hide no-contests-msg">Sorry, there are no contests that this instructable can join. Only Instructables published after a contest start date are eligible to join. <br><br>Create a <a href="<< Ibles.reverseUrls.editorCreate() >>">new instructable.</a></p>\n</div>\n<div class="modal-footer">\n    <span class="add-to-contest-error">\n    </span>\n    <a class="btn" data-dismiss="modal">Close</a>\n</div>',Ibles.JST["add-to-contest-modal-list-item"]='<div class="addable-item addable-contest clearfix">\n    <div class="image">\n        <a href="<< url >>"><img src="<< bannerFile.getSmallUrl() >>"/></a>\n    </div>\n    <div class="title">\n        <a class="btn enter-btn"\n            data-entered-text="<i class=\'bg-icon checkmark active\'></i>&nbsp; Entered"\n            data-enter-text="<i class=\'bg-icon checkmark\'></i>&nbsp; Enter"\n            data-pending-text="<i class=\'bg-icon checkmark active\'></i>&nbsp; Pending Approval"\n            data-remove-text="<i class=\'bg-icon checkmark active\'></i>&nbsp; Remove"\n            data-loading-text="<i class=\'bg-icon checkmark\'></i>&nbsp; ...">\n            <[ if (pending) { ]>\n                <i class="bg-icon checkmark active"></i>&nbsp; Pending Approval\n            <[ } else if (!entered) { ]>\n                <i class="bg-icon checkmark"></i>&nbsp; Enter\n            <[ } else { ]>\n                <i class="bg-icon checkmark active"></i>&nbsp; Entered\n            <[ } ]>\n        </a>\n    </div>\n</div>\n',Ibles.JST["stats-modal"]='<div class="modal-header">\n    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>\n    <h3>Stats</h3>\n</div>\n<div class="modal-body">\n    <table id="stats-summary-table" class="table table-striped">\n        <tr><td>Total Views</td><td><< views >></td></tr>\n        <tr><td>Comments</td><td><< comments >></td></tr>\n        <tr><td>Favorites</td><td><< favorites >></td></tr>\n    </table>\n    \n    <[ if (showReferrers && referrers.length) { ]>\n    <p class="strong">Referrers</p>\n    <table id="stats-referrer-table" class="table table-striped">\n        <[ _.each(referrers, function(referrer) { ]>\n            <[ if (referrer.url) {]>\n            <tr><td><a href="<< referrer.url >>"><< referrer.displayName >></a></td><td><< referrer.count >></td></tr>\n            <[ } ]>\n        <[ }); ]>\n    </table>\n    <[ } ]>\n</div>\n<div class="modal-footer">\n    <a class="btn" data-dismiss="modal">Close</a>\n</div>',Ibles.package("Ibles.views","Ibles.models","Ibles.collections"),Ibles.models.CandidateContest=Backbone.Model.extend({defaults:{id:null,title:null,url:null,urlString:null,onlyUS:!1,pending:!1,entered:!1},initialize:function(){var e=Ibles.reverseUrls,t=new Ibles.models.FileModel({originalUrl:this.get("bannerUrl")});this.set({url:e.contestDetailUrl(this.get("urlString")),bannerFile:t})},getUrlString:function(){return this.get("urlString")||this.get("id")},enteredContest:function(){return this.get("entered")||this.get("pending")},enterOrLeaveContest:function(e){var t=this,n={contestId:t.get("id"),projectId:t.collection.ibleId},i=t.get("passcodeRequirement");i&&i.passcode&&(n.passcode=i.passcode);var s={url:Ibles.apiUrl("enterContest"),data:JSON.stringify(n),contentType:"application/json",success:function(){t.set({entered:e,pending:!1})}};return e?Ibles.API.post(s):Ibles.API.delete(s)},canEnter:function(){return this.collection.where({entered:!0}).length+this.collection.where({pending:!0}).length<1}}),Ibles.collections.CandidateContests=Backbone.Collection.extend({model:Ibles.models.CandidateContest,initialize:function(e,t){this.ibleId=t.ibleId,this.iblePublishDate=t.iblePublishDate,this.enteredContests=t.enteredContests,this.loadContests()},loadContests:function(){var e=this;$.when(this.addPendingContests(),this.addOpenedContests()).done(function(){e.addEnteredContests(),e.trigger("doneLoadingContests")})},addEnteredContests:function(){var e=_.map(this.enteredContests,function(e){return e.entered=!0,e});this.add(e,{at:0,merge:!0})},addPendingContests:function(){var n=this;return Ibles.API.getRequest("showInstructableUserData",{id:this.ibleId},{success:function(e){var t=_.map(e.pendingInContests,function(e){return e.pending=!0,e});n.add(t,{merge:!0})}})},addEligibleContests:function(){var t=this;return Ibles.API.getRequest("getEligibleContests",{instructableId:this.ibleId},{success:function(e){t.add(e.contests,{merge:!0})}})},addOpenedContests:function(){var n=this,e=Ibles.session.isAdmin(),t={sort:"added",status:"published",limit:50},i=moment(n.iblePublishDate);return e&&(t.cb=(new Date).getTime()),Ibles.API.getRequest("getContests",t,{success:function(e){var t=_.filter(e.contests,function(e){var t=moment(e.startDate),n=moment(e.deadline);return Ibles.session.isAdmin()?t.isBefore(i):"open"===e.state&&t.isBefore(i)&&n.isAfter(i)&&!_.contains(e.indexTags,"designOnly")});n.add(t,{merge:!0})}})}}),Ibles.views.CandidateContestView=Backbone.View.extend({template:_.template(Ibles.JST["add-to-contest-modal-list-item"]),tagName:"li",events:{"click .enter-btn":"onEnterContestClick","mouseenter .enter-btn":"mouseEnterEnterBtn","mouseleave .enter-btn":"mouseLeaveEnterBtn"},initialize:function(){this.listenTo(this.model,"change:entered change:pending",this.changeEnteredStatus)},changeEnteredStatus:function(){var e=this.$(".enter-btn");this.model.get("pending")?e.button("pending"):this.model.get("entered")?e.button("entered"):e.button("enter"),e.attr("disabled",!1)},onEnterContestClick:function(e){e.preventDefault(),this.model.enteredContest()?this.model.enterOrLeaveContest(!1):this.model.canEnter()?Ibles.session.isAdmin()?($(e.currentTarget).button("loading"),this.model.enterOrLeaveContest(!0)):window.location=Ibles.reverseUrls.enterContestUrl(this.model):new Ibles.views.AlertLabelView({el:$(".add-to-contest-error"),showClose:!0,model:new Ibles.models.AlertModel({alertType:"error",alertMessage:"You may only enter each Instructable into 1 contest."})})},mouseEnterEnterBtn:function(){var e=this.$(".enter-btn");this.model.enteredContest()&&e.button("remove")},mouseLeaveEnterBtn:function(){var e=this.$(".enter-btn");this.model.enteredContest()&&(this.model.get("pending")?e.button("pending"):e.button("entered"))},render:function(){return this.$el.html(this.template(this.model.toJSON())),this}}),Ibles.views.AddToContestView=Backbone.View.extend({id:"add-to-contest-modal",className:"add-to-modal modal hide fade",template:_.template(Ibles.JST["add-to-contest-modal"]),initialize:function(e){var t=e.ibleData;this.eligibleContests=new Ibles.collections.CandidateContests([],{ibleId:t.id,iblePublishDate:t.publishDate,enteredContests:t.votableContests}),this.listenTo(this.eligibleContests,"add",this.renderEligibleContest),this.listenToOnce(this.eligibleContests,"doneLoadingContests",this.renderContestList),$("body").append(this.$el),this.$el.html(this.template())},render:function(){this.$el.modal()},renderEligibleContest:function(e){this.$(".eligible-contests").append(new Ibles.views.CandidateContestView({model:e}).render().el)},renderContestList:function(){this.$(".loading").hide(),0<this.eligibleContests.length?this.$(".eligible-contests").show():this.$(".no-contests-msg").show()}});